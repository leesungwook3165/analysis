<html lang="ko"><head>
<meta charset="UTF-8">
<title>Investment Portfolio Dashboard</title>

<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<!-- PDF -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<!-- Tabulator -->
<link href="https://unpkg.com/tabulator-tables@5.5.2/dist/css/tabulator.min.css" rel="stylesheet">
<script type="text/javascript" src="https://unpkg.com/tabulator-tables@5.5.2/dist/js/tabulator.min.js"></script>

<!-- SheetJS for Excel -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

<style>
body {
  font-family: "Segoe UI", Arial, sans-serif;
  background: #f4f6f9;
  margin: 0;
  padding: 20px;
}

h1, h2, h3 {
  margin: 10px 0;
}

header {
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.tabs button {
  margin-right: 6px;
  padding: 8px 14px;
  border: none;
  background: #ddd;
  cursor: pointer;
  border-radius: 4px;
}

.tabs button.active {
  background: #2c3e50;
  color: #fff;
}

.panel {
  display: none;
  background: #fff;
  padding: 20px;
  margin-top: 15px;
  border-radius: 6px;
}

.panel.active {
  display: block;
}

label {
  display: block;
  margin-top: 10px;
  font-size: 13px;
  color: #555;
}

input, select {
  width: 220px;
  padding: 6px;
  color: #000;
}

button {
  margin-top: 15px;
  padding: 10px 16px;
  border: none;
  background: #34495e;
  color: white;
  cursor: pointer;
  border-radius: 4px;
}

.kpi {
  display: flex;
  gap: 12px;
  margin-top: 15px;
}

.card {
  background: #fff;
  padding: 12px;
  border-radius: 6px;
  width: 160px;
  text-align: center;
}

.note {
  color: #888;
  font-size: 13px;
  margin-top: 10px;
}
/* ê¸€ë¨í•‘ í…Œì´ë¸” ìŠ¤íƒ€ì¼ */
table.grid {
  width: 100%;
  border-collapse: collapse;
  margin-top: 10px;
}
table.grid th, table.grid td {
  border: 1px solid #ddd;
  padding: 8px;
  text-align: center;
}
table.grid input {
  width: 80%;
  padding: 4px;
  text-align: right;
  font-family: 'Segoe UI', Arial, sans-serif;
  font-size: 14px;
}

.table-large-container {
  margin-top: 12px;
  overflow: auto;
  max-width: 100%;
  border: 1px solid #eee;
  padding: 8px;
  background: #fafafa;
  min-height: 180px;
}

.table-large-container .empty {
  color: #666;
  text-align: center;
  padding: 24px 8px;
}

/* Venture tree layout */
.venture-tree {
  display: grid;
  grid-template-columns: 28% 36% 36%;
  gap: 12px;
  min-height: 320px;
}

.venture-table {
  border: 1px solid #e0e0e0;
  border-radius: 6px;
  overflow: hidden;
  background: #fff;
}

.venture-detail {
  padding: 24px;
  border: none;
  border-radius: 12px;
  background: linear-gradient(135deg, #ffffff 0%, #f8f9fc 100%);
  box-shadow: 0 4px 16px rgba(0, 0, 0, 0.08);
  transition: all 0.3s ease;
}

.venture-detail:hover {
  box-shadow: 0 6px 24px rgba(0, 0, 0, 0.12);
}

.venture-visuals-panel {
  padding: 24px;
  border: none;
  border-radius: 12px;
  background: linear-gradient(135deg, #e0f7fa 0%, #b2ebf2 100%);
  box-shadow: 0 4px 16px rgba(0, 0, 0, 0.08);
}

.venture-visuals-panel h3 {
  margin-top: 0;
  font-size: 20px;
  color: #00695c;
  border-bottom: 3px solid #00897b;
  padding-bottom: 12px;
  margin-bottom: 20px;
  font-weight: 700;
}

.venture-visuals {
  display: flex;
  flex-direction: column;
  gap: 12px;
}

.venture-detail h3 {
  margin-top: 0;
  font-size: 20px;
  color: #2c3e50;
  border-bottom: 3px solid #667eea;
  padding-bottom: 12px;
  margin-bottom: 20px;
  font-weight: 700;
}

.venture-label {
  font-weight: 700;
  margin-top: 16px;
  margin-bottom: 8px;
  color: #00695c;
  font-size: 15px;
  letter-spacing: -0.3px;
}

.venture-score {
  display: flex;
  gap: 12px;
  margin-top: 12px;
  align-items: center;
}

.venture-score .score-box {
  padding: 16px 20px;
  border-radius: 12px;
  background: linear-gradient(135deg, #00897b 0%, #26a69a 100%);
  min-width: 140px;
  color: white;
  box-shadow: 0 4px 12px rgba(0, 137, 123, 0.3);
  transition: all 0.3s ease;
}

.venture-score .score-box:hover {
  transform: translateY(-2px);
  box-shadow: 0 6px 16px rgba(0, 137, 123, 0.4);
}

.score-box {
  padding: 16px 20px;
  border-radius: 12px;
  background: linear-gradient(135deg, #00897b 0%, #26a69a 100%);
  color: white;
  box-shadow: 0 4px 12px rgba(0, 137, 123, 0.3);
  transition: all 0.3s ease;
}

.score-box:hover {
  transform: translateY(-2px);
  box-shadow: 0 6px 16px rgba(0, 137, 123, 0.4);
}

.score-box .venture-label {
  color: rgba(255, 255, 255, 0.9);
  font-size: 13px;
  margin-top: 0;
  margin-bottom: 4px;
}

.signal {
  padding: 8px 16px;
  border-radius: 20px;
  font-weight: 700;
  font-size: 14px;
  display: inline-block;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
}

.signal.green { 
  background: linear-gradient(135deg, #4caf50 0%, #66bb6a 100%);
  color: white;
}
.signal.yellow { 
  background: linear-gradient(135deg, #ffc107 0%, #ffb300 100%);
  color: #333;
}
.signal.red { 
  background: linear-gradient(135deg, #f44336 0%, #e57373 100%);
  color: white;
}

.venture-chart-wrap {
  margin-top: 20px;
  padding: 20px;
  border: none;
  border-radius: 12px;
  background: white;
  box-shadow: 0 2px 12px rgba(0, 0, 0, 0.06);
}

#ventureRadar {
  width: 100%;
  height: 260px;
}

.venture-table {
  margin-top: 20px;
  background: white;
  border-radius: 12px;
  padding: 16px;
  box-shadow: 0 2px 12px rgba(0, 0, 0, 0.06);
}

.venture-metrics {
  width: 100%;
  border-collapse: collapse;
  margin-top: 10px;
}

.venture-metrics th,
.venture-metrics td {
  border: 1px solid #e8eaf0;
  padding: 12px 10px;
  font-size: 13px;
  text-align: left;
}

.venture-metrics th {
  background: linear-gradient(135deg, #00897b 0%, #26a69a 100%);
  color: white;
  font-weight: 600;
  letter-spacing: -0.2px;
}

.venture-metrics tbody tr:hover {
  background: #f8f9fc;
  transition: all 0.2s ease;
}

.metric-tooltip {
  position: relative;
  display: inline-flex;
  align-items: center;
  gap: 6px;
}

.metric-tooltip .info-dot {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  width: 16px;
  height: 16px;
  border-radius: 50%;
  background: #e0e0e0;
  color: #555;
  font-size: 11px;
  font-weight: 700;
  cursor: help;
}

.metric-tooltip .tooltip-text {
  visibility: hidden;
  opacity: 0;
  position: absolute;
  left: 0;
  top: 100%;
  margin-top: 6px;
  padding: 8px 10px;
  background: #2c3e50;
  color: #fff;
  border-radius: 6px;
  font-size: 12px;
  line-height: 1.5;
  width: 240px;
  z-index: 10;
  transition: opacity 0.2s ease;
}

.metric-tooltip:hover .tooltip-text {
  visibility: visible;
  opacity: 1;
}

/* Tabulator row hover (venture tree) */
#ventureTable .tabulator-row:hover {
  background-color: #e0e0e0;
}

#ventureTable .tabulator-row:hover .tabulator-cell,
#ventureTable .tabulator-cell:hover {
  background-color: #e0e0e0;
}

#ventureTable .tabulator-row.venture-row-hover,
#ventureTable .tabulator-row.venture-row-hover .tabulator-cell {
  background-color: #e0e0e0;
}

.venture-video-frames {
  display: flex;
  flex-direction: column;
  gap: 10px;
}

.venture-video {
  width: 100%;
  height: 350px;
  border: 0;
  border-radius: 6px;
  background: #000;
}

.venture-video-placeholder {
  font-size: 13px;
  color: #666;
  margin-top: 6px;
}

.venture-video-links {
  display: flex;
  flex-direction: column;
  gap: 4px;
  margin-top: 6px;
}

.venture-video-link {
  display: inline-block;
  font-size: 13px;
  color: #2c3e50;
  text-decoration: underline;
}

/* ë¼ë””ì˜¤ë¥¼ ê°€ë¡œë¡œ ì •ë ¬ */
.scenario { 
  margin-top: 12px; 
  display: flex;
  gap: 8px;
}
.scenario label { 
  display: inline-flex;
  align-items: center;
  padding: 10px 18px;
  background: #f5f5f5;
  border: 2px solid #ddd;
  border-radius: 8px;
  cursor: pointer;
  transition: all 0.3s ease;
  font-weight: 500;
  font-size: 14px;
}
.scenario label:hover {
  background: #e8e8e8;
  border-color: #bbb;
}
.scenario input[type="radio"] {
  margin-right: 8px;
  width: 18px;
  height: 18px;
  cursor: pointer;
}
.scenario input[type="radio"]:checked + span,
.scenario label:has(input[type="radio"]:checked) {
  background: #2c3e50;
  color: white;
  border-color: #2c3e50;
}

/* KPI scenario selection styling */
input[name="kpi_scenario"]:checked + span {
  color: #fff !important;
}

input[name="kpi_scenario"]:checked {
  accent-color: #fff;
}

label:has(input[name="kpi_scenario"]:checked) {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%) !important;
  border-color: #fff !important;
  box-shadow: 0 4px 8px rgba(102, 126, 234, 0.4);
  transform: translateY(-2px);
}

label:has(input[name="kpi_scenario"]) {
  transition: all 0.3s ease;
}

label:has(input[name="kpi_scenario"]):hover {
  box-shadow: 0 3px 6px rgba(102, 126, 234, 0.3);
  transform: translateY(-1px);
}

table.large {
  border-collapse: collapse;
  width: 100%;
}

table.large th, table.large td {
  border: 1px solid #ddd;
  padding: 6px;
  min-width: 60px;
  text-align: center;
}

/* Toast notifications */
#toastContainer{position:fixed;top:20px;right:20px;z-index:9999;}
.toast{background:#333;color:#fff;padding:10px 14px;border-radius:6px;margin-top:8px;box-shadow:0 2px 8px rgba(0,0,0,0.15);opacity:0.95}
.toast.error{background:#b00020}
.toast.success{background:#2e7d32}

/* occupancy settings small tweaks */
#occSettings input[type="number"]{width:70px;text-align:right;padding-right:6px}

/* Collapsible section styling */
.collapsible-section {
  margin: 20px 0;
  border: 2px solid #3498db;
  border-radius: 10px;
  overflow: hidden;
  background: #fff;
}

.collapsible-section summary {
  cursor: pointer;
  padding: 18px 20px;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: white;
  font-size: 18px;
  font-weight: 700;
  user-select: none;
  display: flex;
  align-items: center;
  gap: 12px;
  transition: all 0.3s ease;
  box-shadow: 0 2px 8px rgba(0,0,0,0.1);
}

.collapsible-section summary:hover {
  background: linear-gradient(135deg, #5568d3 0%, #6a3f8f 100%);
  box-shadow: 0 4px 12px rgba(0,0,0,0.15);
}

.collapsible-section summary::before {
  content: 'â–¼';
  font-size: 14px;
  transition: transform 0.3s ease;
  display: inline-block;
}

.collapsible-section[open] summary::before {
  transform: rotate(180deg);
}

.collapsible-section summary::marker {
  display: none;
}

.collapsible-section summary::-webkit-details-marker {
  display: none;
}

.collapsible-content {
  padding: 20px;
  background: #f8f9fa;
  animation: slideDown 0.3s ease;
}

@keyframes slideDown {
  from {
    opacity: 0;
    transform: translateY(-10px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

/* KPI Cards styling */
.kpi-card {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  padding: 20px;
  border-radius: 12px;
  box-shadow: 0 4px 15px rgba(0,0,0,0.1);
  text-align: center;
  color: white;
  transition: transform 0.3s ease, box-shadow 0.3s ease;
  position: relative;
  cursor: help;
}

.kpi-card:hover {
  transform: translateY(-5px);
  box-shadow: 0 8px 25px rgba(0,0,0,0.15);
}

.kpi-card:hover .kpi-tooltip {
  visibility: visible;
  opacity: 1;
}

.kpi-tooltip {
  visibility: hidden;
  opacity: 0;
  position: absolute;
  bottom: 100%;
  left: 50%;
  transform: translateX(-50%);
  background-color: rgba(0, 0, 0, 0.9);
  color: #fff;
  padding: 12px 16px;
  border-radius: 8px;
  font-size: 13px;
  white-space: pre-line;
  z-index: 1000;
  margin-bottom: 10px;
  transition: opacity 0.3s, visibility 0.3s;
  box-shadow: 0 4px 12px rgba(0,0,0,0.3);
  font-weight: 400;
  text-align: left;
  line-height: 1.6;
  min-width: 250px;
  max-width: 400px;
}

.kpi-tooltip::after {
  content: '';
  position: absolute;
  top: 100%;
  left: 50%;
  margin-left: -5px;
  border-width: 5px;
  border-style: solid;
  border-color: rgba(0, 0, 0, 0.9) transparent transparent transparent;
}

/* ê° KPI ì¹´ë“œì˜ ê³ ìœ í•œ ìƒ‰ìƒ */
.kpi-card-1 {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
}

.kpi-card-2 {
  background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
}

.kpi-card-3 {
  background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
}

.kpi-card-4 {
  background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
}

.kpi-card-5 {
  background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
}

.kpi-card-6 {
  background: linear-gradient(135deg, #30cfd0 0%, #330867 100%);
}

.kpi-card-7 {
  background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
  color: #333;
}

.kpi-card-8 {
  background: linear-gradient(135deg, #ff9a56 0%, #ff6a88 100%);
}

.kpi-label {
  font-size: 14px;
  font-weight: 600;
  margin-bottom: 10px;
  opacity: 0.9;
}

.kpi-value {
  font-size: 32px;
  font-weight: 700;
  margin: 10px 0;
  text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
}

.kpi-unit {
  font-size: 13px;
  opacity: 0.8;
  font-weight: 500;
}

/* Financial tables styling */
.financial-section {
  margin: 20px 0;
  padding: 15px;
  background: #fafafa;
  border-radius: 8px;
  border: 1px solid #e0e0e0;
}
.financial-section h3 {
  margin: 0 0 12px 0;
  color: #2c3e50;
  font-size: 16px;
  border-bottom: 2px solid #3498db;
  padding-bottom: 6px;
}
.financial-table {
  width: 100%;
  border-collapse: collapse;
  margin-bottom: 8px;
  font-size: 13px;
}
.financial-table th {
  background: #e8f4f8;
  padding: 8px;
  text-align: left;
  font-weight: 600;
  border: 1px solid #d0d0d0;
}
.financial-table td {
  padding: 6px 8px;
  border: 1px solid #d0d0d0;
}
.financial-table input[type="text"],
.financial-table input[type="number"] {
  width: 95%;
  padding: 4px 6px;
  border: 1px solid #ccc;
  border-radius: 3px;
  color: #333 !important;
  background-color: #fff !important;
  font-size: 13px !important;
  font-family: inherit;
}
.financial-table input[type="text"]:focus,
.financial-table input[type="number"]:focus {
  border-color: #3498db;
  outline: none;
}
.financial-table .item-name {
  width: 45%;
}
.financial-table .item-value {
  width: 45%;
}
.financial-table .item-actions {
  width: 10%;
  text-align: center;
}
.btn-small {
  padding: 4px 8px;
  font-size: 12px;
  border: none;
  border-radius: 3px;
  cursor: pointer;
  margin: 2px;
}
.btn-add {
  background: #27ae60;
  color: white;
}
.btn-add:hover {
  background: #229954;
}
.btn-delete {
  background: #e74c3c;
  color: white;
}
.btn-delete:hover {
  background: #c0392b;
}
.financial-summary {
  margin-top: 8px;
  padding: 8px 12px;
  background: #fff;
  border-radius: 4px;
  font-weight: 600;
  border-left: 4px solid #3498db;
}

/* Tabulator ì»¤ìŠ¤í…€ ìŠ¤íƒ€ì¼ */
.tabulator {
  background-color: white;
  border: 1px solid #ddd;
  font-size: 14px;
}

.tabulator-cell {
  padding: 8px 12px !important;
  border-right: 1px solid #ddd;
  border-bottom: 1px solid #ddd;
  background-color: white !important;
}

.tabulator-row {
  background-color: white !important;
}

.tabulator-row:hover {
  background-color: #f5f5f5 !important;
}

.tabulator-header {
  background-color: #667eea !important;
  color: white !important;
  font-weight: 600 !important;
  border-bottom: 2px solid #5568d3;
}

.tabulator-header .tabulator-col {
  background-color: #667eea !important;
  color: white !important;
  border-right: 1px solid rgba(255,255,255,0.2);
}

.tabulator-header .tabulator-col-title {
  color: white !important;
}

.tabulator-tableholder {
  background-color: white;
}

.tabulator-footer {
  background-color: #f8f9fa;
  padding: 10px;
  border-top: 2px solid #ddd;
}
</style>
</head>

<body>

<header>
  <h1>ì‚¬ì—… í¬íŠ¸í´ë¦¬ì˜¤ ìˆ˜ì§€ë¶„ì„ ëŒ€ì‹œë³´ë“œ</h1>
  <div class="tabs">
    <button class="active" data-tab="glamping">ê¸€ë¨í•‘</button>
    <button data-tab="venture" class="">ì‹ ê·œ ë²¤ì²˜</button>
    <button data-tab="ferry">ì—¬ê°ì„ </button>
    <button data-tab="total">í†µí•© ë¶„ì„</button>
  </div>
</header>

<!-- ì €ì¥ ë²„íŠ¼ -->
<div style="display:flex; gap:8px; align-items:center; justify-content:flex-end; padding:8px 20px; background:#f8f9fa; border-bottom:1px solid #e0e0e0;">
  <button onclick="saveAllFinancialData()" style="background:#27ae60; padding:6px 12px; font-weight:500; font-size:12px; border:none; border-radius:4px; color:white; cursor:pointer;">ğŸ’¾ ë¸Œë¼ìš°ì €ì— ì €ì¥</button>
  <button onclick="downloadHTMLFile()" style="background:#3498db; padding:6px 12px; font-weight:500; font-size:12px; border:none; border-radius:4px; color:white; cursor:pointer;">ğŸ“„ HTML íŒŒì¼ë¡œ ë‹¤ìš´ë¡œë“œ</button>
  <button onclick="resetAllFinancialData()" style="background:#e67e22; padding:6px 12px; font-weight:500; font-size:12px; border:none; border-radius:4px; color:white; cursor:pointer;">ğŸ”„ ê¸°ë³¸ê°’ìœ¼ë¡œ ì´ˆê¸°í™”</button>
</div>

<!-- Toast container for user messages -->
<div id="toastContainer"></div>

<!-- ì‹œë‚˜ë¦¬ì˜¤ ë° ë§¤ì¶œ êµ¬ì„± ì„ íƒ -->
<div id="scenarioSection" style="margin: 20px 0 15px 0; padding: 12px 15px; background: #f8f9fa; border-radius: 6px; border: 2px solid #e0e0e0; display: flex; gap: 20px; align-items: center; flex-wrap: wrap;">
  <div style="display: flex; gap: 8px; align-items: center;">
    <span style="font-weight: 600; font-size: 13px; color: #555;">ì‹œë‚˜ë¦¬ì˜¤:</span>
    <label style="display: inline-flex; align-items: center; cursor: pointer; padding: 4px 10px; background: #fff; border-radius: 4px; border: 1px solid #667eea; transition: all 0.2s; font-size: 12px;">
      <input type="radio" name="kpi_scenario" value="positive" style="width: 14px; height: 14px; margin-right: 5px; cursor: pointer;" onchange="updateKPIScenario()" checked="checked">
      <span style="font-weight: 500; color: #667eea;">ê¸ì •</span>
    </label>
    <label style="display: inline-flex; align-items: center; cursor: pointer; padding: 4px 10px; background: #fff; border-radius: 4px; border: 1px solid #667eea; transition: all 0.2s; font-size: 12px;">
      <input type="radio" name="kpi_scenario" value="neutral" style="width: 14px; height: 14px; margin-right: 5px; cursor: pointer;" onchange="updateKPIScenario()">
      <span style="font-weight: 500; color: #667eea;">ì¤‘ë¦½</span>
    </label>
    <label style="display: inline-flex; align-items: center; cursor: pointer; padding: 4px 10px; background: #fff; border-radius: 4px; border: 1px solid #667eea; transition: all 0.2s; font-size: 12px;">
      <input type="radio" name="kpi_scenario" value="negative" style="width: 14px; height: 14px; margin-right: 5px; cursor: pointer;" onchange="updateKPIScenario()">
      <span style="font-weight: 500; color: #667eea;">ë¶€ì •</span>
    </label>
  </div>
  
  <div style="height: 20px; width: 1px; background: #ddd;"></div>
  
  <div style="display: flex; gap: 10px; align-items: center;">
    <span style="font-weight: 600; font-size: 13px; color: #555;">ê¸€ë¨í•‘:</span>
    <select id="kpi_glamping_units" style="padding: 4px 10px; border-radius: 4px; border: 1px solid #667eea; font-weight: 500; cursor: pointer; font-size: 12px;" onchange="updateKPIScenario()">
      <option value="10">10ëŒ€</option>
      <option value="15" selected="selected">15ëŒ€</option>
      <option value="30">30ëŒ€</option>
    </select>
  </div>
  
  <div style="display: flex; gap: 8px; align-items: center;">
    <label style="display: inline-flex; align-items: center; cursor: pointer; padding: 4px 10px; background: #fff; border-radius: 4px; border: 1px solid #667eea; font-size: 12px;">
      <input type="checkbox" id="kpi_include_caravan" style="width: 14px; height: 14px; margin-right: 5px; cursor: pointer;" onchange="updateKPIScenario()" checked="checked">
      <span style="font-weight: 500; color: #667eea;">ì¹´ë¼ë°˜ 5ëŒ€</span>
    </label>
  </div>
  
  <div style="height: 20px; width: 1px; background: #ddd;"></div>
  
  <div style="display: flex; gap: 8px; align-items: center;">
    <button onclick="openOverviewPopup()" style="padding: 6px 16px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; border-radius: 4px; font-weight: 600; font-size: 13px; cursor: pointer; box-shadow: 0 2px 4px rgba(0,0,0,0.1); transition: all 0.2s;" onmouseover="this.style.transform='translateY(-1px)'; this.style.boxShadow='0 4px 8px rgba(0,0,0,0.15)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 2px 4px rgba(0,0,0,0.1)'">
      ğŸ“‹ ê°œìš”
    </button>
    <button onclick="openMapPopup()" style="padding: 6px 16px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; border-radius: 4px; font-weight: 600; font-size: 13px; cursor: pointer; box-shadow: 0 2px 4px rgba(0,0,0,0.1); transition: all 0.2s;" onmouseover="this.style.transform='translateY(-1px)'; this.style.boxShadow='0 4px 8px rgba(0,0,0,0.15)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 2px 4px rgba(0,0,0,0.1)'">
      ğŸ—ºï¸ MAP
    </button>
  </div>
</div>

<!-- í•µì‹¬ ì¬ë¬´ ì„±ê³¼ ì§€í‘œ (ìƒë‹¨) - ê¸€ë¨í•‘ ì „ìš© -->
<div id="kpiSection" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin: 0 0 20px 0;">
  <!-- 1. ì´ ì´ˆê¸° íˆ¬ìë¹„ -->
  <div class="kpi-card kpi-card-1">
    <div class="kpi-tooltip">ì´ˆê¸° íˆ¬ìë¹„(CAPEX) í•©ê³„
= 12.8ì–µ + 0.3ì–µ
= 13.1ì–µì›</div>
    <div class="kpi-label">ğŸ’µ ì´ ì´ˆê¸° íˆ¬ìë¹„</div>
    <div class="kpi-value" id="kpi_totalInvest">13.1</div>
    <div class="kpi-unit">ì–µì›</div>
  </div>
  
  <!-- 2. ì—°ê°„ ìš´ì˜ë¹„ -->
  <div class="kpi-card kpi-card-2">
    <div class="kpi-tooltip">ê³ ì • ìš´ì˜ë¹„ + ë³€ë™ ìš´ì˜ë¹„
= 3.8ì–µ + 0.2ì–µ
= 3.9ì–µì›/ë…„</div>
    <div class="kpi-label">ğŸ“‰ ì—°ê°„ ìš´ì˜ë¹„</div>
    <div class="kpi-value" id="kpi_opex">3.9</div>
    <div class="kpi-unit">ì–µì›/ë…„</div>
  </div>
  
  <!-- 3. EBITDA -->
  <div class="kpi-card kpi-card-3">
    <div class="kpi-tooltip">ë§¤ì¶œì•¡(ë¶€ê°€ì„¸ ì œì™¸) - ìš´ì˜ë¹„ - ë§ˆì¼€íŒ…ë¹„
ë¶€ê°€ì„¸ í¬í•¨: 9.2ì–µ
ë¶€ê°€ì„¸ ì œì™¸: 8.4ì–µ
= 8.4ì–µ - 3.9ì–µ - 0.0ì–µ
= 4.4ì–µì›/ë…„</div>
    <div class="kpi-label">ğŸ“Š EBITDA</div>
    <div class="kpi-value" id="kpi_ebitda">4.4</div>
    <div class="kpi-unit">ì–µì›/ë…„</div>
  </div>
  
  <!-- 4. ì˜ì—…ì´ìµ -->
  <div class="kpi-card kpi-card-4">
    <div class="kpi-tooltip">EBITDA - ê°ê°€ìƒê°ë¹„
= 4.4ì–µ - 0.3ì–µ
= 4.2ì–µì›/ë…„</div>
    <div class="kpi-label">ğŸ’° ì˜ì—…ì´ìµ</div>
    <div class="kpi-value" id="kpi_operatingProfit">4.2</div>
    <div class="kpi-unit">ì–µì›/ë…„</div>
  </div>
  
  <!-- 5. ì„¸í›„ì´ìµ -->
  <div class="kpi-card kpi-card-5">
    <div class="kpi-tooltip">ì˜ì—…ì´ìµ Ã— (1 - ë²•ì¸ì„¸ìœ¨)
= 4.2ì–µ Ã— (1 - 22.0%)
= 3.2ì–µì›/ë…„</div>
    <div class="kpi-label">âœ… ì„¸í›„ì´ìµ</div>
    <div class="kpi-value" id="kpi_netProfit">3.2</div>
    <div class="kpi-unit">ì–µì›/ë…„</div>
  </div>
  
  <!-- 6. ì—°ê°„ ìˆœí˜„ê¸ˆíë¦„ -->
  <div class="kpi-card kpi-card-6">
    <div class="kpi-tooltip">ì„¸í›„ì´ìµ + ê°ê°€ìƒê°ë¹„
= 3.2ì–µ + 0.3ì–µ
= 3.5ì–µì›/ë…„</div>
    <div class="kpi-label">ğŸ’¸ ì—°ê°„ ìˆœí˜„ê¸ˆíë¦„</div>
    <div class="kpi-value" id="kpi_cashFlow">3.5</div>
    <div class="kpi-unit">ì–µì›/ë…„</div>
  </div>
  
  <!-- 7. íˆ¬ìíšŒìˆ˜ê¸°ê°„ -->
  <div class="kpi-card kpi-card-7">
    <div class="kpi-tooltip">ì´ˆê¸° íˆ¬ìë¹„ Ã· ì—°ê°„ ìˆœí˜„ê¸ˆíë¦„
= 13.1ì–µ Ã· 3.5ì–µ
= 3.7ë…„</div>
    <div class="kpi-label">â±ï¸ íˆ¬ìíšŒìˆ˜ê¸°ê°„</div>
    <div class="kpi-value" id="kpi_payback">3.7</div>
    <div class="kpi-unit">ë…„</div>
  </div>
  
  <!-- 8. IRR -->
  <div class="kpi-card kpi-card-8">
    <div class="kpi-tooltip">NPV = 0ì´ ë˜ëŠ” í• ì¸ìœ¨
(5ë…„ê°„ í˜„ê¸ˆíë¦„ ê¸°ì¤€)
íˆ¬ì: 13.1ì–µ
ì—°ê°„ CF: 3.5ì–µ
IRR = 23.6%</div>
    <div class="kpi-label">ğŸ”¥ IRR (5ë…„ ê¸°ì¤€)</div>
    <div class="kpi-value" id="kpi_irr">23.6</div>
    <div class="kpi-unit">%</div>
  </div>
</div>

<!-- ì—¬ê°ì„  -->
<section id="ferry" class="panel">
<h2>ì—¬ê°ì„  ì‚¬ì—… (ì‹ ì¡° í¬í•¨)</h2>

<label>ì„ ê°€ (ì–µì›)</label>
<input id="shipPrice" type="number" value="300">

<label>ë³´ì¡°ê¸ˆ (ì–µì›)</label>
<input id="subsidy" type="number" value="60">

<label>ì—°ê°„ ìš´í•­ì¼ìˆ˜</label>
<input id="days" type="number" value="330">

<label>ì¼ í‰ê·  ìŠ¹ê°ìˆ˜</label>
<input id="passengers" type="number" value="800">

<label>ê°ë‹¨ê°€ (ì›)</label>
<input id="fare" type="number" value="50000">

<label>ì—°ê°„ ìš´ì˜ë¹„ (ì–µì›)</label>
<input id="opex" type="number" value="120">

<h3>ì‹œë‚˜ë¦¬ì˜¤</h3>
<label>ê°ë‹¨ê°€ ì¡°ì •</label>
<input id="fareSlider" type="range" min="0.8" max="1.2" step="0.05" value="1">
<span id="fareRate">100%</span>

<label>ë³´ì¡°ê¸ˆ ì ìš©</label>
<select id="subsidyToggle">
  <option value="on" selected="selected">ON</option>
  <option value="off">OFF</option>
</select>

<button id="ferryAnalyze">ì—¬ê°ì„  ë¶„ì„ ì‹¤í–‰</button>
<div id="ferrySummary" class="note">ë¶„ì„ ê²°ê³¼ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.</div>
</section>

<!-- ê¸€ë¨í•‘ -->
<section id="glamping" class="panel active">
<h2>ê¸€ë¨í•‘ ì‚¬ì—…</h2>

<!-- ì¬ë¬´ ì…ë ¥ ì„¹ì…˜: ë¶„í• ëœ ë‘ ê°œì˜ ì ‘ì´ì‹ ì˜ì—­ -->
<details class="collapsible-section">
  <summary>ğŸ“Š ì´ˆê¸° íˆ¬ìë¹„ìš© (CAPEX &amp; ê°œì—…ì¤€ë¹„)</summary>
  <div class="collapsible-content">

<div class="financial-section">
  <h3>[1] ì´ˆê¸° íˆ¬ìë¹„ (CAPEX) - ë‹¨ìœ„: ë§Œì›</h3>
  <table class="financial-table" id="capexTable">
    <thead>
      <tr>
        <th class="item-name">í•­ëª©</th>
        <th class="item-value">ê¸ˆì•¡ (ë§Œì›)</th>
        <th class="item-actions">ì‘ì—…</th>
      </tr>
    </thead>
    <tbody>
      <!-- í† ì§€ë¹„ìš© í‘œì‹œ í–‰ (í´ë¦­í•˜ë©´ ìƒì„¸ ê³„ì‚° ì˜ì—­ í† ê¸€) -->
      <tr class="land-cost-row" style="background: #e8f8f0; cursor: pointer;" onclick="toggleLandCalcDetails()" title="í´ë¦­í•˜ì—¬ ìƒì„¸ ê³„ì‚° ë³´ê¸°/ìˆ¨ê¸°ê¸°">
        <td style="position: relative;">
          <span id="landCalcToggleIcon" style="display: inline-block; margin-right: 8px; transition: transform 0.3s; transform: rotate(-90deg);">â–¶</span>
          <input type="text" value="í† ì§€ ë§¤ì…ë¹„" readonly style="background-color: transparent; cursor: pointer; border: none; font-weight: 600; display: inline; width: auto;">
        </td>
        <td><input type="text" id="landCostInput" value="71,400" readonly style="background-color: transparent; cursor: pointer; font-weight: 700; color: #27ae60; border: none; font-size: 15px;"></td>
        <td><span style="color: #27ae60; font-size: 11px; font-weight: 600;">âœ“ ìë™ê³„ì‚°</span></td>
      </tr>
      <!-- í† ì§€ë¹„ìš© ìë™ ê³„ì‚° ìƒì„¸ ì˜ì—­ (í† ê¸€ ê°€ëŠ¥) -->
      <tr class="land-calc-header" id="landCalcDetails" style="background: linear-gradient(135deg, rgb(232, 244, 248) 0%, rgb(212, 233, 247) 100%); display: none;">
        <td colspan="3" style="padding: 15px;">
          <div style="font-weight: 700; color: #2c3e50; font-size: 14px; margin-bottom: 12px;">ğŸï¸ í† ì§€ ë§¤ì…ë¹„ ìƒì„¸ ê³„ì‚°</div>
          
          <!-- í† ì§€ í•­ëª© í…Œì´ë¸” -->
          <table style="width: 100%; border-collapse: collapse; margin-bottom: 10px; background: white; border-radius: 4px; overflow: hidden;">
            <thead>
              <tr style="background: #f5f5f5;">
                <th style="padding: 8px; text-align: left; border: 1px solid #ddd; font-size: 12px;">í† ì§€ëª…</th>
                <th style="padding: 8px; text-align: center; border: 1px solid #ddd; font-size: 12px;">ê³µì‹œì§€ê°€<br>(ì›/mÂ²)</th>
                <th style="padding: 8px; text-align: center; border: 1px solid #ddd; font-size: 12px;">ë©´ì <br>(mÂ²)</th>
                <th style="padding: 8px; text-align: center; border: 1px solid #ddd; font-size: 12px;">ì‹¤ê±°ë˜ë¹„ìœ¨</th>
                <th style="padding: 8px; text-align: center; border: 1px solid #ddd; font-size: 12px;">ë§¤ì…ë¹„<br>(ë§Œì›)</th>
                <th style="padding: 8px; text-align: center; border: 1px solid #ddd; font-size: 12px; width: 80px;">ì‘ì—…</th>
              </tr>
            </thead>
            <tbody id="landPurchaseTable">
              <tr>
                <td style="padding: 6px; border: 1px solid #ddd;"><input type="text" value="ê¸€ë¨í•‘ ë¶€ì§€" style="width: 100%; padding: 4px; border: 1px solid #ccc; border-radius: 3px; font-size: 12px;"></td>
                <td style="padding: 6px; border: 1px solid #ddd;"><input type="number" value="255000" style="width: 100%; padding: 4px; border: 1px solid #ccc; border-radius: 3px; font-size: 12px; text-align: right;" oninput="calculateLandCost()"></td>
                <td style="padding: 6px; border: 1px solid #ddd;"><input type="number" value="2000" style="width: 100%; padding: 4px; border: 1px solid #ccc; border-radius: 3px; font-size: 12px; text-align: center;" oninput="calculateLandCost()"></td>
                <td style="padding: 6px; border: 1px solid #ddd;"><input type="number" value="1.4" step="0.1" style="width: 100%; padding: 4px; border: 1px solid #ccc; border-radius: 3px; font-size: 12px; text-align: center;" oninput="calculateLandCost()"></td>
                <td style="padding: 6px; border: 1px solid #ddd; text-align: right; font-weight: 600; color: #27ae60;" class="land-cost-amount">71,400</td>
                <td style="padding: 6px; border: 1px solid #ddd; text-align: center;"><button class="btn-small btn-delete" onclick="deleteLandPurchase(this)" style="font-size: 11px; padding: 3px 8px;">ì‚­ì œ</button></td>
              </tr>
            </tbody>
          </table>
          
          <button class="btn-small btn-add" onclick="addLandPurchase()" style="margin-top: 8px;">+ í† ì§€ í•­ëª© ì¶”ê°€</button>
          
          <div style="margin-top: 10px; padding: 8px; background: white; border-radius: 4px; font-weight: 600; color: #27ae60; text-align: right; border: 2px solid #27ae60;">
            ì´ í† ì§€ ë§¤ì…ë¹„: <span id="totalLandCost">71,400</span> ë§Œì›
          </div>
          
          <div style="margin-top: 8px; color: #555; font-size: 11px;">
            ğŸ’¡ <strong>ê³„ì‚°ì‹:</strong> ê³µì‹œì§€ê°€ Ã— ë©´ì  Ã— ì‹¤ê±°ë˜ë¹„ìœ¨ Ã· 10,000
          </div>
        </td>
      </tr>
      <tr>
        <td><input type="text" value="ë¶€ì§€ ì¡°ì„±ë¹„(í† ëª©)"></td>
        <td><input type="text" value="20,000"></td>
        <td><button class="btn-small btn-delete" onclick="deleteFinancialRow(this)">ì‚­ì œ</button></td>
      </tr>
      <tr>
        <td><input type="text" value="ê¸€ë¨í•‘ ì‹œì„¤ ì„¤ì¹˜ë¹„"></td>
        <td><input type="text" value="20,000"></td>
        <td><button class="btn-small btn-delete" onclick="deleteFinancialRow(this)">ì‚­ì œ</button></td>
      </tr>
      <tr>
        <td><input type="text" value="ê³µìš©ì‹œì„¤(ê´€ë¦¬ë™, í™”ì¥ì‹¤ ë“±)"></td>
        <td><input type="text" value="10,000"></td>
        <td><button class="btn-small btn-delete" onclick="deleteFinancialRow(this)">ì‚­ì œ</button></td>
      </tr>
      <tr>
        <td><input type="text" value="ì„¤ê³„Â·ì¸í—ˆê°€ ë¹„ìš©"></td>
        <td><input type="text" value="5,000"></td>
        <td><button class="btn-small btn-delete" onclick="deleteFinancialRow(this)">ì‚­ì œ</button></td>
      </tr>
      
      
    <tr>
    <td><input type="text" placeholder="í•­ëª©ëª… ì…ë ¥" value="í–‰ì •ë¹„ìš©"></td>
    <td><input type="text" value="2,000"></td>
    <td><button class="btn-small btn-delete" onclick="deleteFinancialRow(this)">ì‚­ì œ</button></td>
  </tr></tbody>
  </table>
  <button class="btn-small btn-add" onclick="addFinancialRow('capexTable')">+ í•­ëª© ì¶”ê°€</button>
  <div class="financial-summary">í•©ê³„: <span id="capexSum">128,400</span> ë§Œì› (<span id="capexSumBillion">12.84</span> ì–µì›)</div>
</div>

<div class="financial-section">
  <h3>[2] ê°œì—… ì „ ë¹„ìš© (Pre-opening Cost) - ë‹¨ìœ„: ë§Œì›</h3>
  <table class="financial-table" id="preopeningTable">
    <thead>
      <tr>
        <th class="item-name">í•­ëª©</th>
        <th class="item-value">ê¸ˆì•¡ (ë§Œì›)</th>
        <th class="item-actions">ì‘ì—…</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td><input type="text" value="ì˜¤í”ˆ ì¤€ë¹„ ì¸ê±´ë¹„"></td>
        <td><input type="text" value="2,000"></td>
        <td><button class="btn-small btn-delete" onclick="deleteFinancialRow(this)">ì‚­ì œ</button></td>
      </tr>
      <tr>
        <td><input type="text" value="ì´ˆê¸° ë§ˆì¼€íŒ… ë¹„ìš©"></td>
        <td><input type="text" value="300"></td>
        <td><button class="btn-small btn-delete" onclick="deleteFinancialRow(this)">ì‚­ì œ</button></td>
      </tr>
      <tr>
        <td><input type="text" value="ì‹œìš´ì˜ ë¹„ìš©"></td>
        <td><input type="text" value="300"></td>
        <td><button class="btn-small btn-delete" onclick="deleteFinancialRow(this)">ì‚­ì œ</button></td>
      </tr>
      
      
    </tbody>
  </table>
  <button class="btn-small btn-add" onclick="addFinancialRow('preopeningTable')">+ í•­ëª© ì¶”ê°€</button>
  <div class="financial-summary">í•©ê³„: <span id="preopeningSum">2,600</span> ë§Œì› (<span id="preopeningSumBillion">0.26</span> ì–µì›)</div>
</div>

  </div>
</details>

<details class="collapsible-section">
  <summary>ğŸ“Š ìš´ì˜ë¹„ìš© (ê³ ì •ë¹„, ë³€ë™ë¹„ &amp; ì„¸ê¸ˆ)</summary>
  <div class="collapsible-content">

<div class="financial-section">
  <h3>[3] ìš´ì˜ ê³ ì •ë¹„ (ì—°ê°„ ê¸°ì¤€) - ë‹¨ìœ„: ë§Œì›/ë…„</h3>
  <table class="financial-table" id="fixedCostTable">
    <thead>
      <tr>
        <th class="item-name">í•­ëª©</th>
        <th class="item-value">ê¸ˆì•¡ (ë§Œì›/ë…„)</th>
        <th class="item-actions">ì‘ì—…</th>
      </tr>
    </thead>
    <tbody>
      <!-- ê°ê°€ìƒê°ë¹„ í‘œì‹œ í–‰ (í´ë¦­í•˜ë©´ ìƒì„¸ ê³„ì‚° ì˜ì—­ í† ê¸€) -->
      <tr class="depreciation-row" style="background: #fff3e0; cursor: pointer;" onclick="toggleDepreciationDetails()" title="í´ë¦­í•˜ì—¬ ìƒì„¸ ê³„ì‚° ë³´ê¸°/ìˆ¨ê¸°ê¸°">
        <td style="position: relative;">
          <span id="depreciationToggleIcon" style="display: inline-block; margin-right: 8px; transition: transform 0.3s; transform: rotate(-90deg);">â–¶</span>
          <input type="text" value="ê°ê°€ìƒê°ë¹„" readonly="" style="background-color: transparent; cursor: pointer; border: none; font-weight: 600; display: inline; width: auto;">
        </td>
        <td><input type="text" id="depreciationInput" value="2,700" readonly="" style="background-color: transparent; cursor: pointer; font-weight: 700; color: #ff6f00; border: none; font-size: 15px;"></td>
        <td><span style="color: #ff6f00; font-size: 11px; font-weight: 600;">âœ“ ìë™ê³„ì‚°</span></td>
      </tr>
      <!-- ê°ê°€ìƒê°ë¹„ ìë™ ê³„ì‚° ìƒì„¸ ì˜ì—­ (í† ê¸€ ê°€ëŠ¥) -->
      <tr class="depreciation-header" id="depreciationDetails" style="background: linear-gradient(135deg, rgb(255, 243, 224) 0%, rgb(255, 224, 178) 100%); display: none;">
        <td colspan="3" style="padding: 15px;">
          <div style="font-weight: 700; color: #e65100; font-size: 14px; margin-bottom: 12px;">ğŸ“Š ê°ê°€ìƒê°ë¹„ ìƒì„¸ ê³„ì‚°</div>
          
          <!-- ê°ê°€ìƒê° ìì‚° í…Œì´ë¸” -->
          <table style="width: 100%; border-collapse: collapse; margin-bottom: 10px; background: white; border-radius: 4px; overflow: hidden;">
            <thead>
              <tr style="background: #f5f5f5;">
                <th style="padding: 8px; text-align: left; border: 1px solid #ddd; font-size: 12px;">ìì‚°ëª…</th>
                <th style="padding: 8px; text-align: center; border: 1px solid #ddd; font-size: 12px;">ì·¨ë“ê°€ì•¡<br>(ë§Œì›)</th>
                <th style="padding: 8px; text-align: center; border: 1px solid #ddd; font-size: 12px;">ë‚´ìš©ì—°ìˆ˜<br>(ë…„)</th>
                <th style="padding: 8px; text-align: center; border: 1px solid #ddd; font-size: 12px;">ìƒê°ë°©ë²•</th>
                <th style="padding: 8px; text-align: center; border: 1px solid #ddd; font-size: 12px;">ì—°ê°„ ìƒê°ë¹„<br>(ë§Œì›)</th>
                <th style="padding: 8px; text-align: center; border: 1px solid #ddd; font-size: 12px; width: 80px;">ì‘ì—…</th>
              </tr>
            </thead>
            <tbody id="depreciationAssetsTable">
              <tr>
                <td style="padding: 6px; border: 1px solid #ddd;"><input type="text" value="ê¸€ë¨í•‘ ì‹œì„¤" style="width: 100%; padding: 4px; border: 1px solid #ccc; border-radius: 3px; font-size: 12px;"></td>
                <td style="padding: 6px; border: 1px solid #ddd;"><input type="number" value="20000" style="width: 100%; padding: 4px; border: 1px solid rgb(204, 204, 204); border-radius: 3px; font-size: 12px; text-align: right; color: rgb(51, 51, 51); background-color: rgb(255, 255, 255);" oninput="calculateDepreciation()"></td>
                <td style="padding: 6px; border: 1px solid #ddd;"><input type="number" value="10" style="width: 100%; padding: 4px; border: 1px solid #ccc; border-radius: 3px; font-size: 12px; text-align: center;" oninput="calculateDepreciation()"></td>
                <td style="padding: 6px; border: 1px solid #ddd;">
                  <select style="width: 100%; padding: 4px; border: 1px solid #ccc; border-radius: 3px; font-size: 12px;" onchange="calculateDepreciation()">
                    <option value="straight" selected="selected">ì •ì•¡ë²•</option>
                    <option value="declining">ì •ë¥ ë²•</option>
                  </select>
                </td>
                <td style="padding: 6px; border: 1px solid #ddd; text-align: right; font-weight: 600; color: #ff6f00;" class="depreciation-amount">1,800</td>
                <td style="padding: 6px; border: 1px solid #ddd; text-align: center;"><button class="btn-small btn-delete" onclick="deleteDepreciationAsset(this)" style="font-size: 11px; padding: 3px 8px;">ì‚­ì œ</button></td>
              </tr>
              
              <tr>
                <td style="padding: 6px; border: 1px solid #ddd;"><input type="text" value="ê³µìš©ì‹œì„¤" style="width: 100%; padding: 4px; border: 1px solid #ccc; border-radius: 3px; font-size: 12px;"></td>
                <td style="padding: 6px; border: 1px solid #ddd;"><input type="number" value="10000" style="width: 100%; padding: 4px; border: 1px solid rgb(204, 204, 204); border-radius: 3px; font-size: 12px; text-align: right; color: rgb(51, 51, 51); background-color: rgb(255, 255, 255);" oninput="calculateDepreciation()"></td>
                <td style="padding: 6px; border: 1px solid #ddd;"><input type="number" value="10" style="width: 100%; padding: 4px; border: 1px solid #ccc; border-radius: 3px; font-size: 12px; text-align: center;" oninput="calculateDepreciation()"></td>
                <td style="padding: 6px; border: 1px solid #ddd;">
                  <select style="width: 100%; padding: 4px; border: 1px solid #ccc; border-radius: 3px; font-size: 12px;" onchange="calculateDepreciation()">
                    <option value="straight" selected="selected">ì •ì•¡ë²•</option>
                    <option value="declining">ì •ë¥ ë²•</option>
                  </select>
                </td>
                <td style="padding: 6px; border: 1px solid #ddd; text-align: right; font-weight: 600; color: #ff6f00;" class="depreciation-amount">900</td>
                <td style="padding: 6px; border: 1px solid #ddd; text-align: center;"><button class="btn-small btn-delete" onclick="deleteDepreciationAsset(this)" style="font-size: 11px; padding: 3px 8px;">ì‚­ì œ</button></td>
              </tr>
              
            </tbody>
          </table>
          
          <button class="btn-small btn-add" onclick="addDepreciationAsset()" style="margin-top: 8px;">+ ìì‚° í•­ëª© ì¶”ê°€</button>
          
          <div style="margin-top: 10px; padding: 8px; background: white; border-radius: 4px; font-weight: 600; color: #e65100; text-align: right; border: 2px solid #ff6f00;">
            ì´ ê°ê°€ìƒê°ë¹„: <span id="totalDepreciation">2,700</span> ë§Œì›/ë…„
          </div>
          
          <div style="margin-top: 8px; color: #555; font-size: 11px;">
            ğŸ’¡ <strong>ì •ì•¡ë²•:</strong> ì·¨ë“ê°€ì•¡ Ã· ë‚´ìš©ì—°ìˆ˜ (ì”ì¡´ê°€ì¹˜ 0) | <strong>ì •ë¥ ë²•:</strong> ì·¨ë“ê°€ì•¡ Ã— ìƒê°ë¥ (ê·¼ì‚¬ì¹˜ ì‚¬ìš©, ì”ì¡´ê°€ì¹˜ 0)
          </div>
        </td>
      </tr>
      <tr>
        <td><input type="text" value="ì¸ê±´ë¹„"></td>
        <td><input type="text" value="4,000"></td>
        <td><button class="btn-small btn-delete" onclick="deleteFinancialRow(this)">ì‚­ì œ</button></td>
      </tr>
      
      <tr>
        <td><input type="text" value="ë³´í—˜ë£Œ"></td>
        <td><input type="text" value="400"></td>
        <td><button class="btn-small btn-delete" onclick="deleteFinancialRow(this)">ì‚­ì œ</button></td>
      </tr>
      <tr>
        <td><input type="text" value="ê³µê³¼ê¸ˆ ê¸°ë³¸ìš”ê¸ˆ"></td>
        <td><input type="text" value="120"></td>
        <td><button class="btn-small btn-delete" onclick="deleteFinancialRow(this)">ì‚­ì œ</button></td>
      </tr>
      <tr>
        <td><input type="text" value="ê´€ë¦¬ë¹„(í†µì‹ , ì‹œìŠ¤í…œ ë“±)"></td>
        <td><input type="text" value="120"></td>
        <td><button class="btn-small btn-delete" onclick="deleteFinancialRow(this)">ì‚­ì œ</button></td>
      </tr>
    <tr>
    <td><input type="text" placeholder="í•­ëª©ëª… ì…ë ¥" value="ì•ˆì „ì ê²€ë¹„"></td>
    <td><input type="text" value="275"></td>
    <td><button class="btn-small btn-delete" onclick="deleteFinancialRow(this)">ì‚­ì œ</button></td>
  </tr></tbody>
  </table>
  <button class="btn-small btn-add" onclick="addFinancialRow('fixedCostTable')">+ í•­ëª© ì¶”ê°€</button>
  <div class="financial-summary">í•©ê³„: <span id="fixedCostSum">37,615</span> ë§Œì›/ë…„ (<span id="fixedCostSumBillion">3.76</span> ì–µì›/ë…„)</div>
</div>

<div class="financial-section">
  <h3>[4] ìš´ì˜ ë³€ë™ë¹„ (ì—°ê°„ ê¸°ì¤€) - ë‹¨ìœ„: ë§Œì›/ë…„</h3>
  <table class="financial-table" id="variableCostTable">
    <thead>
      <tr>
        <th class="item-name">í•­ëª©</th>
        <th class="item-value">ê¸ˆì•¡ (ë§Œì›/ë…„)</th>
        <th class="item-actions">ì‘ì—…</th>
      </tr>
    </thead>
    <tbody>
      
      <tr>
        <td><input type="text" value="ë§ˆì¼€íŒ…ë¹„"></td>
        <td><input type="text" value="300"></td>
        <td><button class="btn-small btn-delete" onclick="deleteFinancialRow(this)">ì‚­ì œ</button></td>
      </tr>
      
      <tr>
        <td><input type="text" value="ì—ë„ˆì§€ ë¹„ìš©(ì „ë ¥ë¹„,ìš©ìˆ˜ë¹„)"></td>
        <td><input type="text" value="1,300"></td>
        <td><button class="btn-small btn-delete" onclick="deleteFinancialRow(this)">ì‚­ì œ</button></td>
      </tr>
      
    <tr>
    <td><input type="text" placeholder="í•­ëª©ëª… ì…ë ¥" value="ì‹œì„¤ìš´ì˜ìœ ì§€ë¹„(ìˆ˜ë¦¬ìˆ˜ì„ ë¹„)"></td>
    <td><input type="text" value="200"></td>
    <td><button class="btn-small btn-delete" onclick="deleteFinancialRow(this)">ì‚­ì œ</button></td>
  </tr><tr>
    <td><input type="text" placeholder="í•­ëª©ëª… ì…ë ¥" value="ì†Œëª¨í’ˆë¹„ "></td>
    <td><input type="text" value="320"></td>
    <td><button class="btn-small btn-delete" onclick="deleteFinancialRow(this)">ì‚­ì œ</button></td>
  </tr><tr>
    <td><input type="text" placeholder="í•­ëª©ëª… ì…ë ¥" value=""></td>
    <td><input type="text" value="0"></td>
    <td><button class="btn-small btn-delete" onclick="deleteFinancialRow(this)">ì‚­ì œ</button></td>
  </tr></tbody>
  </table>
  <button class="btn-small btn-add" onclick="addFinancialRow('variableCostTable')">+ í•­ëª© ì¶”ê°€</button>
  <div class="financial-summary">í•©ê³„: <span id="variableCostSum">1,820</span> ë§Œì›/ë…„ (<span id="variableCostSumBillion">0.18</span> ì–µì›/ë…„)</div>
</div>

<div class="financial-section">
  <h3>[5] ê¸ˆìœµ ë° ì„¸ê¸ˆ</h3>
  <table class="financial-table" id="financeTable">
    <thead>
      <tr>
        <th class="item-name">í•­ëª©</th>
        <th class="item-value">ê°’</th>
        <th class="item-actions">ì‘ì—…</th>
      </tr>
    </thead>
    <tbody>
      <!-- ì°¨ì…ê¸ˆ ì´ì í‘œì‹œ í–‰ (í´ë¦­í•˜ë©´ ìƒì„¸ ê³„ì‚° ì˜ì—­ í† ê¸€) -->
      <tr class="loan-interest-row" style="background: #e3f2fd; cursor: pointer;" onclick="toggleLoanInterestDetails()" title="í´ë¦­í•˜ì—¬ ìƒì„¸ ê³„ì‚° ë³´ê¸°/ìˆ¨ê¸°ê¸°">
        <td style="position: relative;">
          <span id="loanInterestToggleIcon" style="display: inline-block; margin-right: 8px; transition: transform 0.3s; transform: rotate(-90deg);">â–¶</span>
          <input type="text" value="ì°¨ì…ê¸ˆ ì´ì" readonly style="background-color: transparent; cursor: pointer; border: none; font-weight: 600; display: inline; width: auto;">
        </td>
        <td><input type="text" id="loanInterestInput" value="0" readonly style="background-color: transparent; cursor: pointer; font-weight: 700; color: #1976d2; border: none; font-size: 15px;"></td>
        <td><span style="color: #1976d2; font-size: 11px; font-weight: 600;">âœ“ ìë™ê³„ì‚°</span></td>
      </tr>
      <!-- ì°¨ì…ê¸ˆ ì´ì ìë™ ê³„ì‚° ìƒì„¸ ì˜ì—­ (í† ê¸€ ê°€ëŠ¥) -->
      <tr class="loan-interest-header" id="loanInterestDetails" style="background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%); display: none;">
        <td colspan="3" style="padding: 15px;">
          <div style="font-weight: 700; color: #1565c0; font-size: 14px; margin-bottom: 12px;">ğŸ’° ì°¨ì…ê¸ˆ ì´ì ìƒì„¸ ê³„ì‚°</div>
          
          <!-- ì°¨ì…ê¸ˆ í•­ëª© í…Œì´ë¸” -->
          <table style="width: 100%; border-collapse: collapse; margin-bottom: 10px; background: white; border-radius: 4px; overflow: hidden;">
            <thead>
              <tr style="background: #f5f5f5;">
                <th style="padding: 8px; text-align: left; border: 1px solid #ddd; font-size: 12px;">ì°¨ì…ê¸ˆëª…</th>
                <th style="padding: 8px; text-align: center; border: 1px solid #ddd; font-size: 12px;">ì°¨ì…ê¸ˆì•¡<br>(ë§Œì›)</th>
                <th style="padding: 8px; text-align: center; border: 1px solid #ddd; font-size: 12px;">ì´ììœ¨<br>(%)</th>
                <th style="padding: 8px; text-align: center; border: 1px solid #ddd; font-size: 12px;">ì—°ê°„ ì´ìë¹„ìš©<br>(ë§Œì›)</th>
                <th style="padding: 8px; text-align: center; border: 1px solid #ddd; font-size: 12px; width: 80px;">ì‘ì—…</th>
              </tr>
            </thead>
            <tbody id="loanInterestTable">
              <tr>
                <td style="padding: 6px; border: 1px solid #ddd;"><input type="text" value="ì‚¬ì—…ë¹„ ëŒ€ì¶œ" style="width: 100%; padding: 4px; border: 1px solid #ccc; border-radius: 3px; font-size: 12px;"></td>
                <td style="padding: 6px; border: 1px solid #ddd;"><input type="number" value="0" style="width: 100%; padding: 4px; border: 1px solid #ccc; border-radius: 3px; font-size: 12px; text-align: right;" oninput="calculateLoanInterest()"></td>
                <td style="padding: 6px; border: 1px solid #ddd;"><input type="number" value="4.5" step="0.1" style="width: 100%; padding: 4px; border: 1px solid #ccc; border-radius: 3px; font-size: 12px; text-align: center;" oninput="calculateLoanInterest()"></td>
                <td style="padding: 6px; border: 1px solid #ddd; text-align: right; font-weight: 600; color: #1976d2;" class="loan-interest-amount">0</td>
                <td style="padding: 6px; border: 1px solid #ddd; text-align: center;"><button class="btn-small btn-delete" onclick="deleteLoanInterest(this)" style="font-size: 11px; padding: 3px 8px;">ì‚­ì œ</button></td>
              </tr>
            </tbody>
          </table>
          
          <button class="btn-small btn-add" onclick="addLoanInterest()" style="margin-top: 8px;">+ ì°¨ì…ê¸ˆ í•­ëª© ì¶”ê°€</button>
          
          <div style="margin-top: 10px; padding: 8px; background: white; border-radius: 4px; font-weight: 600; color: #1565c0; text-align: right; border: 2px solid #1976d2;">
            ì´ ì—°ê°„ ì´ìë¹„ìš©: <span id="totalLoanInterest">0</span> ë§Œì›/ë…„
          </div>
          
          <div style="margin-top: 8px; color: #555; font-size: 11px;">
            ğŸ’¡ <strong>ê³„ì‚°ì‹:</strong> ì°¨ì…ê¸ˆ Ã— ì´ììœ¨ Ã· 100
          </div>
        </td>
      </tr>
      <tr>
        <td><input type="text" value="ë¶€ê°€ì„¸ (%)" readonly="" style="background-color: #f0f0f0; cursor: not-allowed;"></td>
        <td><input type="text" value="10" readonly="" style="background-color: #f0f0f0; cursor: not-allowed;"></td>
        <td><span style="color: #999; font-size: 12px;">ê³ ì •</span></td>
      </tr>
      <tr>
        <td><input type="text" value="ë²•ì¸ì„¸ìœ¨ (%)"></td>
        <td><input type="text" value="22"></td>
        <td><button class="btn-small btn-delete" onclick="deleteFinancialRow(this)">ì‚­ì œ</button></td>
      </tr>
    </tbody>
  </table>
  <button class="btn-small btn-add" onclick="addFinancialRow('financeTable')">+ í•­ëª© ì¶”ê°€</button>
</div>

  </div>
</details>

<details class="collapsible-section">
  <summary>ğŸ’° ë§¤ì¶œìˆ˜ìµ ì˜ˆìƒì˜ì—­ (ìš´ì˜ í•­ëª© ë° ê²°ê³¼í‘œ)</summary>
  <div class="collapsible-content">

<hr style="margin:30px 0; border:none; border-top:2px solid #ddd;">

<h3>[6] ê¸€ë¨í•‘ ì£¼ìš” ë§¤ì¶œ</h3>

<input id="gWeight" type="hidden" value="0.37">


<h3>ìš´ì˜ í•­ëª© ì…ë ¥í‘œ</h3>
<table id="glampingTable" class="grid">
  <thead>
    <tr>
      <th></th>
      <th>í‰ì¼</th>
      <th>ì£¼ë§</th>
      <th>ê³µíœ´ì¼(ì—°íœ´)</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>ê¸°ì¤€2ì¸</th>
      <td><input type="text" value="150,000"></td>
      <td><input type="text" value="220,000"></td>
      <td><input type="text" value="220,000"></td>
    </tr>
    <tr>
      <th>ì¶”ê°€ì¸ì›(+1)</th>
      <td><input type="text" value="180,000"></td>
      <td><input type="text" value="250,000"></td>
      <td><input type="text" value="250,000"></td>
    </tr>
    <tr>
      <th>ì¶”ê°€ì¸ì›(+2)</th>
      <td><input type="text" value="210,000"></td>
      <td><input type="text" value="280,000"></td>
      <td><input type="text" value="280,000"></td>
    </tr>
  </tbody>
</table>

<!-- ì˜ˆìƒ ê°€ë™ë¥  ì„¤ì • í‘œ -->
<h3>ê°€ë™ë¥  ì„¤ì •</h3>
<table id="occSettings" class="grid">
  <thead>
    <tr><th colspan="4">ê°€ë™ë¥  ì„¤ì •</th></tr>
    <tr>
      <th></th>
      <th>ê¸ì •ì•ˆ</th>
      <th>ì¤‘ë¦½ì•ˆ</th>
      <th>ë¶€ì •ì•ˆ</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>ì„±ìˆ˜ê¸°</th>
      <td><input type="number" id="occ_pos_high" value="90" step="0.1" min="0" max="100">%</td>
      <td><input type="number" id="occ_neu_high" value="80" step="0.1" min="0" max="100">%</td>
      <td><input type="number" id="occ_neg_high" value="70" step="0.1" min="0" max="100">%</td>
    </tr>
    <tr>
      <th>ì£¼ë§</th>
      <td><input type="number" id="occ_pos_weekend" value="90" step="0.1" min="0" max="100">%</td>
      <td><input type="number" id="occ_neu_weekend" value="50" step="0.1" min="0" max="100">%</td>
      <td><input type="number" id="occ_neg_weekend" value="45" step="0.1" min="0" max="100">%</td>
    </tr>
    <tr>
      <th>í‰ì¼</th>
      <td><input type="number" id="occ_pos_weekday" value="30" step="0.1" min="0" max="100">%</td>
      <td><input type="number" id="occ_neu_weekday" value="18" step="0.1" min="0" max="100">%</td>
      <td><input type="number" id="occ_neg_weekday" value="15" step="0.1" min="0" max="100">%</td>
    </tr>
  </tbody>
</table>

<h3>ì‹œë‚˜ë¦¬ì˜¤ë³„ ì „ê°œí‘œ</h3>
<div class="note" style="background:#e8f4f8; padding:10px; border-radius:6px; border-left:4px solid #3498db">
  <strong>ğŸ’¡ ê°€ì¤‘ì¹˜ ì„¤ì •:</strong> ì•„ë˜ ì‹œë‚˜ë¦¬ì˜¤ë³„ ì „ê°œí‘œì˜ ë‘ ë²ˆì§¸ í–‰(ê°€ì¤‘ì¹˜ ì¹¸)ì—ì„œ ì§ì ‘ ìˆ˜ì • ê°€ëŠ¥í•©ë‹ˆë‹¤. ëª¨ë“  ì‹œë‚˜ë¦¬ì˜¤ì— ë™ì¼í•˜ê²Œ ì ìš©ë©ë‹ˆë‹¤.
</div>
<div class="scenario">
  <label><input type="radio" name="scenario" value="positive" checked="checked"><span>ê¸ì •ì•ˆ</span></label>
  <label><input type="radio" name="scenario" value="neutral"><span>ì¤‘ë¦½ì•ˆ</span></label>
  <label><input type="radio" name="scenario" value="negative"><span>ë¶€ì •ì•ˆ</span></label>
</div>

<!-- ì´ë¯¸ì§€ ê¸°ë°˜ (3 ì‹œë‚˜ë¦¬ì˜¤): ê¸ì •/ì¤‘ë¦½/ë¶€ì • í‘œ -->
<div id="scenario_positive" class="scenarioTable" style="display: none;">
  <div><strong>ê¸ì •ì•ˆ</strong></div>
  <table class="large" id="scenario_positive_table">
    <caption><strong>ê¸€ë¨í•‘ ìˆ˜ìµ ì „ê°œí‘œ (ê¸ì •ì•ˆ - ì´ë¯¸ì§€ ê¸°ë°˜)</strong></caption>
    <thead>
      <tr>
        <th colspan="2">êµ¬ë¶„</th>
        <th rowspan="2">ì„ëŒ€ë£Œ(ì›)</th>
        <th rowspan="2">ì¼ìˆ˜</th>
        <th rowspan="2">ì—°ê°„ ì„ëŒ€ìˆ˜</th>
        <th rowspan="2">ì˜ˆìƒ ê°€ë™ìœ¨</th>
        <th rowspan="2">ì˜ˆìƒìˆ˜ì…(ì›)</th>
        <th colspan="2">ì¶”ê°€ì¸ì›</th>
        <th>ê°€ì¤‘ì¹˜</th>
        <th rowspan="2">ë¹„ê³ </th>
      </tr>
      <tr>
        <th>ì‹œì„¤ë³„</th>
        <th>ì‹œê¸°ë³„</th>
        <th>ì¶”ê°€ì¸ì›(1)</th>
        <th>ì¶”ê°€ì¸ì›(2)</th>
        <th class="weightHeader"><input type="number" step="0.01" min="0" value="0.37" style="width:60px;text-align:center;padding:4px;border:1px solid #3498db;border-radius:3px;font-weight:bold" onchange="updateWeightFromHeader(this.value)"></th>
      </tr>
    </thead>
    <tbody>
      <tr><td colspan="2">ì´ê³„</td><td></td><td>365</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr>
      <tr style="background:#f0f0f0"><td>ê¸€ë¨í•‘</td><td>ì†Œê³„</td><td></td><td>365</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr>

      <tr><td>(10)</td><td>ì„±ìˆ˜ê¸°</td><td>220</td><td>62</td><td></td><td>90%</td><td>122,760</td><td>16,740</td><td>33,480</td><td>18,581</td><td></td></tr>
      <tr><td></td><td>ì£¼ë§</td><td>220</td><td>88</td><td></td><td>90%</td><td>174,240</td><td>23,760</td><td>47,520</td><td>26,374</td><td></td></tr>
      <tr><td></td><td>í‰ì¼</td><td>150</td><td>215</td><td></td><td>30%</td><td>96,750</td><td>19,350</td><td>38,700</td><td>21,479</td><td></td></tr>

      <tr><td>(15)</td><td>ì„±ìˆ˜ê¸°</td><td>220</td><td>62</td><td></td><td>90%</td><td>184,140</td><td>25,110</td><td>50,220</td><td>27,872</td><td></td></tr>
      <tr><td></td><td>ì£¼ë§</td><td>220</td><td>88</td><td></td><td>90%</td><td>261,360</td><td>35,640</td><td>71,280</td><td>39,560</td><td></td></tr>
      <tr><td></td><td>í‰ì¼</td><td>150</td><td>215</td><td></td><td>30%</td><td>145,125</td><td>29,025</td><td>58,050</td><td>32,218</td><td></td></tr>

      <tr><td>(30)</td><td>ì„±ìˆ˜ê¸°</td><td>220</td><td>62</td><td></td><td>90%</td><td>368,280</td><td>50,220</td><td>100,440</td><td>55,744</td><td></td></tr>
      <tr><td></td><td>ì£¼ë§</td><td>220</td><td>88</td><td></td><td>90%</td><td>522,720</td><td>71,280</td><td>142,560</td><td>79,121</td><td></td></tr>
      <tr><td></td><td>í‰ì¼</td><td>150</td><td>215</td><td></td><td>30%</td><td>290,250</td><td>58,050</td><td>116,100</td><td>64,436</td><td></td></tr>

      <tr style="background:#f0f0f0"><td>ì¹´ë¼ë°˜</td><td>ì†Œê³„</td><td></td><td>365</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr>

      <tr><td>(5)</td><td>ì„±ìˆ˜ê¸°</td><td>220</td><td>62</td><td></td><td>90%</td><td>61,380</td><td>8,370</td><td>16,740</td><td>9,291</td><td></td></tr>
      <tr><td></td><td>ì£¼ë§</td><td>220</td><td>88</td><td></td><td>90%</td><td>87,120</td><td>11,880</td><td>23,760</td><td>13,187</td><td></td></tr>
      <tr><td></td><td>í‰ì¼</td><td>150</td><td>215</td><td></td><td>30%</td><td>48,375</td><td>9,675</td><td>19,350</td><td>10,739</td><td></td></tr>

      <tr><td colspan="11" style="background:#fff"><strong>í•©ê³„ / ë¹„ê³ </strong></td></tr>
    </tbody>
  </table>
</div>

<div id="scenario_neutral" class="scenarioTable" style="display: none;">
  <div><strong>ì¤‘ë¦½ì•ˆ</strong></div>
  <table class="large" id="scenario_neutral_table">
    <caption><strong>ê¸€ë¨í•‘ ìˆ˜ìµ ì „ê°œí‘œ (ê¸ì •ì•ˆ - ì´ë¯¸ì§€ ê¸°ë°˜)</strong></caption>
    <thead>
      <tr>
        <th colspan="2">êµ¬ë¶„</th>
        <th rowspan="2">ì„ëŒ€ë£Œ(ì›)</th>
        <th rowspan="2">ì¼ìˆ˜</th>
        <th rowspan="2">ì—°ê°„ ì„ëŒ€ìˆ˜</th>
        <th rowspan="2">ì˜ˆìƒ ê°€ë™ìœ¨</th>
        <th rowspan="2">ì˜ˆìƒìˆ˜ì…(ì›)</th>
        <th colspan="2">ì¶”ê°€ì¸ì›</th>
        <th>ê°€ì¤‘ì¹˜</th>
        <th rowspan="2">ë¹„ê³ </th>
      </tr>
      <tr>
        <th>ì‹œì„¤ë³„</th>
        <th>ì‹œê¸°ë³„</th>
        <th>ì¶”ê°€ì¸ì›(1)</th>
        <th>ì¶”ê°€ì¸ì›(2)</th>
        <th class="weightHeader"><input type="number" step="0.01" min="0" value="0.37" style="width:60px;text-align:center;padding:4px;border:1px solid #3498db;border-radius:3px;font-weight:bold" onchange="updateWeightFromHeader(this.value)"></th>
      </tr>
    </thead>
    <tbody>
      <tr><td colspan="2">ì´ê³„</td><td></td><td>365</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr>
      <tr style="background:#f0f0f0"><td>ê¸€ë¨í•‘</td><td>ì†Œê³„</td><td></td><td>365</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr>

      <tr><td>(10)</td><td>ì„±ìˆ˜ê¸°</td><td>220</td><td>62</td><td></td><td>80%</td><td>109,120</td><td>14,880</td><td>29,760</td><td>16,517</td><td></td></tr>
      <tr><td></td><td>ì£¼ë§</td><td>220</td><td>88</td><td></td><td>50%</td><td>96,800</td><td>13,200</td><td>26,400</td><td>14,652</td><td></td></tr>
      <tr><td></td><td>í‰ì¼</td><td>150</td><td>215</td><td></td><td>18%</td><td>58,050</td><td>11,610</td><td>23,220</td><td>12,887</td><td></td></tr>

      <tr><td>(15)</td><td>ì„±ìˆ˜ê¸°</td><td>220</td><td>62</td><td></td><td>80%</td><td>163,680</td><td>22,320</td><td>44,640</td><td>24,775</td><td></td></tr>
      <tr><td></td><td>ì£¼ë§</td><td>220</td><td>88</td><td></td><td>50%</td><td>145,200</td><td>19,800</td><td>39,600</td><td>21,978</td><td></td></tr>
      <tr><td></td><td>í‰ì¼</td><td>150</td><td>215</td><td></td><td>18%</td><td>87,075</td><td>17,415</td><td>34,830</td><td>19,331</td><td></td></tr>

      <tr><td>(30)</td><td>ì„±ìˆ˜ê¸°</td><td>220</td><td>62</td><td></td><td>80%</td><td>327,360</td><td>44,640</td><td>89,280</td><td>49,550</td><td></td></tr>
      <tr><td></td><td>ì£¼ë§</td><td>220</td><td>88</td><td></td><td>50%</td><td>290,400</td><td>39,600</td><td>79,200</td><td>43,956</td><td></td></tr>
      <tr><td></td><td>í‰ì¼</td><td>150</td><td>215</td><td></td><td>18%</td><td>174,150</td><td>34,830</td><td>69,660</td><td>38,661</td><td></td></tr>

      <tr style="background:#f0f0f0"><td>ì¹´ë¼ë°˜</td><td>ì†Œê³„</td><td></td><td>365</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr>

      <tr><td>(5)</td><td>ì„±ìˆ˜ê¸°</td><td>220</td><td>62</td><td></td><td>80%</td><td>54,560</td><td>7,440</td><td>14,880</td><td>8,258</td><td></td></tr>
      <tr><td></td><td>ì£¼ë§</td><td>220</td><td>88</td><td></td><td>50%</td><td>48,400</td><td>6,600</td><td>13,200</td><td>7,326</td><td></td></tr>
      <tr><td></td><td>í‰ì¼</td><td>150</td><td>215</td><td></td><td>18%</td><td>29,025</td><td>5,805</td><td>11,610</td><td>6,444</td><td></td></tr>

      <tr><td colspan="11" style="background:#fff"><strong>í•©ê³„ / ë¹„ê³ </strong></td></tr>
    </tbody>
  </table>
</div>

<div id="scenario_negative" class="scenarioTable" style="">
  <div><strong>ë¶€ì •ì•ˆ</strong></div>
  <table class="large" id="scenario_negative_table">
    <caption><strong>ê¸€ë¨í•‘ ìˆ˜ìµ ì „ê°œí‘œ (ê¸ì •ì•ˆ - ì´ë¯¸ì§€ ê¸°ë°˜)</strong></caption>
    <thead>
      <tr>
        <th colspan="2">êµ¬ë¶„</th>
        <th rowspan="2">ì„ëŒ€ë£Œ(ì›)</th>
        <th rowspan="2">ì¼ìˆ˜</th>
        <th rowspan="2">ì—°ê°„ ì„ëŒ€ìˆ˜</th>
        <th rowspan="2">ì˜ˆìƒ ê°€ë™ìœ¨</th>
        <th rowspan="2">ì˜ˆìƒìˆ˜ì…(ì›)</th>
        <th colspan="2">ì¶”ê°€ì¸ì›</th>
        <th>ê°€ì¤‘ì¹˜</th>
        <th rowspan="2">ë¹„ê³ </th>
      </tr>
      <tr>
        <th>ì‹œì„¤ë³„</th>
        <th>ì‹œê¸°ë³„</th>
        <th>ì¶”ê°€ì¸ì›(1)</th>
        <th>ì¶”ê°€ì¸ì›(2)</th>
        <th class="weightHeader"><input type="number" step="0.01" min="0" value="0.37" style="width:60px;text-align:center;padding:4px;border:1px solid #3498db;border-radius:3px;font-weight:bold" onchange="updateWeightFromHeader(this.value)"></th>
      </tr>
    </thead>
    <tbody>
      <tr><td colspan="2">ì´ê³„</td><td></td><td>365</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr>
      <tr style="background:#f0f0f0"><td>ê¸€ë¨í•‘</td><td>ì†Œê³„</td><td></td><td>365</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr>

      <tr><td>(10)</td><td>ì„±ìˆ˜ê¸°</td><td>220</td><td>62</td><td></td><td>70%</td><td>95,480</td><td>13,020</td><td>26,040</td><td>14,452</td><td></td></tr>
      <tr><td></td><td>ì£¼ë§</td><td>220</td><td>88</td><td></td><td>45%</td><td>87,120</td><td>11,880</td><td>23,760</td><td>13,187</td><td></td></tr>
      <tr><td></td><td>í‰ì¼</td><td>150</td><td>215</td><td></td><td>15%</td><td>48,375</td><td>9,675</td><td>19,350</td><td>10,739</td><td></td></tr>

      <tr><td>(15)</td><td>ì„±ìˆ˜ê¸°</td><td>220</td><td>62</td><td></td><td>70%</td><td>143,220</td><td>19,530</td><td>39,060</td><td>21,678</td><td></td></tr>
      <tr><td></td><td>ì£¼ë§</td><td>220</td><td>88</td><td></td><td>45%</td><td>130,680</td><td>17,820</td><td>35,640</td><td>19,780</td><td></td></tr>
      <tr><td></td><td>í‰ì¼</td><td>150</td><td>215</td><td></td><td>15%</td><td>72,563</td><td>14,513</td><td>29,025</td><td>16,109</td><td></td></tr>

      <tr><td>(30)</td><td>ì„±ìˆ˜ê¸°</td><td>220</td><td>62</td><td></td><td>70%</td><td>286,440</td><td>39,060</td><td>78,120</td><td>43,357</td><td></td></tr>
      <tr><td></td><td>ì£¼ë§</td><td>220</td><td>88</td><td></td><td>45%</td><td>261,360</td><td>35,640</td><td>71,280</td><td>39,560</td><td></td></tr>
      <tr><td></td><td>í‰ì¼</td><td>150</td><td>215</td><td></td><td>15%</td><td>145,125</td><td>29,025</td><td>58,050</td><td>32,218</td><td></td></tr>

      <tr style="background:#f0f0f0"><td>ì¹´ë¼ë°˜</td><td>ì†Œê³„</td><td></td><td>365</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr>

      <tr><td>(5)</td><td>ì„±ìˆ˜ê¸°</td><td>220</td><td>62</td><td></td><td>70%</td><td>47,740</td><td>6,510</td><td>13,020</td><td>7,226</td><td></td></tr>
      <tr><td></td><td>ì£¼ë§</td><td>220</td><td>88</td><td></td><td>45%</td><td>43,560</td><td>5,940</td><td>11,880</td><td>6,593</td><td></td></tr>
      <tr><td></td><td>í‰ì¼</td><td>150</td><td>215</td><td></td><td>15%</td><td>24,188</td><td>4,838</td><td>9,675</td><td>5,370</td><td></td></tr>

      <tr><td colspan="11" style="background:#fff"><strong>í•©ê³„ / ë¹„ê³ </strong></td></tr>
    </tbody>
  </table>
</div>

<!-- Scenario summary: per-scenario compact tables -->
<div id="scenarioSummaries" style="margin-top:16px; display:flex; gap:12px; flex-wrap:wrap">
  <div style="flex:1; min-width:300px">
    <h4>ê¸ì •ì•ˆ ìš”ì•½</h4>
    <table class="grid" id="summary_positive" style="font-size:12px">
      <thead><tr><th>ëŒ€ìˆ˜</th><th>ê¸€ë¨í•‘ ë‹¨ë…</th><th>+ê°€ì¤‘ì¹˜</th><th>+ì¹´ë¼ë°˜5ëŒ€</th><th>+ì¹´ë¼ë°˜+ê°€ì¤‘ì¹˜</th></tr></thead>
      <tbody>
        <tr><td>10ëŒ€</td><td class="sp_10">393,750</td><td class="sp_10_w">460,184</td><td class="sp_10_p">590,625</td><td class="sp_10_pw">690,276</td></tr>
        <tr><td>15ëŒ€</td><td class="sp_15">590,625</td><td class="sp_15_w">690,275</td><td class="sp_15_p">787,500</td><td class="sp_15_pw">920,367</td></tr>
        <tr><td>30ëŒ€</td><td class="sp_30">1,181,250</td><td class="sp_30_w">1,380,551</td><td class="sp_30_p">1,378,125</td><td class="sp_30_pw">1,610,643</td></tr>
      </tbody>
    </table>
  </div>
  <div style="flex:1; min-width:300px">
    <h4>ì¤‘ë¦½ì•ˆ ìš”ì•½</h4>
    <table class="grid" id="summary_neutral" style="font-size:12px">
      <thead><tr><th>ëŒ€ìˆ˜</th><th>ê¸€ë¨í•‘ ë‹¨ë…</th><th>+ê°€ì¤‘ì¹˜</th><th>+ì¹´ë¼ë°˜5ëŒ€</th><th>+ì¹´ë¼ë°˜+ê°€ì¤‘ì¹˜</th></tr></thead>
      <tbody>
        <tr><td>10ëŒ€</td><td class="sn_10">263,970</td><td class="sn_10_w">308,026</td><td class="sn_10_p">395,955</td><td class="sn_10_pw">462,039</td></tr>
        <tr><td>15ëŒ€</td><td class="sn_15">395,955</td><td class="sn_15_w">462,039</td><td class="sn_15_p">527,940</td><td class="sn_15_pw">616,052</td></tr>
        <tr><td>30ëŒ€</td><td class="sn_30">791,910</td><td class="sn_30_w">924,077</td><td class="sn_30_p">923,895</td><td class="sn_30_pw">1,078,090</td></tr>
      </tbody>
    </table>
  </div>
  <div style="flex:1; min-width:300px">
    <h4>ë¶€ì •ì•ˆ ìš”ì•½</h4>
    <table class="grid" id="summary_negative" style="font-size:12px">
      <thead><tr><th>ëŒ€ìˆ˜</th><th>ê¸€ë¨í•‘ ë‹¨ë…</th><th>+ê°€ì¤‘ì¹˜</th><th>+ì¹´ë¼ë°˜5ëŒ€</th><th>+ì¹´ë¼ë°˜+ê°€ì¤‘ì¹˜</th></tr></thead>
      <tbody>
        <tr><td>10ëŒ€</td><td class="sg_10">230,975</td><td class="sg_10_w">269,353</td><td class="sg_10_p">346,463</td><td class="sg_10_pw">404,030</td></tr>
        <tr><td>15ëŒ€</td><td class="sg_15">346,463</td><td class="sg_15_w">404,030</td><td class="sg_15_p">461,951</td><td class="sg_15_pw">538,707</td></tr>
        <tr><td>30ëŒ€</td><td class="sg_30">692,925</td><td class="sg_30_w">808,060</td><td class="sg_30_p">808,413</td><td class="sg_30_pw">942,737</td></tr>
      </tbody>
    </table>
  </div>
</div>

<button id="glampingAnalyze">ê¸€ë¨í•‘ ë¶„ì„ ì‹¤í–‰</button>
<div id="glampingSummary" class="note">ë¶„ì„ ê²°ê³¼ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.</div>

<h3 style="margin-top:30px">ê¸€ë¨í•‘ ëŒ€ìˆ˜ë³„ í•©ì‚°ê¸ˆì•¡ ë¶„ì„</h3>
<div style="margin:10px 0; padding:10px; background:#f9f9f9; border-radius:6px">
  <label style="display:inline-flex; align-items:center; cursor:pointer; font-size:14px">
    <input type="checkbox" id="includeCaravanChart" style="width:18px; height:18px; margin-right:8px">
    <span>ì¹´ë¼ë°˜ 5ëŒ€ í¬í•¨</span>
  </label>
  <span style="margin-left:20px; color:#666; font-size:13px">* ê°€ì¤‘ì¹˜ëŠ” ëª¨ë‘ í¬í•¨ëœ ê¸ˆì•¡ì…ë‹ˆë‹¤</span>
</div>
<canvas id="glampingUnitsChart" style="max-height: 400px; box-sizing: border-box; display: block; height: 400px; width: 1796px;" width="1796" height="400"></canvas>

  </div>
</details>

<details class="collapsible-section">
  <summary>ğŸ’µ ì¶”ê°€ë§¤ì¶œ</summary>
  <div class="collapsible-content">
    
    <h3>[7] ì¶”ê°€ë§¤ì¶œ</h3>
    <table class="financial-table" id="additionalRevenueTable">
      <thead>
        <tr>
          <th class="item-name">í•­ëª©</th>
          <th class="item-value">ì›”ë³„ ê¸ˆì•¡ (ë§Œì›/ì›”)</th>
          <th class="item-value">ì—°ê°„ ê¸ˆì•¡ (ë§Œì›/ë…„)</th>
          <th class="item-actions">ì‘ì—…</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td><input type="text" value="ë§¤ì ìˆ˜ì…"></td>
          <td><input type="text" value="200" oninput="calculateAdditionalRevenue(this)"></td>
          <td><input type="text" value="2,400" readonly style="background-color: #f0f0f0; font-weight: 700; color: #2e7d32;"></td>
          <td><button class="btn-small btn-delete" onclick="deleteFinancialRow(this)">ì‚­ì œ</button></td>
        </tr>
        <tr>
          <td><input type="text" value="ìíŒê¸°ìˆ˜ì…"></td>
          <td><input type="text" value="10" oninput="calculateAdditionalRevenue(this)"></td>
          <td><input type="text" value="120" readonly style="background-color: #f0f0f0; font-weight: 700; color: #2e7d32;"></td>
          <td><button class="btn-small btn-delete" onclick="deleteFinancialRow(this)">ì‚­ì œ</button></td>
        </tr>
      </tbody>
    </table>
    <button class="btn-small btn-add" onclick="addAdditionalRevenueRow()">+ í•­ëª© ì¶”ê°€</button>
    
    <div style="margin-top: 15px; padding: 12px; background: linear-gradient(135deg, #e8f5e9 0%, #c8e6c9 100%); border-radius: 8px; border: 2px solid #4caf50;">
      <div style="font-size: 16px; font-weight: 700; color: #1b5e20; text-align: right;">
        ì´ ì¶”ê°€ë§¤ì¶œ: <span id="additionalRevenueSum">2,520</span> ë§Œì›/ë…„ 
        (<span id="additionalRevenueSumBillion">0.25</span> ì–µì›/ë…„)
      </div>
    </div>
  </div>
</details>

<details class="collapsible-section">
  <summary>ğŸ’° ë³´ì¡°ê¸ˆ</summary>
  <div class="collapsible-content">
    
    <h3>[8] ë³´ì¡°ê¸ˆ</h3>
    <table class="financial-table" id="subsidyTable">
      <thead>
        <tr>
          <th class="item-name">í•­ëª©</th>
          <th class="item-value">ê¸ˆì•¡ (ë§Œì›)</th>
          <th class="item-actions">ì‘ì—…</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td><input type="text" value="ë³´ì¡°ê¸ˆ"></td>
          <td><input type="text" value="0" oninput="calculateSubsidy(this)"></td>
          <td><button class="btn-small btn-delete" onclick="deleteFinancialRow(this)">ì‚­ì œ</button></td>
        </tr>
      </tbody>
    </table>
    <button class="btn-small btn-add" onclick="addSubsidyRow()">+ í•­ëª© ì¶”ê°€</button>
    
    <div style="margin-top: 15px; padding: 12px; background: linear-gradient(135deg, #fff9c4 0%, #fff59d 100%); border-radius: 8px; border: 2px solid #fbc02d;">
      <div style="font-size: 16px; font-weight: 700; color: #f57f17; text-align: right;">
        ì´ ë³´ì¡°ê¸ˆ: <span id="subsidySum">0</span> ë§Œì› 
        (<span id="subsidySumBillion">0.00</span> ì–µì›)
      </div>
    </div>
  </div>
</details>

</section>

<!-- ë²¤ì²˜ -->
<section id="venture" class="panel">
<h2>í•´ìš´ë¬¼ë¥˜ì‹ ê·œ ë²¤ì²˜ íˆ¬ì</h2>
<div class="venture-tree">
  <div id="ventureTable" class="venture-table"></div>
  <div id="ventureDetail" class="venture-detail">
    <h3>ê¸°ì—… ìƒì„¸ ì •ë³´</h3>
    <p>ì™¼ìª½ íŠ¸ë¦¬ì—ì„œ ê¸°ì—…ì„ í´ë¦­í•˜ë©´ ìƒì„¸ ì •ë³´ê°€ í‘œì‹œë©ë‹ˆë‹¤.</p>
  </div>
  <div id="ventureVisuals" class="venture-visuals-panel">
    <h3>ì§€í‘œ ê°€ì‹œí™”</h3>
    <div class="venture-visuals">
      <div class="score-box">
        <div class="venture-label">ì¢…í•© íˆ¬ì ì ìˆ˜</div>
        <div id="ventureTotalScore">-</div>
      </div>
      <div class="score-box">
        <div class="venture-label">íˆ¬ì ì‹ í˜¸</div>
        <div id="ventureSignal" class="signal">-</div>
      </div>

      <div class="venture-chart-wrap">
        <canvas id="ventureRadar"></canvas>
      </div>

      <div class="venture-table">
        <div class="venture-label">ì§€í‘œ ìƒì„¸</div>
        <table class="venture-metrics">
          <thead>
            <tr>
              <th>ì§€í‘œ</th>
              <th>ì ìˆ˜(0~5)</th>
              <th>ê·¼ê±°(evidence)</th>
              <th>ì¶œì²˜(source)</th>
            </tr>
          </thead>
          <tbody id="ventureMetricsBody">
            <tr><td colspan="4">ì§€í‘œ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</td></tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>
</section>

<!-- í†µí•© -->
<section id="total" class="panel">
<h2>í†µí•© ìˆ˜ìµ ë¶„ì„</h2>

<button id="consolidateBtn">í†µí•© ë¶„ì„ ì‹¤í–‰</button>
<button id="downloadPdf">PDF ë‹¤ìš´ë¡œë“œ</button>

<div id="aggregatedSummary" class="note">í†µí•© ë¶„ì„ ê²°ê³¼ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.</div>

<h3>ë‹¨ë… vs í†µí•© EBITDA</h3>
<canvas id="compareChart"></canvas>

<h3>ë³´ì¡°ê¸ˆ OFF vs ON IRR ë¹„êµ (í†µí•©)</h3>
<canvas id="subsidyChart"></canvas>
</section>

<script>
/* íƒ­ */
document.querySelectorAll(".tabs button").forEach(btn=>{
  btn.onclick=()=>{
    document.querySelectorAll('.transaction-filter-dropdown').forEach(dropdown => {
      dropdown.style.display = 'none';
    });

    document.querySelectorAll(".tabs button").forEach(b=>b.classList.remove("active"));
    document.querySelectorAll(".panel").forEach(p=>p.classList.remove("active"));
    btn.classList.add("active");
    document.getElementById(btn.dataset.tab).classList.add("active");

    if (btn.dataset.tab === 'venture') {
      initVentureTree(true);
    }
    
    // KPI ì„¹ì…˜ í‘œì‹œ ì œì–´: ê¸€ë¨í•‘ê³¼ í†µí•© íƒ­ì—ì„œë§Œ í‘œì‹œ
    const kpiSection = document.getElementById('kpiSection');
    if (kpiSection) {
      if (btn.dataset.tab === 'glamping' || btn.dataset.tab === 'total') {
        kpiSection.style.display = 'grid';
      } else {
        kpiSection.style.display = 'none';
      }
    }
    
    // ì‹œë‚˜ë¦¬ì˜¤ ì„ íƒ ì˜ì—­ í‘œì‹œ ì œì–´: ê¸€ë¨í•‘ íƒ­ì—ì„œë§Œ í‘œì‹œ
    const scenarioSection = document.getElementById('scenarioSection');
    if (scenarioSection) {
      if (btn.dataset.tab === 'glamping') {
        scenarioSection.style.display = 'flex';
      } else {
        scenarioSection.style.display = 'none';
      }
    }
    
    // ê¸€ë¨í•‘ íƒ­ì„ í™œì„±í™”í•  ë•Œ 11x17 í…Œì´ë¸”ì„ ë‹¤ì‹œ ìƒì„±í•˜ì—¬ í‘œì‹œ ë³´ì¥
    if(btn.dataset.tab === 'glamping') createScenarioTableSingle();
  }
});

/* DOM references */
const fare = document.getElementById('fare');
const fareSlider = document.getElementById('fareSlider');
const fareRate = document.getElementById('fareRate');
const days = document.getElementById('days');
const passengers = document.getElementById('passengers');
const shipPrice = document.getElementById('shipPrice');
const subsidy = document.getElementById('subsidy');
const subsidyToggle = document.getElementById('subsidyToggle');
const opex = document.getElementById('opex');

const gInvest = document.getElementById('gInvest');
const rooms = document.getElementById('rooms');
const occ = document.getElementById('occ');
const adr = document.getElementById('adr');
const gOpex = document.getElementById('gOpex');

const vInvest = document.getElementById('vInvest');
const vEbitda = document.getElementById('vEbitda');
const vYears = document.getElementById('vYears');

const ferryAnalyze = document.getElementById('ferryAnalyze');
const glampingAnalyze = document.getElementById('glampingAnalyze');
const ventureAnalyze = document.getElementById('ventureAnalyze');
const consolidateBtn = document.getElementById('consolidateBtn');
const downloadPdf = document.getElementById('downloadPdf');

const kRevenue = document.getElementById('kRevenue');
const kEbitda = document.getElementById('kEbitda');
const kIrr = document.getElementById('kIrr');

const compareChartEl = document.getElementById('compareChart');
const subsidyChartEl = document.getElementById('subsidyChart');
const glampingUnitsChartEl = document.getElementById('glampingUnitsChart');

const ferrySummary = document.getElementById('ferrySummary');
const glampingSummary = document.getElementById('glampingSummary');
const ventureSummary = document.getElementById('ventureSummary');
const aggregatedSummary = document.getElementById('aggregatedSummary');

const includeCaravanChart = document.getElementById('includeCaravanChart');

let compareChart, subsidyChart, glampingUnitsChart;
let projects = {ferry:null, glamping:null, venture:null};
let ventureTable;
let ventureRadarChart;

/* Venture tree data */
const ventureData = [
  {
    name: "í•´ìš´Â·ë¬¼ë¥˜ IT",
    _children: [
      {name:"ì”¨ë“œë¡œë‹‰ìŠ¤", stage:"Series A", country:"í•œêµ­", overview:"ì„ ë°• ìš´í•­ ë°ì´í„° ê¸°ë°˜ ë¶„ì„ í”Œë«í¼. ì—°ë£Œ íš¨ìœ¨Â·ì•ˆì „ ê´€ë¦¬ë¥¼ ìë™í™”.", memo:"ë°ì´í„° í™•ë³´ëŠ” ê°•ì . ì„ ì‚¬ ì—°ê³„ PoC ì§„í–‰ ì¤‘.", videoUrl:["https://youtu.be/owDjicRTXjk?si=QRdmsIWLyZTnZqJi", "https://youtu.be/4YXxJof_y4c?si=AU7fHYoRuw3oXFMr"]},
      {name:"í‹°íˆ¬ì—˜ ì£¼ì‹íšŒì‚¬", stage:"Seed", country:"í•œêµ­", overview:"ë¬¼ë¥˜ ìš´ì˜ ë°ì´í„° í†µí•© ë° ëŒ€ì‹œë³´ë“œ ì†”ë£¨ì…˜.", memo:"ì´ˆê¸° ë ˆí¼ëŸ°ìŠ¤ í™•ë³´ ë‹¨ê³„.", videoUrl:"https://youtu.be/BFpVIBVqkhU?si=gRml1OFCM7IaAxwb"},
      {name:"ì‹¬ìŠ¤ë¦¬ì–¼ë¦¬í‹°", stage:"Seed", country:"í•œêµ­", overview:"ì‹œë®¬ë ˆì´ì…˜/ë””ì§€í„¸íŠ¸ìœˆ. í•­ë§Œ/ìš´í•­ ì‹œë‚˜ë¦¬ì˜¤ ë¶„ì„.", memo:"ë°ëª¨ ì™„ì„±ë„ ë†’ìŒ.", videoUrl:"https://youtu.be/9-TuAIweprQ?si=_QS1wdOuA1YZ5xsQ"},
      {name:"ë§µì‹œ(Mapsea)", stage:"Seed", country:"í•œêµ­", overview:"í•­ë¡œ ì¶”ì²œ ë° ìš´í•­ ë¦¬í¬íŒ… SaaS. ì˜ì‚¬ê²°ì • ëŒ€ì‹œë³´ë“œ ì œê³µ.", memo:"ì‚¬ìš©ì„± ìš°ìˆ˜. ìˆ˜ìµëª¨ë¸ ë‹¤ê°í™” í•„ìš”.", videoUrl:"https://youtu.be/xoGxAOFHosQ?si=cfl5xl2ahrD8zf9T"},
      {name:"Portlogics", stage:"Pre-A", country:"ì‹±ê°€í¬ë¥´", overview:"í•­ë§Œ ìš´ì˜Â·í˜¼ì¡ ìµœì í™” ì†”ë£¨ì…˜. ì‹¤ì‹œê°„ ETA ì˜ˆì¸¡.", memo:"í˜„ì§€ íŒŒíŠ¸ë„ˆ í™•ë³´ê°€ ê´€ê±´.", videoUrl:""},
      {name:"íŠ¸ë ˆë“œë§ìŠ¤", stage:"Series B", country:"í•œêµ­", overview:"í•´ìš´Â·ë¬¼ë¥˜ í†µí•© í”Œë«í¼. í™”ë¬¼ ì¶”ì Â·ì„œë¥˜ ìë™í™”.", memo:"ëŒ€í˜• í™”ì£¼ ë ˆí¼ëŸ°ìŠ¤ í™•ë³´.", videoUrl:"https://youtu.be/Jgv-NnamHOU?si=K5vycYjKJOJ3dJ-d"}
    ]
  },
  {
    name: "ìŠ¤ë§ˆíŠ¸Â·ìë™í™”/IoT",
    _children: [
      {name:"ìŠ¤ë§ˆíŠ¸ì— íˆ¬ì— ", stage:"Seed", country:"í•œêµ­", overview:"IoT ì„¼ì„œ ê¸°ë°˜ ì›ê²© ëª¨ë‹ˆí„°ë§. ëƒ‰ì¥Â·ìœ„í—˜ë¬¼ ìƒíƒœ ì¶”ì .", memo:"í•˜ë“œì›¨ì–´ ì›ê°€ ì ˆê° í•„ìš”.", videoUrl:""},
      {name:"ìŠ¤ë§ˆíŠ¸íë¸Œ", stage:"Series A", country:"í•œêµ­", overview:"ë¬¼ë¥˜ ìë™í™” ì¥ë¹„ ë° WMS ì—°ë™. ì°½ê³  í”¼í‚¹ íš¨ìœ¨ ê°œì„ .", memo:"ì„¤ì¹˜í˜• ëª¨ë¸ì—ì„œ êµ¬ë…í˜• ì „í™˜ ê²€í† .", videoUrl:"https://youtu.be/oO9nk-_1MNc?si=Dv0p7GhxMruKKWdv"}
    ]
  },
  {
    name: "ì¹œí™˜ê²½Â·ì—ë„ˆì§€/í•´ì–‘ì¥ë¹„",
    _children: [
      {name:"ê³¨ë””ë½ìŠ¤ì‰¬í•‘", stage:"Pre-A", country:"í•œêµ­", overview:"ì¹œí™˜ê²½ ì„ ë°• ìš´í•­ ìµœì í™”. íƒ„ì†Œë°°ì¶œ ë¦¬í¬íŒ… ì œê³µ.", memo:"ê·œì œ ë³€í™” ìˆ˜í˜œ ê¸°ëŒ€.", videoUrl:""},
      {name:"ë¹ˆì„¼", stage:"Series B", country:"í•œêµ­", overview:"ì „ê¸°Â·ìˆ˜ì†Œ ì„ ë°• íŒŒì›ŒíŠ¸ë ˆì¸. ì‹¤ì¦ í”„ë¡œì íŠ¸ ì§„í–‰.", memo:"ì¥ë¹„ ì¸ì¦ ì¼ì • í™•ì¸ í•„ìš”.", videoUrl:"https://youtu.be/Grq6erMXOFI?si=1bu-K9Q6EP9DeOGV"},
      {name:"ë°¸ë¥˜ë§í¬ìœ ", stage:"Series A", country:"í•œêµ­", overview:"í•´ìš´ ì—°ë£Œ/ì—ë„ˆì§€ ê´€ë¦¬ í”Œë«í¼. ì—°ë£Œ êµ¬ë§¤ ìµœì í™”.", memo:"ì—°ë£Œ ê±°ë˜ íŒŒíŠ¸ë„ˆì‹­ ê²€í† .", videoUrl:"https://youtu.be/bBVF316K8Ys?si=hWlP17wIdr3MdPD_"},
      {name:"ãˆœì—ì½”ë§ˆë¦°", stage:"Seed", country:"í•œêµ­", overview:"ì¹œí™˜ê²½ í•´ì–‘ ì„œë¹„ìŠ¤ ë° ì¥ë¹„ ìœ ì§€ë³´ìˆ˜.", memo:"í˜„ì¥ ë„¤íŠ¸ì›Œí¬ ê°•ì .", videoUrl:"https://youtu.be/xZpkxcu5zLU?si=KIIpwL6xYSyGHVMW"},
      {name:"ãˆœì´ì´ì—ìŠ¤", stage:"Pre-A", country:"í•œêµ­", overview:"í•´ì–‘ ì—ë„ˆì§€ ì‹œìŠ¤í…œ ë° ì €ì¥ ì†”ë£¨ì…˜.", memo:"CAPEX í¬ê³  íšŒìˆ˜ê¸°ê°„ ê¸¸ ìˆ˜ ìˆìŒ.", videoUrl:""},
      {name:"ãˆœì§€ì—”í…Œí¬ë†€ë¡œì§€ìŠ¤", stage:"Seed", country:"í•œêµ­", overview:"í•´ì–‘ í™˜ê²½ ëª¨ë‹ˆí„°ë§ ì¥ë¹„/ì†Œí”„íŠ¸ì›¨ì–´.", memo:"ê³µê³µ í”„ë¡œì íŠ¸ ë¹„ì¤‘ ë†’ìŒ.", videoUrl:"https://youtu.be/Jm1nwi9L0bE?si=Cyym-1vNSCcIaIo9"},
      {name:"ì½”ì—˜íŠ¸", stage:"Seed", country:"í•œêµ­", overview:"í•´ì–‘ ì¥ë¹„/ì†Œì¬ ê¸°ìˆ .", memo:"ê¸°ìˆ  ì‹¤ì¦ ë ˆí¼ëŸ°ìŠ¤ í•„ìš”.", videoUrl:"https://youtu.be/y0-5h0kSMNg?si=wORMAwx8TuLbuweR"},
      {name:"(ì£¼)ìŠˆë‹ˆí…Œí¬", stage:"Seed", country:"í•œêµ­", overview:"í•´ì–‘ ì¥ë¹„ ì œì¡° ë° ìœ ì§€ë³´ìˆ˜.", memo:"ë‚©í’ˆ ì¼ì • ê´€ë¦¬ ì²´ê³„ ê°œì„  í•„ìš”.", videoUrl:"https://youtu.be/Go6e53O1Niw?si=VtKjR6ff4tEl_hwz"}
    ]
  },
  {
    name: "ì¡°ì„ Â·í•´ì–‘ ì—”ì§€ë‹ˆì–´ë§",
    _children: [
      {name:"ì”¨ë²¤í‹°ì§€", stage:"Pre-A", country:"í•œêµ­", overview:"í•´ì–‘ êµ¬ì¡°ë¬¼ í•´ì„/ì„¤ê³„ ì†”ë£¨ì…˜. ë””ì§€í„¸íŠ¸ìœˆ ì—°ê³„.", memo:"ëŒ€í˜• ì¡°ì„ ì†Œ PoC ì¤‘.", videoUrl:"https://youtu.be/zDDfg20BiY8?si=Rrj1jQj2Hdif1AQZ"},
      {name:"ì”¨ë¼ì´í”„ì‚¬ì´ì–¸ìŠ¤ë©", stage:"Seed", country:"í•œêµ­", overview:"í•´ì–‘ ë°”ì´ì˜¤Â·í™˜ê²½ ì—°êµ¬ ê¸°ë°˜ ì‹ ì†Œì¬.", memo:"ì‘ìš©ì²˜ í™•ëŒ€ í•„ìš”.", videoUrl:"https://youtu.be/op6J1oWpz28?si=Nd554ZJHBIdiNV_o"},
      {name:"ãˆœìŠ¤í”¼ë“œí”Œë¡œì–´", stage:"Seed", country:"í•œêµ­", overview:"ì„ ë°•Â·ì‚°ì—…ìš© ë°”ë‹¥/ì†Œì¬. ìœ ì§€ë³´ìˆ˜ ì ˆê°.", memo:"ì¸ì¦ ì·¨ë“ ì§„í–‰.", videoUrl:"https://youtu.be/BT0vh3suSlU?si=xAhRrccB6qWnKDVi"}
    ]
  },
  {
    name: "ìš°ì£¼Â·í•­ê³µ/ì‹ ì‚°ì—…",
    _children: [
      {name:"í•œì»´ì¸ìŠ¤í˜ì´ìŠ¤", stage:"Series A", country:"í•œêµ­", overview:"ìœ„ì„± ë°ì´í„° ì²˜ë¦¬/ë¶„ì„ í”Œë«í¼. í•´ì–‘ ê´€ì¸¡ í™œìš©.", memo:"ë°ì´í„° ë¼ì´ì„ ìŠ¤ êµ¬ì¡° í™•ì¸.", videoUrl:"https://youtu.be/HYPYu5L5l_I?si=OaCtDbMpsOKpJJuO"},
      {name:"ì´ë…¸ìŠ¤í˜ì´ìŠ¤", stage:"Series B", country:"í•œêµ­", overview:"ìš°ì£¼ ë°œì‚¬ì²´ ê°œë°œ. ì¤‘ì†Œí˜• ìœ„ì„± ë°œì‚¬.", memo:"ë°œì‚¬ ì¼ì • ë¦¬ìŠ¤í¬ ê´€ë¦¬.", videoUrl:"https://youtu.be/fB5W7WjkVrM?si=hfZmrvZnkqj__dh8"},
      {name:"ë¦¬ë²¨ë¦¬ì˜¨", stage:"Series B", country:"í•œêµ­", overview:"AI ë°˜ë„ì²´ ë° ì„œë²„ ì†”ë£¨ì…˜.", memo:"ë¬¼ë¥˜ ìµœì í™” AI ì ìš© ê²€í† .", videoUrl:"https://youtu.be/8Wx5W6BTyzI?si=ZekEJRYr4IpvGw3u"}
    ]
  },
  {
    name: "ë¬¼ë¥˜/ìš´ì†¡ ìš´ì˜",
    _children: [
      {name:"ì”¨ë„ˆì§€íŒŒíŠ¸ë„ˆ(ì£¼)", stage:"Pre-A", country:"í•œêµ­", overview:"ë¬¼ë¥˜ ìš´ì˜ ê°œì„  ë° íˆ¬ì ì—°ê³„.", memo:"íŒŒíŠ¸ë„ˆ ë„¤íŠ¸ì›Œí¬ ê°•ì .", videoUrl:"https://youtu.be/mTjC6lH4WxU?si=9xYmX1Pbl6EDmP4c"}
    ]
  }
];

// íˆ¬ì ì§€í‘œ ê¸°ë³¸ ê°ì²´ (ì‹¤ë°ì´í„°ëŠ” ì¶”í›„ ì—°ë™)
const investmentIndicators = {
  customerPull: {
    label: "ê³ ê° ìˆ˜ìš” ì‹ í˜¸",
    score: null,
    description: "ê³ ê°ì´ ìë°œì ìœ¼ë¡œ ì°¾ëŠ”ì§€, ë°˜ë³µ ì‚¬ìš©Â·ì¶”ì²œì´ ë°œìƒí•˜ëŠ”ì§€ ë“± ìˆ˜ìš” ì‹ í˜¸ë¥¼ ì •ì„±ì ìœ¼ë¡œ í‰ê°€í•©ë‹ˆë‹¤.",
    evidence: "",
    source: ""
  },
  monetizationReadiness: {
    label: "ìˆ˜ìµí™” ì¤€ë¹„ë„",
    score: null,
    description: "ë§¤ì¶œ ë°œìƒ êµ¬ì¡°, ê°€ê²© ì •ì±…, ìœ ë£Œ ì „í™˜ íë¦„ ë“± ìˆ˜ìµí™” ê°€ëŠ¥ì„±ê³¼ ì¤€ë¹„ ìˆ˜ì¤€ì„ ì„¤ëª…í•©ë‹ˆë‹¤.",
    evidence: "",
    source: ""
  },
  lockInStrength: {
    label: "ë½ì¸ ê°•ë„",
    score: null,
    description: "ì „í™˜ ë¹„ìš©, ë°ì´í„°/ìš´ì˜ ì—°ë™, ì¥ê¸° ê³„ì•½ ì—¬ë¶€ ë“± ê³ ê° ì´íƒˆì„ ë§‰ëŠ” ìš”ì¸ì„ ì„¤ëª…í•©ë‹ˆë‹¤.",
    evidence: "",
    source: ""
  },
  scalabilitySignal: {
    label: "í™•ì¥ì„± ì‹ í˜¸",
    score: null,
    description: "ì§€ì—­Â·ì‚°ì—… í™•ì¥ ê°€ëŠ¥ì„±, ë‹¨ìœ„ê²½ì œ ê°œì„  ì—¬ì§€, ìš´ì˜ ìë™í™” ìˆ˜ì¤€ ë“±ì„ í‰ê°€í•©ë‹ˆë‹¤.",
    evidence: "",
    source: ""
  },
  exitVisibility: {
    label: "ì—‘ì‹¯ ê°€ì‹œì„±",
    score: null,
    description: "M&A í›„ë³´ ì¡´ì¬, ìƒì¥ ê°€ëŠ¥ì„±, ì—…ê³„ ë°¸ë¥˜ì—ì´ì…˜ ë¹„êµ ë“± íšŒìˆ˜ ê²½ë¡œì˜ ê°€ì‹œì„±ì„ ì„¤ëª…í•©ë‹ˆë‹¤.",
    evidence: "",
    source: ""
  }
};

/* Financial tables management */
function addFinancialRow(tableId) {
  const table = document.getElementById(tableId);
  if(!table) return;
  const tbody = table.querySelector('tbody');
  const newRow = document.createElement('tr');
  newRow.innerHTML = `
    <td><input type="text" placeholder="í•­ëª©ëª… ì…ë ¥"></td>
    <td><input type="text" value="0"></td>
    <td><button class="btn-small btn-delete" onclick="deleteFinancialRow(this)">ì‚­ì œ</button></td>
  `;
  
  // CAPEX í…Œì´ë¸”ì˜ ê²½ìš° í† ì§€ë¹„ìš© í–‰(ì²˜ìŒ 2ê°œ) ë‹¤ìŒì— ì¶”ê°€
  if(tableId === 'capexTable') {
    const landCostRow = tbody.querySelector('.land-cost-row');
    if(landCostRow && landCostRow.nextSibling) {
      tbody.insertBefore(newRow, landCostRow.nextSibling);
    } else {
      tbody.appendChild(newRow);
    }
  } else if(tableId === 'fixedCostTable') {
    // ê³ ì •ë¹„ í…Œì´ë¸”ì˜ ê²½ìš° ê°ê°€ìƒê°ë¹„ í–‰(ì²˜ìŒ 2ê°œ) ë‹¤ìŒì— ì¶”ê°€
    const depreciationRow = tbody.querySelector('.depreciation-row');
    if(depreciationRow && depreciationRow.nextSibling) {
      tbody.insertBefore(newRow, depreciationRow.nextSibling);
    } else {
      tbody.appendChild(newRow);
    }
  } else if(tableId === 'financeTable') {
    // ê¸ˆìœµ ë° ì„¸ê¸ˆ í…Œì´ë¸”ì˜ ê²½ìš° ì°¨ì…ê¸ˆ ì´ì í–‰(ì²˜ìŒ 2ê°œ) ë‹¤ìŒì— ì¶”ê°€
    const loanInterestRow = tbody.querySelector('.loan-interest-row');
    if(loanInterestRow && loanInterestRow.nextSibling) {
      tbody.insertBefore(newRow, loanInterestRow.nextSibling);
    } else {
      tbody.appendChild(newRow);
    }
  } else {
    tbody.appendChild(newRow);
  }
  
  bindFinancialInputs();
  updateFinancialSummaries();
}

function deleteFinancialRow(btn) {
  const row = btn.closest('tr');
  
  // í† ì§€ë¹„ìš© ê´€ë ¨ í–‰ì€ ì‚­ì œ ë¶ˆê°€
  if(row.classList.contains('land-calc-header') || row.classList.contains('land-cost-row')) {
    showToast('í† ì§€ë¹„ìš© í•­ëª©ì€ ì‚­ì œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.', 'error');
    return;
  }
  
  // ê°ê°€ìƒê°ë¹„ ê´€ë ¨ í–‰ì€ ì‚­ì œ ë¶ˆê°€
  if(row.classList.contains('depreciation-header') || row.classList.contains('depreciation-row')) {
    showToast('ê°ê°€ìƒê°ë¹„ í•­ëª©ì€ ì‚­ì œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.', 'error');
    return;
  }
  
  // ì°¨ì…ê¸ˆ ì´ì ê´€ë ¨ í–‰ì€ ì‚­ì œ ë¶ˆê°€
  if(row.classList.contains('loan-interest-header') || row.classList.contains('loan-interest-row')) {
    showToast('ì°¨ì…ê¸ˆ ì´ì í•­ëª©ì€ ì‚­ì œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.', 'error');
    return;
  }
  
  const table = row.closest('table');
  const tbody = table.querySelector('tbody');
  
  // CAPEX í…Œì´ë¸”ì˜ ê²½ìš° í† ì§€ë¹„ìš© 2ê°œ í–‰ì„ ì œì™¸í•˜ê³  ìµœì†Œ 1ê°œ ì´ìƒ í•„ìš”
  const isCapexTable = table.id === 'capexTable';
  const isFixedCostTable = table.id === 'fixedCostTable';
  const isFinanceTable = table.id === 'financeTable';
  let minRows = 1;
  
  if(isCapexTable) {
    minRows = 3; // CAPEXëŠ” í† ì§€ë¹„ìš© 2í–‰ + ìµœì†Œ 1í–‰
  } else if(isFixedCostTable) {
    minRows = 3; // ê³ ì •ë¹„ëŠ” ê°ê°€ìƒê°ë¹„ 2í–‰ + ìµœì†Œ 1í–‰
  } else if(isFinanceTable) {
    minRows = 4; // ê¸ˆìœµ ë° ì„¸ê¸ˆì€ ì°¨ì…ê¸ˆ ì´ì 2í–‰ + ë¶€ê°€ì„¸ + ë²•ì¸ì„¸ìœ¨ ìµœì†Œ
  }
  
  if(tbody.children.length > minRows) {
    row.remove();
    updateFinancialSummaries();
  } else {
    showToast('ìµœì†Œ 1ê°œ ì´ìƒì˜ í•­ëª©ì´ í•„ìš”í•©ë‹ˆë‹¤.', 'error');
  }
}

function getTableSum(tableId) {
  const table = document.getElementById(tableId);
  if(!table) return 0;
  // ì§ì ‘ ìì‹ tbodyì˜ trë§Œ ì„ íƒ (ì¤‘ì²© í…Œì´ë¸” ì œì™¸)
  const rows = table.querySelector('tbody')?.children || [];
  let sum = 0;
  
  for (const row of rows) {
    // íŠ¹ìˆ˜ í—¤ë” í–‰(land-calc-header, depreciation-header, loan-interest-header)ì€ ì œì™¸
    if (row.classList.contains('land-calc-header') || row.classList.contains('depreciation-header') || row.classList.contains('loan-interest-header')) {
      continue;
    }
    
    const valueInput = row.querySelector('td:nth-child(2) input');
    if (valueInput) {
      const val = Number(removeCommas(valueInput.value)) || 0;
      sum += val;
    }
  }
  
  return sum;
}

function updateFinancialSummaries() {
  const tables = ['capex', 'preopening', 'fixedCost', 'variableCost'];
  tables.forEach(t => {
    const sum = getTableSum(t + 'Table');
    const sumEl = document.getElementById(t + 'Sum');
    const sumBillionEl = document.getElementById(t + 'SumBillion');
    if(sumEl) sumEl.textContent = formatNumberWithCommas(sum.toFixed(0));
    if(sumBillionEl) sumBillionEl.textContent = formatNumberWithCommas((sum / 10000).toFixed(2));
  });
  
  // Update gInvest field with total CAPEX + Pre-opening - Subsidy
  const totalCapex = getTableSum('capexTable');
  const totalPreopening = getTableSum('preopeningTable');
  const subsidy = getSubsidy(); // ì–µì›
  const totalInitial = (totalCapex + totalPreopening) / 10000 - subsidy; // Convert to ì–µì› and subtract subsidy
  const gInvestEl = document.getElementById('gInvest');
  if(gInvestEl) {
    gInvestEl.value = totalInitial.toFixed(2);
  }
  
  // Update gOpex field with total fixed + variable costs
  const totalFixed = getTableSum('fixedCostTable');
  const totalVariable = getTableSum('variableCostTable');
  const totalOpex = (totalFixed + totalVariable) / 10000; // Convert to ì–µì›
  const gOpexEl = document.getElementById('gOpex');
  if(gOpexEl) {
    gOpexEl.value = totalOpex.toFixed(2);
  }
  
  // Update KPI indicators
  updateKPIIndicators();
}

function updateKPIIndicators() {
  // ì´ ì´ˆê¸° íˆ¬ìë¹„ (CAPEX + Pre-opening)
  const totalCapex = getTableSum('capexTable');
  const totalPreopening = getTableSum('preopeningTable');
  const totalInvestGross = (totalCapex + totalPreopening) / 10000; // ì–µì›
  
  // ë³´ì¡°ê¸ˆ ì°¨ê°
  const subsidy = getSubsidy(); // ì–µì›
  const totalInvest = totalInvestGross - subsidy; // ì‹¤ì œ íˆ¬ìë¹„ = ì´ íˆ¬ìë¹„ - ë³´ì¡°ê¸ˆ
  
  // ì—°ê°„ ìš´ì˜ë¹„ (Fixed + Variable)
  const totalFixed = getTableSum('fixedCostTable');
  const totalVariable = getTableSum('variableCostTable');
  const opex = (totalFixed + totalVariable) / 10000; // ì–µì›
  
  // ì—°ê°„ ë§¤ì¶œ (KPI ì„¹ì…˜ì—ì„œ ì„ íƒëœ ì‹œë‚˜ë¦¬ì˜¤ ê¸°ë°˜)
  const selectedScenario = document.querySelector('input[name="kpi_scenario"]:checked')?.value || 'neutral';
  const revenueGross = getSelectedScenarioRevenue(selectedScenario); // ì–µì› (ë¶€ê°€ì„¸ í¬í•¨)
  
  // ë¶€ê°€ì„¸ìœ¨ ê°€ì ¸ì˜¤ê¸°
  const vatRate = getVATRate() / 100;
  
  // ë¶€ê°€ì„¸ ì œì™¸ ë§¤ì¶œ = ë¶€ê°€ì„¸ í¬í•¨ ë§¤ì¶œ / (1 + ë¶€ê°€ì„¸ìœ¨)
  const revenue = revenueGross / (1 + vatRate);
  
  // ì¶”ê°€ë§¤ì¶œ ê°€ì ¸ì˜¤ê¸°
  const additionalRevenue = getAdditionalRevenue(); // ì–µì›
  
  // ë§ˆì¼€íŒ…ë¹„ ê°€ì ¸ì˜¤ê¸° (ë³€ë™ë¹„ì—ì„œ ì¶”ì¶œ)
  const marketingCost = getMarketingCost(); // ì–µì›
  
  // EBITDA = ë§¤ì¶œ(ë¶€ê°€ì„¸ ì œì™¸) + ì¶”ê°€ë§¤ì¶œ - ìš´ì˜ë¹„ - ë§ˆì¼€íŒ…ë¹„
  const ebitda = revenue + additionalRevenue - opex - marketingCost;
  
  // ê°ê°€ìƒê°ë¹„ (ê³ ì •ë¹„ í…Œì´ë¸”ì—ì„œ ê°€ì ¸ì˜¤ê¸°)
  const depreciation = getDepreciation(); // ì–µì›
  
  // ì˜ì—…ì´ìµ = EBITDA - ê°ê°€ìƒê°
  const operatingProfit = ebitda - depreciation;
  
  // ì°¨ì…ê¸ˆ ì´ì (ê¸ˆìœµ ë° ì„¸ê¸ˆ í…Œì´ë¸”ì—ì„œ ê°€ì ¸ì˜¤ê¸°)
  const loanInterest = getLoanInterest(); // ì–µì›
  
  // ì„¸ì „ì´ìµ = ì˜ì—…ì´ìµ - ì´ìë¹„ìš©
  const profitBeforeTax = operatingProfit - loanInterest;
  
  // ì„¸ìœ¨ (finance í…Œì´ë¸”ì—ì„œ ê°€ì ¸ì˜¤ê¸°, ì—†ìœ¼ë©´ 22% ê¸°ë³¸ê°’)
  const taxRate = getTaxRate() / 100;
  
  // ì„¸í›„ì´ìµ = ì„¸ì „ì´ìµ * (1 - ì„¸ìœ¨)
  const netProfit = profitBeforeTax * (1 - taxRate);
  
  // ì—°ê°„ ìˆœí˜„ê¸ˆíë¦„ = ì„¸í›„ì´ìµ + ê°ê°€ìƒê°
  const cashFlow = netProfit + depreciation;
  
  // íˆ¬ìíšŒìˆ˜ê¸°ê°„ = ì´ íˆ¬ì / ì—°ê°„ ìˆœí˜„ê¸ˆíë¦„
  const payback = cashFlow > 0 ? totalInvest / cashFlow : 999;
  
  // IRR ê³„ì‚° (ê°„ë‹¨í•œ ê·¼ì‚¬ì¹˜)
  const irr = calculateSimpleIRR(totalInvest, cashFlow, 5);
  
  // Update UI
  document.getElementById('kpi_totalInvest').textContent = formatNumberWithCommas(totalInvest.toFixed(1));
  document.getElementById('kpi_opex').textContent = formatNumberWithCommas(opex.toFixed(1));
  document.getElementById('kpi_ebitda').textContent = formatNumberWithCommas(ebitda.toFixed(1));
  document.getElementById('kpi_operatingProfit').textContent = formatNumberWithCommas(operatingProfit.toFixed(1));
  document.getElementById('kpi_netProfit').textContent = formatNumberWithCommas(netProfit.toFixed(1));
  document.getElementById('kpi_cashFlow').textContent = formatNumberWithCommas(cashFlow.toFixed(1));
  document.getElementById('kpi_payback').textContent = payback < 999 ? payback.toFixed(1) : 'N/A';
  document.getElementById('kpi_irr').textContent = irr.toFixed(1);
  
  // Update tooltips with actual values
  updateKPITooltip('kpi-card-1', `ì´ˆê¸° íˆ¬ìë¹„(CAPEX) í•©ê³„ - ë³´ì¡°ê¸ˆ\n= ${formatNumberWithCommas((totalCapex/10000).toFixed(1))}ì–µ + ${formatNumberWithCommas((totalPreopening/10000).toFixed(1))}ì–µ - ${formatNumberWithCommas(subsidy.toFixed(1))}ì–µ\n= ${formatNumberWithCommas(totalInvest.toFixed(1))}ì–µì›`);
  
  updateKPITooltip('kpi-card-2', `ê³ ì • ìš´ì˜ë¹„ + ë³€ë™ ìš´ì˜ë¹„\n= ${formatNumberWithCommas((totalFixed/10000).toFixed(1))}ì–µ + ${formatNumberWithCommas((totalVariable/10000).toFixed(1))}ì–µ\n= ${formatNumberWithCommas(opex.toFixed(1))}ì–µì›/ë…„`);
  
  updateKPITooltip('kpi-card-3', `ë§¤ì¶œì•¡(ë¶€ê°€ì„¸ ì œì™¸) + ì¶”ê°€ë§¤ì¶œ - ìš´ì˜ë¹„ - ë§ˆì¼€íŒ…ë¹„\në¶€ê°€ì„¸ í¬í•¨: ${formatNumberWithCommas(revenueGross.toFixed(1))}ì–µ\në¶€ê°€ì„¸ ì œì™¸: ${formatNumberWithCommas(revenue.toFixed(1))}ì–µ\nì¶”ê°€ë§¤ì¶œ: ${formatNumberWithCommas(additionalRevenue.toFixed(1))}ì–µ\n= ${formatNumberWithCommas(revenue.toFixed(1))}ì–µ + ${formatNumberWithCommas(additionalRevenue.toFixed(1))}ì–µ - ${formatNumberWithCommas(opex.toFixed(1))}ì–µ - ${formatNumberWithCommas(marketingCost.toFixed(1))}ì–µ\n= ${formatNumberWithCommas(ebitda.toFixed(1))}ì–µì›/ë…„`);
  
  updateKPITooltip('kpi-card-4', `EBITDA - ê°ê°€ìƒê°ë¹„\n= ${formatNumberWithCommas(ebitda.toFixed(1))}ì–µ - ${formatNumberWithCommas(depreciation.toFixed(1))}ì–µ\n= ${formatNumberWithCommas(operatingProfit.toFixed(1))}ì–µì›/ë…„`);
  
  updateKPITooltip('kpi-card-5', `ì„¸ì „ì´ìµ Ã— (1 - ë²•ì¸ì„¸ìœ¨)\nì„¸ì „ì´ìµ = ì˜ì—…ì´ìµ - ì´ìë¹„ìš©\n= ${formatNumberWithCommas(operatingProfit.toFixed(1))}ì–µ - ${formatNumberWithCommas(loanInterest.toFixed(1))}ì–µ = ${formatNumberWithCommas(profitBeforeTax.toFixed(1))}ì–µ\nì„¸í›„ì´ìµ = ${formatNumberWithCommas(profitBeforeTax.toFixed(1))}ì–µ Ã— (1 - ${(taxRate*100).toFixed(1)}%)\n= ${formatNumberWithCommas(netProfit.toFixed(1))}ì–µì›/ë…„`);
  
  updateKPITooltip('kpi-card-6', `ì„¸í›„ì´ìµ + ê°ê°€ìƒê°ë¹„\n= ${formatNumberWithCommas(netProfit.toFixed(1))}ì–µ + ${formatNumberWithCommas(depreciation.toFixed(1))}ì–µ\n= ${formatNumberWithCommas(cashFlow.toFixed(1))}ì–µì›/ë…„`);
  
  updateKPITooltip('kpi-card-7', `ì´ˆê¸° íˆ¬ìë¹„ Ã· ì—°ê°„ ìˆœí˜„ê¸ˆíë¦„\n= ${formatNumberWithCommas(totalInvest.toFixed(1))}ì–µ Ã· ${formatNumberWithCommas(cashFlow.toFixed(1))}ì–µ\n= ${payback < 999 ? payback.toFixed(1) : 'N/A'}ë…„`);
  
  updateKPITooltip('kpi-card-8', `NPV = 0ì´ ë˜ëŠ” í• ì¸ìœ¨\n(5ë…„ê°„ í˜„ê¸ˆíë¦„ ê¸°ì¤€)\níˆ¬ì: ${formatNumberWithCommas(totalInvest.toFixed(1))}ì–µ\nì—°ê°„ CF: ${formatNumberWithCommas(cashFlow.toFixed(1))}ì–µ\nIRR = ${irr.toFixed(1)}%`);
}

function updateKPITooltip(cardClass, content) {
  const card = document.querySelector(`.${cardClass}`);
  if (card) {
    const tooltip = card.querySelector('.kpi-tooltip');
    if (tooltip) {
      tooltip.textContent = content;
    }
  }
}

function toggleLandCalcDetails() {
  const details = document.getElementById('landCalcDetails');
  const icon = document.getElementById('landCalcToggleIcon');
  
  if (details.style.display === 'none') {
    details.style.display = '';
    icon.style.transform = 'rotate(0deg)';
    icon.textContent = 'â–¼';
  } else {
    details.style.display = 'none';
    icon.style.transform = 'rotate(-90deg)';
    icon.textContent = 'â–¶';
  }
}

window.toggleLandCalcDetails = toggleLandCalcDetails;

function calculateLandCost() {
  const tbody = document.getElementById('landPurchaseTable');
  if (!tbody) return;
  
  const rows = tbody.querySelectorAll('tr');
  let totalCost = 0;
  
  rows.forEach(row => {
    const priceInput = row.querySelector('td:nth-child(2) input');
    const areaInput = row.querySelector('td:nth-child(3) input');
    const ratioInput = row.querySelector('td:nth-child(4) input');
    const amountCell = row.querySelector('.land-cost-amount');
    
    if (priceInput && areaInput && ratioInput && amountCell) {
      const price = parseFloat(priceInput.value) || 0;
      const area = parseFloat(areaInput.value) || 0;
      const ratio = parseFloat(ratioInput.value) || 0;
      
      // í† ì§€ë¹„ìš© = ê³µì‹œì§€ê°€ Ã— ë©´ì  Ã— ì‹¤ê±°ë˜ë¹„ìœ¨ Ã· 10,000 (ë§Œì›)
      const landCost = (price * area * ratio) / 10000;
      
      amountCell.textContent = formatNumberWithCommas(Math.round(landCost));
      totalCost += landCost;
    }
  });
  
  // ì´ í† ì§€ ë§¤ì…ë¹„ ì—…ë°ì´íŠ¸
  const totalEl = document.getElementById('totalLandCost');
  if (totalEl) {
    totalEl.textContent = formatNumberWithCommas(Math.round(totalCost));
  }
  
  // CAPEX í…Œì´ë¸”ì˜ í† ì§€ ë§¤ì…ë¹„ ì—…ë°ì´íŠ¸
  const landCostInput = document.getElementById('landCostInput');
  if (landCostInput) {
    landCostInput.value = formatNumberWithCommas(Math.round(totalCost));
  }
  
  // ì¬ë¬´ ìš”ì•½ ì—…ë°ì´íŠ¸
  updateFinancialSummaries();
}

window.calculateLandCost = calculateLandCost;

function addLandPurchase() {
  const tbody = document.getElementById('landPurchaseTable');
  if (!tbody) return;
  
  const newRow = document.createElement('tr');
  newRow.innerHTML = `
    <td style="padding: 6px; border: 1px solid #ddd;"><input type="text" value="í† ì§€" style="width: 100%; padding: 4px; border: 1px solid #ccc; border-radius: 3px; font-size: 12px;"></td>
    <td style="padding: 6px; border: 1px solid #ddd;"><input type="number" value="0" style="width: 100%; padding: 4px; border: 1px solid #ccc; border-radius: 3px; font-size: 12px; text-align: right;" oninput="calculateLandCost()"></td>
    <td style="padding: 6px; border: 1px solid #ddd;"><input type="number" value="0" style="width: 100%; padding: 4px; border: 1px solid #ccc; border-radius: 3px; font-size: 12px; text-align: center;" oninput="calculateLandCost()"></td>
    <td style="padding: 6px; border: 1px solid #ddd;"><input type="number" value="1.0" step="0.1" style="width: 100%; padding: 4px; border: 1px solid #ccc; border-radius: 3px; font-size: 12px; text-align: center;" oninput="calculateLandCost()"></td>
    <td style="padding: 6px; border: 1px solid #ddd; text-align: right; font-weight: 600; color: #27ae60;" class="land-cost-amount">0</td>
    <td style="padding: 6px; border: 1px solid #ddd; text-align: center;"><button class="btn-small btn-delete" onclick="deleteLandPurchase(this)" style="font-size: 11px; padding: 3px 8px;">ì‚­ì œ</button></td>
  `;
  
  tbody.appendChild(newRow);
  calculateLandCost();
}

window.addLandPurchase = addLandPurchase;

function deleteLandPurchase(btn) {
  const tbody = document.getElementById('landPurchaseTable');
  if (!tbody) return;
  
  if (tbody.children.length > 1) {
    btn.closest('tr').remove();
    calculateLandCost();
  } else {
    showToast('ìµœì†Œ 1ê°œ ì´ìƒì˜ í† ì§€ í•­ëª©ì´ í•„ìš”í•©ë‹ˆë‹¤.', 'error');
  }
}

window.deleteLandPurchase = deleteLandPurchase;

function toggleDepreciationDetails() {
  const details = document.getElementById('depreciationDetails');
  const icon = document.getElementById('depreciationToggleIcon');
  
  if (details.style.display === 'none') {
    details.style.display = '';
    icon.style.transform = 'rotate(0deg)';
    icon.textContent = 'â–¼';
  } else {
    details.style.display = 'none';
    icon.style.transform = 'rotate(-90deg)';
    icon.textContent = 'â–¶';
  }
}

window.toggleDepreciationDetails = toggleDepreciationDetails;

function calculateDepreciation() {
  const table = document.getElementById('depreciationAssetsTable');
  if (!table) return;
  
  const rows = table.querySelectorAll('tr');
  let totalDepreciation = 0;
  
  rows.forEach(row => {
    const cells = row.querySelectorAll('td');
    if (cells.length < 5) return;
    
    const acquisitionCost = parseFloat(cells[1].querySelector('input').value) || 0;
    const usefulLife = parseFloat(cells[2].querySelector('input').value) || 1;
    const method = cells[3].querySelector('select').value;
    
    let annualDepreciation = 0;
    
    if (method === 'straight') {
      // ì •ì•¡ë²•: ì·¨ë“ê°€ì•¡ / ë‚´ìš©ì—°ìˆ˜
      // ì”ì¡´ê°€ì¹˜ 0ì›ìœ¼ë¡œ ê³„ì‚°
      annualDepreciation = acquisitionCost / usefulLife;
    } else if (method === 'declining') {
      // ì •ë¥ ë²•: ì·¨ë“ê°€ì•¡ Ã— ìƒê°ë¥ 
      // ìƒê°ë¥  ê·¼ì‚¬ì¹˜ = 1 - (ì”ì¡´ê°€ì¹˜ìœ¨ ^ (1/ë‚´ìš©ì—°ìˆ˜))
      // ì”ì¡´ê°€ì¹˜ìœ¨ 0.01%ë¡œ ê°€ì • (ì‹¤ì§ˆì ìœ¼ë¡œ 0ì›)
      const rate = 1 - Math.pow(0.0001, 1 / usefulLife);
      annualDepreciation = acquisitionCost * rate;
    }
    
    totalDepreciation += annualDepreciation;
    
    // ì—°ê°„ ìƒê°ë¹„ í‘œì‹œ
    const amountCell = row.querySelector('.depreciation-amount');
    if (amountCell) {
      amountCell.textContent = formatNumberWithCommas(Math.round(annualDepreciation));
    }
  });
  
  // ì´ ê°ê°€ìƒê°ë¹„ ì—…ë°ì´íŠ¸
  const totalEl = document.getElementById('totalDepreciation');
  if (totalEl) {
    totalEl.textContent = formatNumberWithCommas(Math.round(totalDepreciation));
  }
  
  // ê³ ì •ë¹„ í…Œì´ë¸”ì˜ ê°ê°€ìƒê°ë¹„ ì…ë ¥ë€ ì—…ë°ì´íŠ¸
  const depreciationInput = document.getElementById('depreciationInput');
  if (depreciationInput) {
    depreciationInput.value = formatNumberWithCommas(Math.round(totalDepreciation));
  }
  
  // ì¬ë¬´ ìš”ì•½ ì—…ë°ì´íŠ¸
  updateFinancialSummaries();
}

window.calculateDepreciation = calculateDepreciation;

function addDepreciationAsset() {
  const tbody = document.getElementById('depreciationAssetsTable');
  if (!tbody) return;
  
  const newRow = document.createElement('tr');
  newRow.innerHTML = `
    <td style="padding: 6px; border: 1px solid #ddd;"><input type="text" placeholder="ìì‚°ëª… ì…ë ¥" style="width: 100%; padding: 4px; border: 1px solid #ccc; border-radius: 3px; font-size: 12px;"></td>
    <td style="padding: 6px; border: 1px solid #ddd;"><input type="number" value="0" style="width: 100%; padding: 4px; border: 1px solid #ccc; border-radius: 3px; font-size: 12px; text-align: right;" oninput="calculateDepreciation()"></td>
    <td style="padding: 6px; border: 1px solid #ddd;"><input type="number" value="5" style="width: 100%; padding: 4px; border: 1px solid #ccc; border-radius: 3px; font-size: 12px; text-align: center;" oninput="calculateDepreciation()"></td>
    <td style="padding: 6px; border: 1px solid #ddd;">
      <select style="width: 100%; padding: 4px; border: 1px solid #ccc; border-radius: 3px; font-size: 12px;" onchange="calculateDepreciation()">
        <option value="straight" selected>ì •ì•¡ë²•</option>
        <option value="declining">ì •ë¥ ë²•</option>
      </select>
    </td>
    <td style="padding: 6px; border: 1px solid #ddd; text-align: right; font-weight: 600; color: #ff6f00;" class="depreciation-amount">0</td>
    <td style="padding: 6px; border: 1px solid #ddd; text-align: center;"><button class="btn-small btn-delete" onclick="deleteDepreciationAsset(this)" style="font-size: 11px; padding: 3px 8px;">ì‚­ì œ</button></td>
  `;
  
  tbody.appendChild(newRow);
  calculateDepreciation();
}

window.addDepreciationAsset = addDepreciationAsset;

function deleteDepreciationAsset(btn) {
  const row = btn.closest('tr');
  const tbody = row.closest('tbody');
  
  if (tbody.children.length > 1) {
    row.remove();
    calculateDepreciation();
  } else {
    showToast('ìµœì†Œ 1ê°œ ì´ìƒì˜ ìì‚°ì´ í•„ìš”í•©ë‹ˆë‹¤.', 'error');
  }
}

window.deleteDepreciationAsset = deleteDepreciationAsset;

// ì°¨ì…ê¸ˆ ì´ì í† ê¸€ í•¨ìˆ˜
function toggleLoanInterestDetails() {
  const details = document.getElementById('loanInterestDetails');
  const icon = document.getElementById('loanInterestToggleIcon');
  
  if (!details || !icon) return;
  
  if (details.style.display === 'none') {
    details.style.display = 'table-row';
    icon.style.transform = 'rotate(0deg)';
    icon.textContent = 'â–¼';
  } else {
    details.style.display = 'none';
    icon.style.transform = 'rotate(-90deg)';
    icon.textContent = 'â–¶';
  }
}

window.toggleLoanInterestDetails = toggleLoanInterestDetails;

// ì°¨ì…ê¸ˆ ì´ì ê³„ì‚° í•¨ìˆ˜
function calculateLoanInterest() {
  const tbody = document.getElementById('loanInterestTable');
  if (!tbody) return;
  
  const rows = tbody.querySelectorAll('tr');
  let totalInterest = 0;
  
  rows.forEach(row => {
    const amountInput = row.querySelector('td:nth-child(2) input');
    const rateInput = row.querySelector('td:nth-child(3) input');
    const interestCell = row.querySelector('.loan-interest-amount');
    
    if (amountInput && rateInput && interestCell) {
      const amount = parseFloat(amountInput.value) || 0;
      const rate = parseFloat(rateInput.value) || 0;
      
      // ì—°ê°„ ì´ìë¹„ìš© = ì°¨ì…ê¸ˆ Ã— ì´ììœ¨ Ã· 100
      const interest = amount * rate / 100;
      
      interestCell.textContent = formatNumberWithCommas(Math.round(interest));
      totalInterest += interest;
    }
  });
  
  // ì´ ì´ìë¹„ìš© ì—…ë°ì´íŠ¸
  const totalEl = document.getElementById('totalLoanInterest');
  if (totalEl) {
    totalEl.textContent = formatNumberWithCommas(Math.round(totalInterest));
  }
  
  // ê¸ˆìœµ ë° ì„¸ê¸ˆ í…Œì´ë¸”ì˜ ì°¨ì…ê¸ˆ ì´ì ì…ë ¥ë€ ì—…ë°ì´íŠ¸
  const loanInterestInput = document.getElementById('loanInterestInput');
  if (loanInterestInput) {
    loanInterestInput.value = formatNumberWithCommas(Math.round(totalInterest));
  }
  
  // ì¬ë¬´ ìš”ì•½ ì—…ë°ì´íŠ¸
  updateFinancialSummaries();
}

window.calculateLoanInterest = calculateLoanInterest;

function addLoanInterest() {
  const tbody = document.getElementById('loanInterestTable');
  if (!tbody) return;
  
  const newRow = document.createElement('tr');
  newRow.innerHTML = `
    <td style="padding: 6px; border: 1px solid #ddd;"><input type="text" value="ëŒ€ì¶œ" style="width: 100%; padding: 4px; border: 1px solid #ccc; border-radius: 3px; font-size: 12px;"></td>
    <td style="padding: 6px; border: 1px solid #ddd;"><input type="number" value="0" style="width: 100%; padding: 4px; border: 1px solid #ccc; border-radius: 3px; font-size: 12px; text-align: right;" oninput="calculateLoanInterest()"></td>
    <td style="padding: 6px; border: 1px solid #ddd;"><input type="number" value="4.5" step="0.1" style="width: 100%; padding: 4px; border: 1px solid #ccc; border-radius: 3px; font-size: 12px; text-align: center;" oninput="calculateLoanInterest()"></td>
    <td style="padding: 6px; border: 1px solid #ddd; text-align: right; font-weight: 600; color: #1976d2;" class="loan-interest-amount">0</td>
    <td style="padding: 6px; border: 1px solid #ddd; text-align: center;"><button class="btn-small btn-delete" onclick="deleteLoanInterest(this)" style="font-size: 11px; padding: 3px 8px;">ì‚­ì œ</button></td>
  `;
  
  tbody.appendChild(newRow);
  calculateLoanInterest();
}

window.addLoanInterest = addLoanInterest;

function deleteLoanInterest(btn) {
  const tbody = document.getElementById('loanInterestTable');
  if (!tbody) return;
  
  if (tbody.children.length > 1) {
    btn.closest('tr').remove();
    calculateLoanInterest();
  } else {
    showToast('ìµœì†Œ 1ê°œ ì´ìƒì˜ ì°¨ì…ê¸ˆ í•­ëª©ì´ í•„ìš”í•©ë‹ˆë‹¤.', 'error');
  }
}

window.deleteLoanInterest = deleteLoanInterest;

// MAP íŒì—… ì—´ê¸° í•¨ìˆ˜
function openOverviewPopup() {
  const popup = document.getElementById('overviewPopup');
  if (popup) {
    popup.style.display = 'flex';
  }
}

function closeOverviewPopup() {
  const popup = document.getElementById('overviewPopup');
  if (popup) {
    popup.style.display = 'none';
    // íŒì—… ë‹«ì„ ë•Œ ì „ì²´í™”ë©´ ìƒíƒœ ì´ˆê¸°í™”
    const popupContent = document.getElementById('overviewPopupContent');
    if (popupContent) {
      popupContent.style.width = '70%';
      popupContent.style.maxWidth = '1200px';
      popupContent.style.maxHeight = '85vh';
    }
    const fullscreenBtn = document.getElementById('overviewFullscreenBtn');
    if (fullscreenBtn) {
      fullscreenBtn.innerHTML = 'â›¶';
    }
  }
}

function toggleOverviewFullscreen() {
  const popupContent = document.getElementById('overviewPopupContent');
  const btn = document.getElementById('overviewFullscreenBtn');
  const contentContainers = document.querySelectorAll('.overview-tab-content');
  
  if (!popupContent || !btn) return;
  
  const isFullscreen = popupContent.style.width === '95%';
  
  if (isFullscreen) {
    // ì›ë˜ í¬ê¸°ë¡œ
    popupContent.style.width = '70%';
    popupContent.style.maxWidth = '1200px';
    popupContent.style.maxHeight = '85vh';
    btn.innerHTML = 'â›¶';
    
    // ì»¨í…ì¸  ì»¨í…Œì´ë„ˆ ì›ë˜ í¬ê¸°ë¡œ
    contentContainers.forEach(container => {
      container.style.maxWidth = '900px';
    });
  } else {
    // ì „ì²´í™”ë©´ìœ¼ë¡œ
    popupContent.style.width = '95%';
    popupContent.style.maxWidth = 'none';
    popupContent.style.maxHeight = '95vh';
    btn.innerHTML = 'â›¶';
    
    // ì»¨í…ì¸  ì»¨í…Œì´ë„ˆ í™•ëŒ€
    contentContainers.forEach(container => {
      container.style.maxWidth = '100%';
    });
  }
}

function switchOverviewTab(tabName) {
  // ì—´ë¦° í•„í„° ë“œë¡­ë‹¤ìš´ ë‹«ê¸°
  document.querySelectorAll('.transaction-filter-dropdown').forEach(dropdown => {
    dropdown.style.display = 'none';
  });

  // ëª¨ë“  íƒ­ ë²„íŠ¼ì˜ active í´ë˜ìŠ¤ ì œê±°
  document.querySelectorAll('.overview-tab-btn').forEach(btn => {
    btn.style.background = 'rgba(255,255,255,0.2)';
  });
  
  // ëª¨ë“  íƒ­ ì»¨í…ì¸  ìˆ¨ê¸°ê¸°
  document.querySelectorAll('.overview-tab-content').forEach(content => {
    content.style.display = 'none';
  });
  
  // ì„ íƒëœ íƒ­ í™œì„±í™”
  const selectedBtn = document.querySelector(`.overview-tab-btn[data-tab="${tabName}"]`);
  const selectedContent = document.getElementById(`overview-${tabName}`);
  
  if (selectedBtn) selectedBtn.style.background = 'rgba(255,255,255,0.4)';
  if (selectedContent) selectedContent.style.display = 'block';
  
  // ë²¤ì¹˜ë§ˆí‚¹ íƒ­ì´ë©´ ì²« ë²ˆì§¸ ì—…ì²´ í‘œì‹œ
  if (tabName === 'benchmark') {
    switchBenchmarkCompany('company1');
  }
  
  // ìŠ¤í¬ë¡¤ì„ ìµœìƒë‹¨ìœ¼ë¡œ ì´ë™
  const popupContent = document.querySelector('#overviewPopupContent > div[style*="overflow-y: auto"]');
  if (popupContent) {
    popupContent.scrollTop = 0;
  }
}

// ì‹¤ê±°ë˜ê°€ í…Œì´ë¸” ì „ì—­ ë³€ìˆ˜
let transactionTable = null;
let excelWorkbook = null;
let allSheetsData = {};
let transactionData = []; // í˜„ì¬ í…Œì´ë¸” ì›ë³¸ ë°ì´í„°
let mergedSheetsData = []; // ì „ì²´ ì‹œíŠ¸ í†µí•© ë°ì´í„°
let activeFilters = {};  // í™œì„± í•„í„° ì €ì¥
let columnValues = {};   // ì»¬ëŸ¼ë³„ ê³ ìœ  ê°’ ì €ì¥

// ì—‘ì…€ íŒŒì¼ ë¡œë“œ í•¨ìˆ˜
function loadExcelFile(event) {
  const file = event.target.files[0];
  if (!file) return;
  
  console.log('íŒŒì¼ ë¡œë“œ ì‹œì‘:', file.name);
  
  // íŒŒì¼ëª… í‘œì‹œ
  document.getElementById('fileName').textContent = file.name;
  
  const reader = new FileReader();
  reader.onload = function(e) {
    try {
      const data = new Uint8Array(e.target.result);
      excelWorkbook = XLSX.read(data, { type: 'array' });
      
      console.log('ì›Œí¬ë¶ ë¡œë“œ ì™„ë£Œ');
      console.log('ì‹œíŠ¸ ëª©ë¡:', excelWorkbook.SheetNames);
      console.log('ì‹œíŠ¸ ê°œìˆ˜:', excelWorkbook.SheetNames.length);
      
      // ëª¨ë“  ì‹œíŠ¸ ë°ì´í„° ì½ê¸°
      allSheetsData = {};
      excelWorkbook.SheetNames.forEach((sheetName) => {
        const worksheet = excelWorkbook.Sheets[sheetName];
        
        // ë°°ì—´ í˜•íƒœë¡œ ì „ì²´ ë°ì´í„° ì½ê¸° (ëª¨ë“  í–‰)
        const rawData = XLSX.utils.sheet_to_json(worksheet, { header: 1, defval: '' });
        console.log(`ì‹œíŠ¸ "${sheetName}" ì „ì²´ í–‰ ìˆ˜:`, rawData.length);
        
        if (rawData.length === 0) {
          allSheetsData[sheetName] = [];
          return;
        }
        
        // ì‹¤ì œ í—¤ë” í–‰ ì°¾ê¸° (ë‹¤ì–‘í•œ ê°’ì´ ìˆëŠ” í–‰)
        let headerRowIndex = 0;
        for (let i = 0; i < Math.min(20, rawData.length); i++) {
          const row = rawData[i];
          const nonEmptyCells = row.filter(cell => cell && cell.toString().trim() !== '').length;
          
          // 5ê°œ ì´ìƒì˜ ì»¬ëŸ¼ì´ ìˆê³ , "NO"ë‚˜ "ì‹œêµ°êµ¬" ê°™ì€ í‚¤ì›Œë“œê°€ ìˆìœ¼ë©´ í—¤ë”ë¡œ íŒë‹¨
          if (nonEmptyCells >= 5) {
            const rowStr = JSON.stringify(row);
            if (rowStr.includes('NO') || rowStr.includes('ì‹œêµ°êµ¬') || rowStr.includes('ë²•ì§€') || rowStr.includes('ì§€ëª©')) {
              headerRowIndex = i;
              console.log(`í—¤ë” í–‰ ë°œê²¬: ${i}ë²ˆì§¸ í–‰`, row);
              break;
            }
          }
        }
        
        // í—¤ë” ì¶”ì¶œ
        const headers = rawData[headerRowIndex];
        console.log(`ì‹œíŠ¸ "${sheetName}" í—¤ë” (${headerRowIndex}ë²ˆì§¸ í–‰):`, headers);
        
        // ë‚˜ë¨¸ì§€ í–‰ë“¤ì„ ê°ì²´ ë°°ì—´ë¡œ ë³€í™˜
        const jsonData = [];
        for (let i = headerRowIndex + 1; i < rawData.length; i++) {
          const row = rawData[i];
          
          // ë¹ˆ í–‰ ê±´ë„ˆë›°ê¸°
          const hasData = row.some(cell => cell && cell.toString().trim() !== '');
          if (!hasData) continue;
          
          const rowObj = {};
          
          // ê° ì…€ì„ í—¤ë”ì™€ ë§¤ì¹­
          headers.forEach((header, index) => {
            const headerKey = header && header.toString().trim() !== '' ? header.toString().trim() : `ì»¬ëŸ¼${index + 1}`;
            rowObj[headerKey] = row[index] !== undefined && row[index] !== null ? row[index] : '';
          });
          
          jsonData.push(rowObj);
        }
        
        console.log(`ì‹œíŠ¸ "${sheetName}" ë°ì´í„° í–‰ ìˆ˜:`, jsonData.length);
        if (jsonData.length > 0) {
          console.log(`ì‹œíŠ¸ "${sheetName}" ì»¬ëŸ¼ (${Object.keys(jsonData[0]).length}ê°œ):`, Object.keys(jsonData[0]));
          console.log(`ì‹œíŠ¸ "${sheetName}" ì²« ë²ˆì§¸ ë°ì´í„°:`, jsonData[0]);
        }
        
        allSheetsData[sheetName] = jsonData;
      });
      
      // ì „ì²´ ì‹œíŠ¸ í†µí•© ë°ì´í„° ìƒì„±
      mergedSheetsData = getAllSheetsMergedData();

      // ì‹œíŠ¸ ì„ íƒ ë“œë¡­ë‹¤ìš´ ìƒì„±
      const sheetSelect = document.getElementById('sheetSelect');
      sheetSelect.innerHTML = '';

      // ì „ì²´ ì‹œíŠ¸(í†µí•©) ì˜µì…˜
      const allOption = document.createElement('option');
      allOption.value = '__all__';
      allOption.textContent = `ì „ì²´ ì‹œíŠ¸(í†µí•©) (${mergedSheetsData.length}í–‰)`;
      sheetSelect.appendChild(allOption);
      
      excelWorkbook.SheetNames.forEach((sheetName) => {
        const option = document.createElement('option');
        option.value = sheetName;
        option.textContent = `${sheetName} (${allSheetsData[sheetName].length}í–‰)`;
        sheetSelect.appendChild(option);
      });
      
      // ì‹œíŠ¸ ì„ íƒê¸° í‘œì‹œ
      document.getElementById('sheetSelector').style.display = 'flex';
      
      // í†µí•© ì‹œíŠ¸ ê¸°ë³¸ í‘œì‹œ
      if (mergedSheetsData.length > 0) {
        sheetSelect.value = '__all__';
        createTransactionTable(mergedSheetsData);
        updatePricePerM2Summary();
      } else {
        console.warn('í†µí•© ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');
        // ë°ì´í„°ê°€ ìˆëŠ” ì²« ë²ˆì§¸ ì‹œíŠ¸ ì°¾ê¸°
        const sheetWithData = excelWorkbook.SheetNames.find(name => allSheetsData[name].length > 0);
        if (sheetWithData) {
          sheetSelect.value = sheetWithData;
          createTransactionTable(allSheetsData[sheetWithData]);
          updatePricePerM2Summary();
        } else {
          alert('ì—‘ì…€ íŒŒì¼ì—ì„œ ë°ì´í„°ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. íŒŒì¼ì„ í™•ì¸í•´ì£¼ì„¸ìš”.');
        }
      }
      
    } catch (error) {
      console.error('ì—‘ì…€ íŒŒì¼ ë¡œë“œ ì¤‘ ì˜¤ë¥˜:', error);
      alert('ì—‘ì…€ íŒŒì¼ì„ ì½ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
    }
  };
  
  reader.readAsArrayBuffer(file);
}

// ì‹œíŠ¸ ë³€ê²½ í•¨ìˆ˜
function changeSheet() {
  const selectedSheet = document.getElementById('sheetSelect').value;
  console.log('ì‹œíŠ¸ ë³€ê²½:', selectedSheet);
  if (selectedSheet === '__all__') {
    mergedSheetsData = getAllSheetsMergedData();
    const sheetSelect = document.getElementById('sheetSelect');
    const allOption = sheetSelect.querySelector('option[value="__all__"]');
    if (allOption) {
      allOption.textContent = `ì „ì²´ ì‹œíŠ¸(í†µí•©) (${mergedSheetsData.length}í–‰)`;
    }
  }

  const sheetData = selectedSheet === '__all__' ? mergedSheetsData : allSheetsData[selectedSheet];
  
  if (sheetData && sheetData.length > 0) {
    createTransactionTable(sheetData);
    updatePricePerM2Summary();
  } else {
    alert('ì„ íƒí•œ ì‹œíŠ¸ì— ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');
  }
}

function getAllSheetsMergedData() {
  const sheetNames = Object.keys(allSheetsData || {});
  const merged = [];
  const allKeys = new Set(['ì‹œíŠ¸']);

  sheetNames.forEach(name => {
    const rows = allSheetsData[name] || [];
    rows.forEach(row => {
      Object.keys(row || {}).forEach(key => allKeys.add(key));
    });
  });

  sheetNames.forEach(name => {
    const rows = allSheetsData[name] || [];
    rows.forEach(row => {
      const mergedRow = { ì‹œíŠ¸: name };
      allKeys.forEach(key => {
        if (key === 'ì‹œíŠ¸') return;
        mergedRow[key] = row[key] !== undefined && row[key] !== null ? row[key] : '';
      });
      merged.push(mergedRow);
    });
  });

  return merged;
}

// í•„í„° ê°’ ì •ê·œí™” í•¨ìˆ˜
function normalizeFilterValue(value) {
  if (value === undefined || value === null) {
    return '(ë¹ˆ ê°’)';
  }

  const str = value.toString().trim();
  return str === '' ? '(ë¹ˆ ê°’)' : str;
}

// ìˆ«ì ê°’ íŒŒì‹± í•¨ìˆ˜
function parseNumericValue(value) {
  const normalized = normalizeFilterValue(value);
  if (normalized === '(ë¹ˆ ê°’)') {
    return null;
  }

  const cleaned = normalized.replace(/,/g, '');
  const num = Number(cleaned);
  return Number.isFinite(num) ? num : null;
}

// ì¡°ê±´ë¶€ í•„í„° í‰ê°€ í•¨ìˆ˜
function evaluateCondition(condition, cellValueText) {
  if (!condition || !condition.op || condition.value === '' || condition.value === null || condition.value === undefined) {
    return true;
  }

  const normalizedCell = normalizeFilterValue(cellValueText);
  const normalizedValue = normalizeFilterValue(condition.value);

  switch (condition.op) {
    case 'eq':
      return normalizedCell === normalizedValue;
    case 'neq':
      return normalizedCell !== normalizedValue;
    case 'contains':
      return normalizedCell.includes(normalizedValue);
    case 'starts':
      return normalizedCell.startsWith(normalizedValue);
    case 'ends':
      return normalizedCell.endsWith(normalizedValue);
    case 'gt':
    case 'gte':
    case 'lt':
    case 'lte':
    case 'between': {
      const cellNum = parseNumericValue(normalizedCell);
      const filterNum = parseNumericValue(normalizedValue);
      const filterNum2 = parseNumericValue(condition.value2);
      if (cellNum === null || filterNum === null) {
        return false;
      }
      switch (condition.op) {
        case 'gt':
          return cellNum > filterNum;
        case 'gte':
          return cellNum >= filterNum;
        case 'lt':
          return cellNum < filterNum;
        case 'lte':
          return cellNum <= filterNum;
        case 'between':
          return filterNum2 !== null && cellNum >= filterNum && cellNum <= filterNum2;
        default:
          return true;
      }
    }
    default:
      return true;
  }
}

// í•„í„° ë§¤ì¹­ ì—¬ë¶€ (íŠ¹ì • í•„ë“œ ì œì™¸ ê°€ëŠ¥)
function rowMatchesFilters(rowData, excludeField = null) {
  // activeFiltersê°€ ë¹„ì–´ìˆìœ¼ë©´ ëª¨ë“  í–‰ í‘œì‹œ
  if (!activeFilters || Object.keys(activeFilters).length === 0) {
    return true;
  }

  // ëª¨ë“  í™œì„± í•„í„°ë¥¼ í™•ì¸
  for (let field in activeFilters) {
    if (excludeField && field === excludeField) {
      continue;
    }

    const filterState = activeFilters[field];
    const selectedValues = Array.isArray(filterState)
      ? filterState
      : (filterState && Array.isArray(filterState.values) ? filterState.values : []);
    const conditionFilter = !Array.isArray(filterState) && filterState && filterState.condition
      ? filterState.condition
      : null;
    const logicOp = !Array.isArray(filterState) && filterState && filterState.logic
      ? filterState.logic
      : 'and';

    const cellValue = rowData[field];
    const cellValueStr = normalizeFilterValue(cellValue);

    let checkboxMatch = true;
    if (selectedValues && selectedValues.length > 0) {
      checkboxMatch = selectedValues.includes(cellValueStr);
    }

    let conditionMatch = true;
    const cond1 = conditionFilter && conditionFilter.cond1 ? conditionFilter.cond1 : null;
    const cond2 = conditionFilter && conditionFilter.cond2 ? conditionFilter.cond2 : null;
    const conditionJoin = conditionFilter && conditionFilter.join ? conditionFilter.join : 'and';

    if (cond1 && cond1.value !== '' && cond1.value !== null && cond1.value !== undefined) {
      const match1 = evaluateCondition(cond1, cellValueStr);
      const match2 = evaluateCondition(cond2, cellValueStr);
      if (cond2 && cond2.value !== '' && cond2.value !== null && cond2.value !== undefined) {
        conditionMatch = conditionJoin === 'or' ? (match1 || match2) : (match1 && match2);
      } else {
        conditionMatch = match1;
      }
    }

    const hasCheckboxFilter = selectedValues && selectedValues.length > 0;
    const hasConditionFilter = conditionFilter && conditionFilter.cond1 && conditionFilter.cond1.value !== '' && conditionFilter.cond1.value !== null && conditionFilter.cond1.value !== undefined;

    if (hasCheckboxFilter && hasConditionFilter) {
      if (logicOp === 'or') {
        if (!(checkboxMatch || conditionMatch)) return false;
      } else {
        if (!(checkboxMatch && conditionMatch)) return false;
      }
    } else if (hasCheckboxFilter) {
      if (!checkboxMatch) return false;
    } else if (hasConditionFilter) {
      if (!conditionMatch) return false;
    }
  }

  return true; // ëª¨ë“  í•„í„° í†µê³¼
}

// ì—‘ì…€ ìŠ¤íƒ€ì¼ í•„í„° í•¨ìˆ˜ (ì „ì—­)
function excelStyleFilter(rowData) {
  return rowMatchesFilters(rowData);
}

// ë‹¤ë¥¸ ì»¬ëŸ¼ í•„í„°ë¥¼ ë°˜ì˜í•œ ê°’ ëª©ë¡ ìƒì„±
function getAvailableColumnValues(field) {
  if (!transactionData || transactionData.length === 0) {
    return columnValues[field] || [];
  }

  const filteredRows = transactionData.filter(row => rowMatchesFilters(row, field));
  const uniqueValues = [...new Set(filteredRows.map(row => normalizeFilterValue(row[field])))]
    .sort();
  return uniqueValues;
}

// í•„í„°ë§ëœ í˜„ì¬ ë°ì´í„° ë°˜í™˜
function getFilteredTransactionRows() {
  if (transactionTable) {
    return transactionTable.getData("active");
  }

  return transactionData.filter(row => rowMatchesFilters(row));
}

function findColumnKey(columns, candidates) {
  if (!columns || columns.length === 0) {
    return null;
  }

  for (const candidate of candidates) {
    const key = columns.find(col => col.includes(candidate));
    if (key) return key;
  }

  return null;
}

function calculatePercentile(sortedValues, percentile) {
  if (sortedValues.length === 0) {
    return null;
  }
  const index = (sortedValues.length - 1) * percentile;
  const lower = Math.floor(index);
  const upper = Math.ceil(index);
  if (lower === upper) {
    return sortedValues[lower];
  }
  const weight = index - lower;
  return sortedValues[lower] * (1 - weight) + sortedValues[upper] * weight;
}

function updatePricePerM2Summary() {
  const summaryEl = document.getElementById('pricePerM2Summary');
  const includeOutliersToggle = document.getElementById('includeOutliersToggle');
  if (!summaryEl || !includeOutliersToggle) {
    return;
  }

  const rows = getFilteredTransactionRows();
  if (!rows || rows.length === 0) {
    summaryEl.innerHTML = 'í•„í„°ëœ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.';
    return;
  }

  const columns = Object.keys(rows[0] || {});
  const areaKey = findColumnKey(columns, ['ê³„ì•½ë©´ì ', 'ë©´ì ']);
  const priceKey = findColumnKey(columns, ['ê±°ë˜ê¸ˆì•¡', 'ê¸ˆì•¡']);

  if (!areaKey || !priceKey) {
    summaryEl.innerHTML = 'ê³„ì•½ë©´ì  ë˜ëŠ” ê±°ë˜ê¸ˆì•¡ ì»¬ëŸ¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.';
    return;
  }

  const unitPrices = [];
  let totalArea = 0;
  let totalPrice = 0;
  rows.forEach(row => {
    const area = parseNumericValue(row[areaKey]);
    const price = parseNumericValue(row[priceKey]);
    if (area && price && area > 0) {
      unitPrices.push(price / area);
      totalArea += area;
      totalPrice += price;
    }
  });

  if (unitPrices.length === 0) {
    summaryEl.innerHTML = 'ìœ íš¨í•œ ê±°ë˜ë©´ì /ê±°ë˜ê¸ˆì•¡ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.';
    return;
  }

  unitPrices.sort((a, b) => a - b);

  let usedPrices = unitPrices;
  let iqrInfo = '';

  if (!includeOutliersToggle.checked && unitPrices.length >= 4) {
    const q1 = calculatePercentile(unitPrices, 0.25);
    const q3 = calculatePercentile(unitPrices, 0.75);
    const iqr = q3 - q1;
    const lower = q1 - 1.5 * iqr;
    const upper = q3 + 1.5 * iqr;
    usedPrices = unitPrices.filter(v => v >= lower && v <= upper);

    iqrInfo = ` (IQR ì œì™¸: ${lower.toFixed(2)} ~ ${upper.toFixed(2)})`;
  }

  const totalUnitPrice = usedPrices.reduce((sum, v) => sum + v, 0);
  const avg = totalArea > 0 ? (totalPrice / totalArea) : (totalUnitPrice / usedPrices.length);
  const avgPerPyeong = avg * 3.3;
  const totalAreaPyeong = totalArea / 3.3;
  const outlierText = includeOutliersToggle.checked ? 'ì´ìƒì¹˜ í¬í•¨' : 'ì´ìƒì¹˜ ì œì™¸';

  summaryEl.innerHTML = `
    <div><strong>ê²°ê³¼:</strong> ${avg.toLocaleString(undefined, { maximumFractionDigits: 2 })} ë§Œì›/mÂ² (${outlierText})</div>
    <div style="margin-top: 4px; color: #555;">í‰ë‹¹: ${avgPerPyeong.toLocaleString(undefined, { maximumFractionDigits: 2 })} ë§Œì›/í‰</div>
    <div style="margin-top: 6px; display: flex; flex-wrap: wrap; gap: 8px;">
      <span style="background: #e8f4ff; color: #2c3e50; padding: 4px 8px; border-radius: 4px;">ì´ ê±°ë˜ê¸ˆì•¡: ${totalPrice.toLocaleString(undefined, { maximumFractionDigits: 2 })} ë§Œì›</span>
      <span style="background: #e9f8f1; color: #2c3e50; padding: 4px 8px; border-radius: 4px;">ì´ ë©´ì : ${totalArea.toLocaleString(undefined, { maximumFractionDigits: 2 })} mÂ² (${totalAreaPyeong.toLocaleString(undefined, { maximumFractionDigits: 2 })} í‰)</span>
      <span style="background: #f4eefe; color: #2c3e50; padding: 4px 8px; border-radius: 4px;">ê±°ë˜ê¸ˆì•¡ Ã· ë©´ì : ${(totalArea > 0 ? (totalPrice / totalArea) : 0).toLocaleString(undefined, { maximumFractionDigits: 2 })} ë§Œì›/mÂ²</span>
    </div>
    <div style="margin-top: 6px; color: #666;">í•„í„°ëœ í–‰ ìˆ˜: ${rows.length} / ìœ íš¨ ë°ì´í„°: ${unitPrices.length} / ì ìš© ë°ì´í„°: ${usedPrices.length}${iqrInfo}</div>
    <div style="margin-top: 4px; color: #666;">ë¡œì§: ê±°ë˜ê¸ˆì•¡(ë§Œì›) Ã· ê³„ì•½ë©´ì (mÂ²), ${includeOutliersToggle.checked ? 'ì „ì²´ í‰ê· ' : 'IQR(1.5ë°°)ë¡œ ì´ìƒì¹˜ ì œê±° í›„ í‰ê· '}</div>
  `;
}

// Tabulator í…Œì´ë¸” ìƒì„± í•¨ìˆ˜
function createTransactionTable(data) {
  console.log('í…Œì´ë¸” ìƒì„± ì‹œì‘');
  console.log('ë°ì´í„° í–‰ ìˆ˜:', data.length);
  console.log('ì²« ë²ˆì§¸ ë°ì´í„°:', data[0]);
  
  if (!data || data.length === 0) {
    console.warn('ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');
    return;
  }
  
  // í•„í„° ì´ˆê¸°í™”
  activeFilters = {};

  // ì›ë³¸ ë°ì´í„° ì €ì¥
  transactionData = Array.isArray(data) ? data : [];
  
  // ì»¬ëŸ¼ë³„ ê³ ìœ  ê°’ ì¶”ì¶œ (í•„í„°ìš©)
  columnValues = {};
  const columnKeys = Object.keys(data[0]);
  
  columnKeys.forEach(key => {
    const uniqueValues = [...new Set(data.map(row => normalizeFilterValue(row[key])))]
      .sort();
    columnValues[key] = uniqueValues;
  });
  
  console.log('ì»¬ëŸ¼ë³„ ê³ ìœ  ê°’:', columnValues);
  console.log('ì»¬ëŸ¼ë³„ ê³ ìœ  ê°’:', columnValues);
  
  // ì»¤ìŠ¤í…€ í—¤ë” í•„í„° ìƒì„± í•¨ìˆ˜
  function createExcelFilter(cell, onRendered, success, cancel, editorParams) {
    const container = document.createElement("div");
    container.style.cssText = "position: relative; width: 100%;";
    
    const button = document.createElement("button");
    button.innerHTML = "â–¼ í•„í„°";
    button.style.cssText = "width: 100%; padding: 4px; background: white; border: 1px solid #ddd; cursor: pointer; font-size: 12px;";
    
    const dropdown = document.createElement("div");
    dropdown.className = "transaction-filter-dropdown";
    dropdown.style.cssText = "display: none; position: fixed; background: white; border: 2px solid #667eea; box-shadow: 0 8px 16px rgba(0,0,0,0.3); z-index: 999999; min-width: 220px; max-height: 400px; border-radius: 6px; display: flex; flex-direction: column;";
    
    const field = cell.getColumn().getField();
    const values = getAvailableColumnValues(field);
    const currentFilter = activeFilters[field];
    const activeSelected = Array.isArray(currentFilter)
      ? currentFilter
      : (currentFilter && Array.isArray(currentFilter.values) ? currentFilter.values : null);
    const activeSelectedSet = activeSelected ? new Set(activeSelected.map(normalizeFilterValue)) : null;
    const activeCondition = currentFilter && !Array.isArray(currentFilter) ? currentFilter.condition : null;

    // ì¡°ê±´ë¶€ í•„í„° UI
    const conditionDiv = document.createElement("div");
    conditionDiv.style.cssText = "padding: 8px; border-bottom: 2px solid #ddd; background: #fff;";

    const conditionToggle = document.createElement("input");
    conditionToggle.type = "checkbox";
    conditionToggle.id = `condition_${field}`;
    conditionToggle.style.marginRight = "8px";

    const conditionLabel = document.createElement("label");
    conditionLabel.htmlFor = `condition_${field}`;
    conditionLabel.innerHTML = "ì¡°ê±´ë¶€ í•„í„° ì‚¬ìš©";
    conditionLabel.style.cursor = "pointer";
    conditionLabel.style.fontWeight = "600";

    const conditionControls = document.createElement("div");
    conditionControls.style.cssText = "display: none; flex-direction: column; gap: 6px; margin-top: 6px;";

    const conditionOp1 = document.createElement("select");
    conditionOp1.style.cssText = "padding: 4px; font-size: 12px;";
    const ops = [
      { value: 'eq', label: '=' },
      { value: 'neq', label: 'â‰ ' },
      { value: 'contains', label: 'í¬í•¨' },
      { value: 'starts', label: 'ì‹œì‘' },
      { value: 'ends', label: 'ë' },
      { value: 'gt', label: '>' },
      { value: 'gte', label: 'â‰¥' },
      { value: 'lt', label: '<' },
      { value: 'lte', label: 'â‰¤' },
      { value: 'between', label: 'ë²”ìœ„' }
    ];
    ops.forEach(op => {
      const option = document.createElement("option");
      option.value = op.value;
      option.textContent = op.label;
      conditionOp1.appendChild(option);
    });

    const conditionInput1 = document.createElement("input");
    conditionInput1.type = "text";
    conditionInput1.placeholder = "ê°’";
    conditionInput1.style.cssText = "width: 80px; padding: 4px; font-size: 12px;";

    const conditionInput2 = document.createElement("input");
    conditionInput2.type = "text";
    conditionInput2.placeholder = "~";
    conditionInput2.style.cssText = "width: 80px; padding: 4px; font-size: 12px; display: none;";

    const conditionJoin = document.createElement("select");
    conditionJoin.style.cssText = "padding: 4px; font-size: 12px;";
    const joinOptions = [
      { value: 'and', label: 'AND' },
      { value: 'or', label: 'OR' }
    ];
    joinOptions.forEach(op => {
      const option = document.createElement("option");
      option.value = op.value;
      option.textContent = op.label;
      conditionJoin.appendChild(option);
    });

    const conditionOp2 = document.createElement("select");
    conditionOp2.style.cssText = "padding: 4px; font-size: 12px;";
    ops.forEach(op => {
      const option = document.createElement("option");
      option.value = op.value;
      option.textContent = op.label;
      conditionOp2.appendChild(option);
    });

    const conditionInput3 = document.createElement("input");
    conditionInput3.type = "text";
    conditionInput3.placeholder = "ê°’";
    conditionInput3.style.cssText = "width: 80px; padding: 4px; font-size: 12px;";

    const conditionInput4 = document.createElement("input");
    conditionInput4.type = "text";
    conditionInput4.placeholder = "~";
    conditionInput4.style.cssText = "width: 80px; padding: 4px; font-size: 12px; display: none;";

    function updateConditionControls() {
      const enabled = conditionToggle.checked;
      conditionControls.style.display = enabled ? "flex" : "none";
      conditionControls.style.opacity = enabled ? "1" : "0.5";
      conditionOp1.disabled = !enabled;
      conditionInput1.disabled = !enabled;
      conditionInput2.disabled = !enabled;
      conditionJoin.disabled = !enabled;
      conditionOp2.disabled = !enabled;
      conditionInput3.disabled = !enabled;
      conditionInput4.disabled = !enabled;

      conditionInput2.style.display = conditionOp1.value === 'between' ? "inline-block" : "none";
      conditionInput4.style.display = conditionOp2.value === 'between' ? "inline-block" : "none";
    }

    conditionOp1.onchange = updateConditionControls;
    conditionOp2.onchange = updateConditionControls;
    conditionToggle.onchange = updateConditionControls;

    if (activeCondition && activeCondition.cond1 && activeCondition.cond1.op) {
      conditionToggle.checked = true;
      conditionOp1.value = activeCondition.cond1.op;
      conditionInput1.value = activeCondition.cond1.value ?? '';
      conditionInput2.value = activeCondition.cond1.value2 ?? '';
    }

    if (activeCondition && activeCondition.cond2 && activeCondition.cond2.op) {
      conditionOp2.value = activeCondition.cond2.op;
      conditionInput3.value = activeCondition.cond2.value ?? '';
      conditionInput4.value = activeCondition.cond2.value2 ?? '';
    }

    if (activeCondition && activeCondition.join) {
      conditionJoin.value = activeCondition.join;
    }

    updateConditionControls();

    const conditionLine1 = document.createElement("div");
    conditionLine1.style.cssText = "display: flex; gap: 6px; align-items: center;";
    conditionLine1.appendChild(conditionOp1);
    conditionLine1.appendChild(conditionInput1);
    conditionLine1.appendChild(conditionInput2);

    const conditionLine2 = document.createElement("div");
    conditionLine2.style.cssText = "display: flex; gap: 6px; align-items: center;";
    conditionLine2.appendChild(conditionJoin);

    const conditionLine3 = document.createElement("div");
    conditionLine3.style.cssText = "display: flex; gap: 6px; align-items: center;";
    conditionLine3.appendChild(conditionOp2);
    conditionLine3.appendChild(conditionInput3);
    conditionLine3.appendChild(conditionInput4);

    conditionControls.appendChild(conditionLine1);
    conditionControls.appendChild(conditionLine2);
    conditionControls.appendChild(conditionLine3);

    conditionDiv.appendChild(conditionToggle);
    conditionDiv.appendChild(conditionLabel);
    conditionDiv.appendChild(conditionControls);

    dropdown.appendChild(conditionDiv);
    
    // ìŠ¤í¬ë¡¤ ê°€ëŠ¥í•œ ì»¨í…ì¸  ì˜ì—­
    const scrollContent = document.createElement("div");
    scrollContent.style.cssText = "overflow-y: auto; flex: 1; max-height: 260px;";

    // í…ìŠ¤íŠ¸ ê²€ìƒ‰ ì…ë ¥
    const searchDiv = document.createElement("div");
    searchDiv.style.cssText = "padding: 8px; border-bottom: 1px solid #eee; background: #fff;";
    const searchInput = document.createElement("input");
    searchInput.type = "text";
    searchInput.placeholder = "í…ìŠ¤íŠ¸ ê²€ìƒ‰";
    searchInput.style.cssText = "width: 100%; padding: 6px; font-size: 12px;";
    searchDiv.appendChild(searchInput);
    scrollContent.appendChild(searchDiv);
    
    // ì „ì²´ ì„ íƒ/í•´ì œ ì²´í¬ë°•ìŠ¤
    const selectAllDiv = document.createElement("div");
    selectAllDiv.style.cssText = "padding: 8px; border-bottom: 2px solid #667eea; background: #f8f9fa; display: flex; align-items: center;";
    const selectAllCheckbox = document.createElement("input");
    selectAllCheckbox.type = "checkbox";
    selectAllCheckbox.checked = true;
    selectAllCheckbox.id = `selectAll_${field}`;
    selectAllCheckbox.style.marginRight = "8px";
    const selectAllLabel = document.createElement("label");
    selectAllLabel.htmlFor = `selectAll_${field}`;
    selectAllLabel.innerHTML = "ì „ì²´ ì„ íƒ";
    selectAllLabel.style.cursor = "pointer";
    selectAllLabel.style.fontWeight = "600";
    selectAllDiv.appendChild(selectAllCheckbox);
    selectAllDiv.appendChild(selectAllLabel);
    scrollContent.appendChild(selectAllDiv);
    
    // ê°œë³„ ê°’ ì²´í¬ë°•ìŠ¤ë“¤
    const checkboxes = [];
    const checkboxRows = [];
    values.forEach(value => {
      const div = document.createElement("div");
      div.style.cssText = "padding: 6px 8px; cursor: pointer; display: flex; align-items: center; width: 100%; box-sizing: border-box;";
      div.onmouseover = () => div.style.background = "#f0f0f0";
      div.onmouseout = () => div.style.background = "white";
      
      const checkbox = document.createElement("input");
      checkbox.type = "checkbox";
      const normalizedValue = normalizeFilterValue(value);
      checkbox.value = normalizedValue;
      checkbox.checked = !activeSelectedSet || activeSelectedSet.has(normalizedValue);
      checkbox.style.marginRight = "8px";
      
      const label = document.createElement("label");
      label.innerHTML = value;
      label.style.cursor = "pointer";
      label.style.fontSize = "13px";
      label.style.flex = "1";
      label.style.whiteSpace = "nowrap";
      label.style.overflow = "hidden";
      label.style.textOverflow = "ellipsis";
      label.title = value;
      
      div.appendChild(checkbox);
      div.appendChild(label);
      scrollContent.appendChild(div);
      checkboxes.push(checkbox);
      checkboxRows.push({ div, label, value: value.toString() });
      
      // í´ë¦­ ì‹œ ì²´í¬ë°•ìŠ¤ í† ê¸€
      div.onclick = (e) => {
        if (e.target !== checkbox) {
          checkbox.checked = !checkbox.checked;
        }
        updateSelectAll();
      };
    });
    
    dropdown.appendChild(scrollContent);
    
    // ì „ì²´ ì„ íƒ ì—…ë°ì´íŠ¸
    function updateSelectAll() {
      const visibleCheckboxes = checkboxRows
        .filter(row => row.div.style.display !== "none")
        .map(row => row.div.querySelector("input[type='checkbox']"));

      if (visibleCheckboxes.length === 0) {
        selectAllCheckbox.checked = false;
        return;
      }

      const allChecked = visibleCheckboxes.every(cb => cb.checked);
      selectAllCheckbox.checked = allChecked;
    }
    
    // ì´ˆê¸° ìƒíƒœ ë°˜ì˜
    updateSelectAll();

    // ì „ì²´ ì„ íƒ/í•´ì œ í•¸ë“¤ëŸ¬
    selectAllCheckbox.onchange = () => {
      checkboxRows.forEach(row => {
        if (row.div.style.display !== "none") {
          const cb = row.div.querySelector("input[type='checkbox']");
          cb.checked = selectAllCheckbox.checked;
        }
      });
    };

    // í…ìŠ¤íŠ¸ ê²€ìƒ‰ í•„í„°
    searchInput.oninput = () => {
      const query = searchInput.value.trim().toLowerCase();
      checkboxRows.forEach(row => {
        const text = row.value.toLowerCase();
        row.div.style.display = text.includes(query) ? "flex" : "none";
      });
      updateSelectAll();
    };
    
    // ì ìš© ë²„íŠ¼ (sticky)
    const applyDiv = document.createElement("div");
    applyDiv.style.cssText = "padding: 8px; border-top: 2px solid #ddd; display: flex; gap: 5px; background: #f8f9fa; position: sticky; bottom: 0; z-index: 10;";
    
    const applyBtn = document.createElement("button");
    applyBtn.innerHTML = "ì ìš©";
    applyBtn.style.cssText = "flex: 1; padding: 8px; background: #667eea; color: white; border: none; border-radius: 4px; cursor: pointer; font-weight: 600; font-size: 13px;";
    applyBtn.onmouseover = () => applyBtn.style.background = "#5568d3";
    applyBtn.onmouseout = () => applyBtn.style.background = "#667eea";
    applyBtn.onclick = () => {
      const selectedValues = checkboxRows
        .filter(row => row.div.style.display !== "none")
        .map(row => row.div.querySelector("input[type='checkbox']"))
        .filter(cb => cb.checked)
        .map(cb => cb.value);
      const allSelected = selectedValues.length === values.length;
      const conditionEnabled = conditionToggle.checked;
      const conditionValue1 = conditionInput1.value.trim();
      const conditionValue2 = conditionInput2.value.trim();

      const conditionFilter = conditionEnabled
        ? {
            cond1: {
              op: conditionOp1.value,
              value: conditionValue1,
              value2: conditionOp1.value === 'between' ? conditionValue2 : null
            },
            cond2: {
              op: conditionOp2.value,
              value: conditionInput3.value.trim(),
              value2: conditionOp2.value === 'between' ? conditionInput4.value.trim() : null
            },
            join: conditionJoin.value
          }
        : null;
      
      console.log('í•„í„° ì ìš©:', field, 'ì„ íƒëœ ê°’:', selectedValues);
      console.log('ì„ íƒëœ ê°’ ê°œìˆ˜:', selectedValues.length, '/ ì „ì²´:', values.length);
      
      if (selectedValues.length === 0 && !conditionFilter) {
        // ì•„ë¬´ê²ƒë„ ì„ íƒ ì•ˆ ëê³  ìˆ«ì í•„í„°ë„ ì—†ìœ¼ë©´ í•´ë‹¹ í•„ë“œì˜ í•„í„° ì œê±°
        console.log('í•„í„° ì œê±°:', field);
        delete activeFilters[field];
      } else if (allSelected && !conditionFilter) {
        // ëª¨ë‘ ì„ íƒì´ê³  ìˆ«ì í•„í„°ê°€ ì—†ìœ¼ë©´ í•´ë‹¹ í•„ë“œì˜ í•„í„° ì œê±°
        console.log('í•„í„° ì œê±°:', field);
        delete activeFilters[field];
      } else {
        const storedValues = allSelected ? [] : selectedValues;
        const filterPayload = {
          values: storedValues,
          condition: conditionFilter && conditionFilter.cond1 && conditionFilter.cond1.value !== '' ? conditionFilter : null,
          logic: 'and'
        };
        console.log('í•„í„° ì„¤ì •:', field, filterPayload);
        activeFilters[field] = filterPayload;
      }
      
      console.log('í˜„ì¬ í™œì„± í•„í„°:', activeFilters);
      
      // í•„í„° ì¬ì ìš© - í•­ìƒ clearFilter ë¨¼ì € í˜¸ì¶œ
      console.log('í•„í„° ì¬ì„¤ì • ì‹œì‘');
      transactionTable.clearFilter();
      
      if (Object.keys(activeFilters).length > 0) {
        console.log('ìƒˆ í•„í„° ì¶”ê°€:', Object.keys(activeFilters));
        transactionTable.addFilter(excelStyleFilter);
      } else {
        console.log('í•„í„° ì—†ìŒ - ëª¨ë“  ë°ì´í„° í‘œì‹œ');
      }
      
      setTimeout(() => {
        console.log('í•„í„° ì ìš© ì™„ë£Œ - í–‰ ìˆ˜:', transactionTable.getDataCount());
        updatePricePerM2Summary();
      }, 100);
      
      dropdown.style.display = "none";
      // Tabulator ê¸°ë³¸ í—¤ë” í•„í„° ê°’ì€ ì‚¬ìš©í•˜ì§€ ì•ŠìŒ (ì»¤ìŠ¤í…€ í•„í„°ë§Œ ì ìš©)
      success("");
    };
    
    const cancelBtn = document.createElement("button");
    cancelBtn.innerHTML = "ì·¨ì†Œ";
    cancelBtn.style.cssText = "flex: 1; padding: 8px; background: #e0e0e0; color: #333; border: none; border-radius: 4px; cursor: pointer; font-weight: 600; font-size: 13px;";
    cancelBtn.onmouseover = () => cancelBtn.style.background = "#d0d0d0";
    cancelBtn.onmouseout = () => cancelBtn.style.background = "#e0e0e0";
    cancelBtn.onclick = () => {
      dropdown.style.display = "none";
      cancel();
    };
    
    applyDiv.appendChild(applyBtn);
    applyDiv.appendChild(cancelBtn);
    dropdown.appendChild(applyDiv);
    
    // ë“œë¡­ë‹¤ìš´ì„ bodyì— ì¶”ê°€
    document.body.appendChild(dropdown);
    
    // ë²„íŠ¼ í´ë¦­ ì‹œ ë“œë¡­ë‹¤ìš´ í† ê¸€
    button.onclick = (e) => {
      e.stopPropagation();
      
      if (dropdown.style.display === "none") {
        // ë²„íŠ¼ì˜ ìœ„ì¹˜ ê³„ì‚°
        const rect = button.getBoundingClientRect();
        const dropdownHeight = 400; // ìµœëŒ€ ë†’ì´
        const spaceBelow = window.innerHeight - rect.bottom;
        const spaceAbove = rect.top;
        
        // ì•„ë˜ ê³µê°„ì´ ì¶©ë¶„í•˜ë©´ ì•„ë˜ì—, ì•„ë‹ˆë©´ ìœ„ì— í‘œì‹œ
        if (spaceBelow >= dropdownHeight || spaceBelow > spaceAbove) {
          dropdown.style.top = rect.bottom + "px";
          dropdown.style.bottom = "auto";
        } else {
          dropdown.style.top = "auto";
          dropdown.style.bottom = (window.innerHeight - rect.top) + "px";
        }
        
        dropdown.style.left = rect.left + "px";
        dropdown.style.display = "block";
      } else {
        dropdown.style.display = "none";
      }
    };
    
    // ì™¸ë¶€ í´ë¦­ ì‹œ ë“œë¡­ë‹¤ìš´ ë‹«ê¸°
    function closeDropdown(e) {
      if (!container.contains(e.target) && !dropdown.contains(e.target)) {
        dropdown.style.display = "none";
        document.removeEventListener("click", closeDropdown);
      }
    }
    
    // ë“œë¡­ë‹¤ìš´ì´ ì—´ë¦´ ë•Œ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
    setTimeout(() => {
      if (dropdown.style.display === "block") {
        document.addEventListener("click", closeDropdown);
      }
    }, 100);
    
    container.appendChild(button);
    
    return container;
  }
  
  // ì»¬ëŸ¼ ìë™ ìƒì„± (ì—‘ì…€ ìŠ¤íƒ€ì¼ í•„í„° ì ìš©)
  const columns = Object.keys(data[0]).map(key => ({
    title: key,
    field: key,
    headerSort: true,
    headerFilter: createExcelFilter,
    minWidth: 150,
    resizable: true,
    formatter: "plaintext",
    tooltip: true,
    cssClass: "tabulator-cell"
  }));
  
  console.log('ìƒì„±ëœ ì»¬ëŸ¼:', columns);
  
  // ê¸°ì¡´ í…Œì´ë¸”ì´ ìˆìœ¼ë©´ ì œê±°
  if (transactionTable) {
    console.log('ê¸°ì¡´ í…Œì´ë¸” ì œê±°');
    transactionTable.destroy();
  }
  
  // ì»¨í…Œì´ë„ˆ í™•ì¸
  const container = document.getElementById("transaction-table");
  if (!container) {
    console.error('í…Œì´ë¸” ì»¨í…Œì´ë„ˆë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤!');
    return;
  }
  
  console.log('Tabulator ì´ˆê¸°í™” ì‹œì‘');
  
  // Tabulatorê°€ ë¡œë“œë˜ì—ˆëŠ”ì§€ í™•ì¸
  if (typeof Tabulator === 'undefined') {
    console.error('Tabulator ë¼ì´ë¸ŒëŸ¬ë¦¬ê°€ ë¡œë“œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤! HTML í…Œì´ë¸”ë¡œ ëŒ€ì²´í•©ë‹ˆë‹¤.');
    createHtmlTable(data, container);
    return;
  }
  
  try {
    // Tabulator í…Œì´ë¸” ì´ˆê¸°í™”
    transactionTable = new Tabulator("#transaction-table", {
      data: data,
      columns: columns,
      layout: "fitData",
      maxHeight: "800px",
      pagination: "local",
      paginationSize: 20,
      paginationSizeSelector: [20, 50, 100, 200],
      movableColumns: true,
      resizableColumns: true,
      resizableRows: false,
      tooltips: true,
      addRowPos: "top",
      history: true,
      placeholder: "ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤",
      langs: {
        "ko-kr": {
          "pagination": {
            "page_size": "í˜ì´ì§€ í¬ê¸°",
            "first": "ì²˜ìŒ",
            "first_title": "ì²« í˜ì´ì§€",
            "last": "ë§ˆì§€ë§‰",
            "last_title": "ë§ˆì§€ë§‰ í˜ì´ì§€",
            "prev": "ì´ì „",
            "prev_title": "ì´ì „ í˜ì´ì§€",
            "next": "ë‹¤ìŒ",
            "next_title": "ë‹¤ìŒ í˜ì´ì§€",
            "counter": {
              "showing": "í‘œì‹œ",
              "of": "ì¤‘",
              "rows": "í–‰"
            }
          }
        }
      },
      locale: "ko-kr"
    });
    
    console.log('Tabulator ì´ˆê¸°í™” ì™„ë£Œ');
    
    // í…Œì´ë¸”ì´ ë Œë”ë§ëœ í›„ ë¡œê·¸
    transactionTable.on("tableBuilt", function(){
      console.log('í…Œì´ë¸”ì´ ì„±ê³µì ìœ¼ë¡œ êµ¬ì¶•ë˜ì—ˆìŠµë‹ˆë‹¤.');
      console.log('í…Œì´ë¸” ë°ì´í„° ìˆ˜:', transactionTable.getDataCount());
      updatePricePerM2Summary();
    });
    
    transactionTable.on("renderComplete", function(){
      console.log('í…Œì´ë¸” ë Œë”ë§ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.');
      updatePricePerM2Summary();
    });

    transactionTable.on("dataFiltered", function(){
      updatePricePerM2Summary();
    });
    
  } catch (error) {
    console.error('Tabulator ì´ˆê¸°í™” ì¤‘ ì˜¤ë¥˜:', error);
    alert('Tabulator í…Œì´ë¸” ìƒì„± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. HTML í…Œì´ë¸”ë¡œ í‘œì‹œí•©ë‹ˆë‹¤.');
    createHtmlTable(data, container);
  }
}

// ëŒ€ì²´ HTML í…Œì´ë¸” ìƒì„± í•¨ìˆ˜
function createHtmlTable(data, container) {
  console.log('HTML í…Œì´ë¸” ìƒì„± ì‹œì‘');
  
  if (!data || data.length === 0) {
    container.innerHTML = '<p style="padding: 20px; text-align: center; color: #999;">ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
    return;
  }
  
  const columns = Object.keys(data[0]);
  
  let html = '<div style="overflow: auto; max-height: 800px;">';
  html += '<table style="width: 100%; border-collapse: collapse; font-size: 13px; background: white;">';
  
  // í—¤ë”
  html += '<thead><tr style="background: #667eea; color: white; position: sticky; top: 0; z-index: 10;">';
  columns.forEach(col => {
    html += `<th style="padding: 12px; text-align: left; border: 1px solid #ddd; font-weight: 600;">${col}</th>`;
  });
  html += '</tr></thead>';
  
  // ë°”ë””
  html += '<tbody>';
  data.forEach((row, idx) => {
    const bgColor = idx % 2 === 0 ? '#fff' : '#f9f9f9';
    html += `<tr style="background: ${bgColor};" onmouseover="this.style.background='#f0f0f0'" onmouseout="this.style.background='${bgColor}'">`;
    columns.forEach(col => {
      html += `<td style="padding: 10px; border: 1px solid #ddd;">${row[col] || ''}</td>`;
    });
    html += '</tr>';
  });
  html += '</tbody>';
  html += '</table></div>';
  html += `<div style="padding: 10px; background: #f8f9fa; border-top: 2px solid #ddd; font-weight: 600;">ì´ ${data.length}ê°œ í–‰</div>`;
  
  container.innerHTML = html;
  console.log('HTML í…Œì´ë¸” ìƒì„± ì™„ë£Œ');
}

// ë°ì´í„° ì •ë³´ í‘œì‹œ í•¨ìˆ˜
function showDataInfo() {
  const infoDiv = document.getElementById('dataInfo');
  const selectedSheet = document.getElementById('sheetSelect').value;
  
  if (!excelWorkbook || Object.keys(allSheetsData).length === 0) {
    infoDiv.innerHTML = 'âŒ ì—…ë¡œë“œëœ ì—‘ì…€ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.';
    infoDiv.style.display = 'block';
    return;
  }
  
  const currentData = allSheetsData[selectedSheet] || [];
  
  let info = `<strong>ğŸ“Š ë°ì´í„° ì •ë³´:</strong><br>`;
  info += `í˜„ì¬ ì‹œíŠ¸: <strong>${selectedSheet}</strong><br>`;
  info += `ì´ í–‰ ìˆ˜: <strong>${currentData.length}ê°œ</strong><br>`;
  
  if (currentData.length > 0) {
    const columns = Object.keys(currentData[0]);
    info += `ì»¬ëŸ¼ ìˆ˜: <strong>${columns.length}ê°œ</strong><br>`;
    info += `ì»¬ëŸ¼ ëª©ë¡: ${columns.join(', ')}<br>`;
    info += `<br><strong>ì²« ë²ˆì§¸ ë°ì´í„° ìƒ˜í”Œ:</strong><br>`;
    info += `<pre style="background: white; padding: 8px; border-radius: 4px; overflow-x: auto; font-size: 12px;">${JSON.stringify(currentData[0], null, 2)}</pre>`;
  }
  
  infoDiv.innerHTML = info;
  infoDiv.style.display = 'block';
  
  console.log('=== ë°ì´í„° ìƒì„¸ ì •ë³´ ===');
  console.log('ì‹œíŠ¸:', selectedSheet);
  console.log('ë°ì´í„°:', currentData);
  console.log('Tabulator ê°ì²´:', transactionTable);
  
  if (transactionTable) {
    console.log('Tabulator ë°ì´í„° ìˆ˜:', transactionTable.getDataCount());
    console.log('Tabulator ì»¬ëŸ¼:', transactionTable.getColumns().map(col => col.getDefinition()));
  }
}

// í…Œì´ë¸” ì´ˆê¸°í™” í•¨ìˆ˜
function clearTransactionTable() {
  if (transactionTable) {
    transactionTable.destroy();
    transactionTable = null;
  }
  excelWorkbook = null;
  allSheetsData = {};
  transactionData = [];
  document.getElementById('fileName').textContent = 'ì„ íƒëœ íŒŒì¼ ì—†ìŒ';
  document.getElementById('excelFileInput').value = '';
  document.getElementById('sheetSelector').style.display = 'none';
  document.getElementById('sheetSelect').innerHTML = '';
  updatePricePerM2Summary();
}

function switchBenchmarkCompany(companyName) {
  // ëª¨ë“  ì—…ì²´ ë²„íŠ¼ ë¹„í™œì„±í™”
  document.querySelectorAll('.benchmark-company-btn').forEach(btn => {
    btn.style.background = '#f0f0f0';
    btn.style.color = '#667eea';
  });
  
  // ëª¨ë“  ì—…ì²´ ì»¨í…ì¸  ìˆ¨ê¸°ê¸°
  document.querySelectorAll('.benchmark-company-content').forEach(content => {
    content.style.display = 'none';
  });
  
  // ì„ íƒëœ ì—…ì²´ í™œì„±í™”
  const selectedBtn = document.querySelector(`.benchmark-company-btn[data-company="${companyName}"]`);
  const selectedContent = document.getElementById(`benchmark-${companyName}`);
  
  if (selectedBtn) {
    selectedBtn.style.background = 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)';
    selectedBtn.style.color = 'white';
  }
  if (selectedContent) selectedContent.style.display = 'block';
}

window.openOverviewPopup = openOverviewPopup;
window.closeOverviewPopup = closeOverviewPopup;
window.toggleOverviewFullscreen = toggleOverviewFullscreen;
window.switchOverviewTab = switchOverviewTab;
window.switchBenchmarkCompany = switchBenchmarkCompany;

function openMapPopup() {
  const mapPath = '../map/index.html';
  const width = Math.min(1400, window.screen.width * 0.9);
  const height = Math.min(900, window.screen.height * 0.9);
  const left = (window.screen.width - width) / 2;
  const top = (window.screen.height - height) / 2;
  
  const popup = window.open(
    mapPath,
    'MapPopup',
    `width=${width},height=${height},left=${left},top=${top},resizable=yes,scrollbars=yes,toolbar=no,menubar=no,location=no,status=no`
  );
  
  if (!popup) {
    alert('íŒì—…ì´ ì°¨ë‹¨ë˜ì—ˆìŠµë‹ˆë‹¤. ë¸Œë¼ìš°ì € ì„¤ì •ì—ì„œ íŒì—…ì„ í—ˆìš©í•´ì£¼ì„¸ìš”.');
  } else {
    popup.focus();
  }
}

window.openMapPopup = openMapPopup;

// ì¶”ê°€ë§¤ì¶œ ê³„ì‚° í•¨ìˆ˜
function calculateAdditionalRevenue(input) {
  const row = input.closest('tr');
  if (!row) return;
  
  const monthlyInput = row.querySelector('td:nth-child(2) input');
  const annualInput = row.querySelector('td:nth-child(3) input');
  
  if (monthlyInput && annualInput) {
    const monthlyValue = parseFloat(removeCommas(monthlyInput.value)) || 0;
    const annualValue = monthlyValue * 12;
    annualInput.value = formatNumberWithCommas(annualValue.toFixed(0));
  }
  
  updateAdditionalRevenueSum();
}

window.calculateAdditionalRevenue = calculateAdditionalRevenue;

// ì¶”ê°€ë§¤ì¶œ í•©ê³„ ì—…ë°ì´íŠ¸
function updateAdditionalRevenueSum() {
  const table = document.getElementById('additionalRevenueTable');
  if (!table) return;
  
  const rows = table.querySelectorAll('tbody tr');
  let sum = 0;
  
  rows.forEach(row => {
    const annualInput = row.querySelector('td:nth-child(3) input');
    if (annualInput) {
      const value = parseFloat(removeCommas(annualInput.value)) || 0;
      sum += value;
    }
  });
  
  const sumEl = document.getElementById('additionalRevenueSum');
  const sumBillionEl = document.getElementById('additionalRevenueSumBillion');
  
  if (sumEl) sumEl.textContent = formatNumberWithCommas(sum.toFixed(0));
  if (sumBillionEl) sumBillionEl.textContent = formatNumberWithCommas((sum / 10000).toFixed(2));
  
  // ì¬ë¬´ ìš”ì•½ ì—…ë°ì´íŠ¸
  updateFinancialSummaries();
}

window.updateAdditionalRevenueSum = updateAdditionalRevenueSum;

// ì¶”ê°€ë§¤ì¶œ í•­ëª© ì¶”ê°€
function addAdditionalRevenueRow() {
  const table = document.getElementById('additionalRevenueTable');
  if (!table) return;
  
  const tbody = table.querySelector('tbody');
  if (!tbody) return;
  
  const newRow = document.createElement('tr');
  newRow.innerHTML = `
    <td><input type="text" placeholder="í•­ëª©ëª… ì…ë ¥"></td>
    <td><input type="text" value="0" oninput="calculateAdditionalRevenue(this)"></td>
    <td><input type="text" value="0" readonly style="background-color: #f0f0f0; font-weight: 700; color: #2e7d32;"></td>
    <td><button class="btn-small btn-delete" onclick="deleteFinancialRow(this)">ì‚­ì œ</button></td>
  `;
  
  tbody.appendChild(newRow);
  bindFinancialInputs();
  updateAdditionalRevenueSum();
}

window.addAdditionalRevenueRow = addAdditionalRevenueRow;

// ë³´ì¡°ê¸ˆ ê³„ì‚°
function calculateSubsidy(input) {
  const row = input.closest('tr');
  if (!row) return;
  
  updateSubsidySum();
}

window.calculateSubsidy = calculateSubsidy;

// ë³´ì¡°ê¸ˆ í•©ê³„ ì—…ë°ì´íŠ¸
function updateSubsidySum() {
  const table = document.getElementById('subsidyTable');
  if (!table) return;
  
  const rows = table.querySelectorAll('tbody tr');
  let total = 0;
  
  rows.forEach(row => {
    const amountInput = row.querySelector('td:nth-child(2) input');
    if (amountInput) {
      const amount = parseFloat(removeCommas(amountInput.value)) || 0;
      total += amount;
    }
  });
  
  const sumEl = document.getElementById('subsidySum');
  const sumBillionEl = document.getElementById('subsidySumBillion');
  
  if (sumEl) sumEl.textContent = formatNumberWithCommas(total.toFixed(0));
  if (sumBillionEl) sumBillionEl.textContent = formatNumberWithCommas((total / 10000).toFixed(2));
  
  updateFinancialSummaries();
}

window.updateSubsidySum = updateSubsidySum;

// ë³´ì¡°ê¸ˆ í•­ëª© ì¶”ê°€
function addSubsidyRow() {
  const table = document.getElementById('subsidyTable');
  if (!table) return;
  
  const tbody = table.querySelector('tbody');
  if (!tbody) return;
  
  const newRow = document.createElement('tr');
  newRow.innerHTML = `
    <td><input type="text" placeholder="í•­ëª©ëª… ì…ë ¥"></td>
    <td><input type="text" value="0" oninput="calculateSubsidy(this)"></td>
    <td><button class="btn-small btn-delete" onclick="deleteFinancialRow(this)">ì‚­ì œ</button></td>
  `;
  
  tbody.appendChild(newRow);
  bindFinancialInputs();
  updateSubsidySum();
}

window.addSubsidyRow = addSubsidyRow;

function getSelectedScenarioRevenue(scenario) {
  // í˜„ì¬ ì„ íƒëœ ì‹œë‚˜ë¦¬ì˜¤ì˜ ë§¤ì¶œì„ ê°€ì ¸ì˜´ (ì²œì› ë‹¨ìœ„ë¥¼ ì–µì›ìœ¼ë¡œ ë³€í™˜)
  // ì‚¬ìš©ìê°€ ì„ íƒí•œ ëŒ€ìˆ˜ì™€ ì¹´ë¼ë°˜ í¬í•¨ ì—¬ë¶€ì— ë”°ë¼ ê³„ì‚°
  const prefix = scenario === 'positive' ? 'sp' : scenario === 'neutral' ? 'sn' : 'sg';
  
  // Get selected units (default 10)
  const unitsSelect = document.getElementById('kpi_glamping_units');
  const selectedUnits = unitsSelect ? unitsSelect.value : '10';
  
  // Get caravan checkbox (default false)
  const caravanCheckbox = document.getElementById('kpi_include_caravan');
  const includeCaravan = caravanCheckbox ? caravanCheckbox.checked : false;
  
  // Build selector: prefix + units + (_p for caravan) + _w (always include weight)
  // Examples: sp_10_w, sp_10_pw (10 units + caravan + weight), sp_15_w, sp_30_pw
  const selector = includeCaravan ? `.${prefix}_${selectedUnits}_pw` : `.${prefix}_${selectedUnits}_w`;
  
  const revenueEl = document.querySelector(selector);
  if (revenueEl && revenueEl.textContent !== '-') {
    const revenue = parseFloat(removeCommas(revenueEl.textContent)) / 100000; // ì²œì› -> ì–µì›
    return revenue;
  }
  return 0;
}

function getVATRate() {
  // finance í…Œì´ë¸”ì—ì„œ ë¶€ê°€ì„¸ìœ¨ ì°¾ê¸°
  const financeTable = document.getElementById('financeTable');
  if (financeTable) {
    const rows = financeTable.querySelectorAll('tbody tr');
    for (const row of rows) {
      const nameInput = row.querySelector('td:first-child input');
      const valueInput = row.querySelector('td:nth-child(2) input');
      if (nameInput && nameInput.value.includes('ë¶€ê°€ì„¸')) {
        return parseFloat(valueInput.value) || 10;
      }
    }
  }
  return 10; // ê¸°ë³¸ê°’
}

function getTaxRate() {
  // finance í…Œì´ë¸”ì—ì„œ ë²•ì¸ì„¸ìœ¨ ì°¾ê¸°
  const financeTable = document.getElementById('financeTable');
  if (financeTable) {
    const rows = financeTable.querySelectorAll('tbody tr');
    for (const row of rows) {
      const nameInput = row.querySelector('td:first-child input');
      const valueInput = row.querySelector('td:nth-child(2) input');
      if (nameInput && nameInput.value.includes('ë²•ì¸ì„¸ìœ¨')) {
        return parseFloat(valueInput.value) || 22;
      }
    }
  }
  return 22; // ê¸°ë³¸ê°’
}

function getDepreciation() {
  // ê³ ì •ë¹„ í…Œì´ë¸”ì—ì„œ ê°ê°€ìƒê°ë¹„ ì°¾ê¸°
  const fixedCostTable = document.getElementById('fixedCostTable');
  if (fixedCostTable) {
    const rows = fixedCostTable.querySelectorAll('tbody tr');
    for (const row of rows) {
      const nameInput = row.querySelector('td:first-child input');
      const valueInput = row.querySelector('td:nth-child(2) input');
      if (nameInput && nameInput.value.includes('ê°ê°€ìƒê°')) {
        const value = parseFloat(removeCommas(valueInput.value)) || 0;
        return value / 10000; // ë§Œì› -> ì–µì›
      }
    }
  }
  return 0; // ê¸°ë³¸ê°’ 0
}

function getLoanInterest() {
  // ê¸ˆìœµ ë° ì„¸ê¸ˆ í…Œì´ë¸”ì—ì„œ ì°¨ì…ê¸ˆ ì´ì ì°¾ê¸°
  const financeTable = document.getElementById('financeTable');
  if (financeTable) {
    const rows = financeTable.querySelectorAll('tbody tr');
    for (const row of rows) {
      const nameInput = row.querySelector('td:first-child input');
      const valueInput = row.querySelector('td:nth-child(2) input');
      if (nameInput && nameInput.value.includes('ì°¨ì…ê¸ˆ ì´ì')) {
        const value = parseFloat(removeCommas(valueInput.value)) || 0;
        return value / 10000; // ë§Œì› -> ì–µì›
      }
    }
  }
  return 0; // ê¸°ë³¸ê°’ 0
}

function getAdditionalRevenue() {
  // ì¶”ê°€ë§¤ì¶œ í…Œì´ë¸”ì—ì„œ ì—°ê°„ í•©ê³„ ê°€ì ¸ì˜¤ê¸°
  const table = document.getElementById('additionalRevenueTable');
  if (!table) return 0;
  
  const rows = table.querySelectorAll('tbody tr');
  let sum = 0;
  
  rows.forEach(row => {
    const annualInput = row.querySelector('td:nth-child(3) input');
    if (annualInput) {
      const value = parseFloat(removeCommas(annualInput.value)) || 0;
      sum += value;
    }
  });
  
  return sum / 10000; // ë§Œì› -> ì–µì›
}

function getMarketingCost() {
  // ë³€ë™ë¹„ í…Œì´ë¸”ì—ì„œ ë§ˆì¼€íŒ…ë¹„ í•­ëª© ì°¾ê¸°
  const variableTable = document.getElementById('variableCostTable');
  if (!variableTable) return 0;
  
  const rows = variableTable.querySelectorAll('tbody tr');
  for (const row of rows) {
    const nameInput = row.querySelector('td:first-child input');
    const valueInput = row.querySelector('td:nth-child(2) input');
    if (nameInput && nameInput.value.includes('ë§ˆì¼€íŒ…')) {
      const value = parseFloat(removeCommas(valueInput.value)) || 0;
      return value / 10000; // ë§Œì› -> ì–µì›
    }
  }
  
  return 0; // ê¸°ë³¸ê°’ 0
}

function getSubsidy() {
  // ë³´ì¡°ê¸ˆ í…Œì´ë¸”ì—ì„œ í•©ê³„ ê°€ì ¸ì˜¤ê¸°
  const table = document.getElementById('subsidyTable');
  if (!table) return 0;
  
  const rows = table.querySelectorAll('tbody tr');
  let sum = 0;
  
  rows.forEach(row => {
    const amountInput = row.querySelector('td:nth-child(2) input');
    if (amountInput) {
      const value = parseFloat(removeCommas(amountInput.value)) || 0;
      sum += value;
    }
  });
  
  return sum / 10000; // ë§Œì› -> ì–µì›
}

function calculateSimpleIRR(investment, annualCashFlow, years) {
  // NPV = 0ì´ ë˜ëŠ” í• ì¸ìœ¨ì„ ì°¾ëŠ” ê°„ë‹¨í•œ IRR ê³„ì‚°
  // Newton-Raphson ë°©ë²• ì‚¬ìš©
  let rate = 0.1; // ì´ˆê¸° ì¶”ì •ê°’ 10%
  const tolerance = 0.0001;
  const maxIterations = 100;
  
  for (let i = 0; i < maxIterations; i++) {
    let npv = -investment;
    let dnpv = 0;
    
    for (let year = 1; year <= years; year++) {
      const factor = Math.pow(1 + rate, year);
      npv += annualCashFlow / factor;
      dnpv -= year * annualCashFlow / (factor * (1 + rate));
    }
    
    if (Math.abs(npv) < tolerance) {
      return rate * 100; // í¼ì„¼íŠ¸ë¡œ ë³€í™˜
    }
    
    rate = rate - npv / dnpv;
    
    if (rate < -0.99) rate = -0.99; // í•˜í•œ
    if (rate > 10) rate = 10; // ìƒí•œ
  }
  
  return rate * 100;
}

function bindFinancialInputs() {
  // ì¼ë°˜ ì¬ë¬´ í…Œì´ë¸” (2ë²ˆì§¸ ì»¬ëŸ¼ input) - CAPEX, Pre-opening, Fixed Cost, Variable Cost, Finance
  const allInputs = document.querySelectorAll('.financial-table tbody input');
  allInputs.forEach(inp => {
    // ì´ë¯¸ oninput ì†ì„±ì´ ìˆëŠ” ê²½ìš° (ì¶”ê°€ë§¤ì¶œ, ë³´ì¡°ê¸ˆ) ìŠ¤í‚µ
    const parentTable = inp.closest('table');
    if (parentTable && (parentTable.id === 'additionalRevenueTable' || parentTable.id === 'subsidyTable')) {
      return;
    }
    
    // input ì´ë²¤íŠ¸ë¡œ ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸
    inp.removeEventListener('input', handleInputChange);
    inp.addEventListener('input', handleInputChange);
    
    // Add comma formatting on blur
    inp.removeEventListener('blur', handleBlur);
    inp.addEventListener('blur', handleBlur);
    
    // Remove commas on focus for easier editing
    inp.removeEventListener('focus', handleFocus);
    inp.addEventListener('focus', handleFocus);
  });
}

function handleInputChange(e) {
  updateFinancialSummaries();
}

function handleBlur(e) {
  formatNumberInput(e.target);
}

function handleFocus(e) {
  e.target.value = removeCommas(e.target.value);
}

window.addFinancialRow = addFinancialRow;
window.deleteFinancialRow = deleteFinancialRow;

/* LocalStorage ë°ì´í„° ì €ì¥/ë³µì› */
function saveAllFinancialData() {
  const tables = ['capexTable', 'preopeningTable', 'fixedCostTable', 'variableCostTable', 'financeTable', 'additionalRevenueTable'];
  const data = {};
  
  tables.forEach(tableId => {
    const table = document.getElementById(tableId);
    if(!table) return;
    const rows = Array.from(table.querySelectorAll('tbody tr'));
    
    // additionalRevenueTable has 3 columns (name, monthly, annual)
    if (tableId === 'additionalRevenueTable') {
      data[tableId] = rows.map(tr => {
        const cells = tr.querySelectorAll('td');
        return {
          name: cells[0]?.querySelector('input')?.value || '',
          monthly: cells[1]?.querySelector('input')?.value || '0',
          annual: cells[2]?.querySelector('input')?.value || '0'
        };
      });
    } else {
      data[tableId] = rows.map(tr => {
        const cells = tr.querySelectorAll('td');
        return {
          name: cells[0]?.querySelector('input')?.value || '',
          value: cells[1]?.querySelector('input')?.value || '0'
        };
      });
    }
  });
  
  // Save glamping table data
  const glampingRows = Array.from(document.querySelectorAll('#glampingTable tbody tr'));
  data.glampingTable = glampingRows.map(tr => {
    const inputs = tr.querySelectorAll('input');
    return Array.from(inputs).map(inp => inp.value);
  });
  
  // Save occupancy settings
  data.occupancy = {
    pos_high: document.getElementById('occ_pos_high')?.value,
    pos_weekend: document.getElementById('occ_pos_weekend')?.value,
    pos_weekday: document.getElementById('occ_pos_weekday')?.value,
    neu_high: document.getElementById('occ_neu_high')?.value,
    neu_weekend: document.getElementById('occ_neu_weekend')?.value,
    neu_weekday: document.getElementById('occ_neu_weekday')?.value,
    neg_high: document.getElementById('occ_neg_high')?.value,
    neg_weekend: document.getElementById('occ_neg_weekend')?.value,
    neg_weekday: document.getElementById('occ_neg_weekday')?.value
  };
  
  // Save weight
  data.weight = document.querySelector('.weightHeader input')?.value || '0.37';
  
  localStorage.setItem('glampingFinancialData', JSON.stringify(data));
  showToast('ë°ì´í„°ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!', 'success');
}

function loadAllFinancialData() {
  const saved = localStorage.getItem('glampingFinancialData');
  if(!saved) return false;
  
  try {
    const data = JSON.parse(saved);
    
    // Restore financial tables
    const tables = ['capexTable', 'preopeningTable', 'fixedCostTable', 'variableCostTable', 'financeTable', 'additionalRevenueTable'];
    tables.forEach(tableId => {
      if(!data[tableId]) return;
      const table = document.getElementById(tableId);
      if(!table) return;
      
      const tbody = table.querySelector('tbody');
      tbody.innerHTML = ''; // Clear existing rows
      
      // additionalRevenueTable has 3 columns
      if (tableId === 'additionalRevenueTable') {
        data[tableId].forEach(rowData => {
          const newRow = document.createElement('tr');
          const formattedMonthly = formatNumberWithCommas(Math.round(parseFloat(removeCommas(rowData.monthly)) || 0));
          const formattedAnnual = formatNumberWithCommas(Math.round(parseFloat(removeCommas(rowData.annual)) || 0));
          newRow.innerHTML = `
            <td><input type="text" value="${rowData.name}"></td>
            <td><input type="text" value="${formattedMonthly}" oninput="calculateAdditionalRevenue(this)"></td>
            <td><input type="text" value="${formattedAnnual}" readonly style="background-color: #f0f0f0; font-weight: 700; color: #2e7d32;"></td>
            <td><button class="btn-small btn-delete" onclick="deleteFinancialRow(this)">ì‚­ì œ</button></td>
          `;
          tbody.appendChild(newRow);
        });
      } else {
        data[tableId].forEach(rowData => {
          const newRow = document.createElement('tr');
          const formattedValue = formatNumberWithCommas(Math.round(parseFloat(removeCommas(rowData.value)) || 0));
          newRow.innerHTML = `
            <td><input type="text" value="${rowData.name}"></td>
            <td><input type="text" value="${formattedValue}"></td>
            <td><button class="btn-small btn-delete" onclick="deleteFinancialRow(this)">ì‚­ì œ</button></td>
          `;
          tbody.appendChild(newRow);
        });
      }
    });
    
    // Restore glamping table
    if(data.glampingTable) {
      const glampingRows = document.querySelectorAll('#glampingTable tbody tr');
      data.glampingTable.forEach((rowData, idx) => {
        if(glampingRows[idx]) {
          const inputs = glampingRows[idx].querySelectorAll('input');
          rowData.forEach((val, i) => {
            if(inputs[i]) inputs[i].value = val;
          });
        }
      });
    }
    
    // Restore occupancy settings
    if(data.occupancy) {
      Object.keys(data.occupancy).forEach(key => {
        const el = document.getElementById('occ_' + key);
        if(el && data.occupancy[key]) el.value = data.occupancy[key];
      });
    }
    
    // Restore weight
    if(data.weight) {
      const gWeightEl = document.getElementById('gWeight');
      if(gWeightEl) gWeightEl.value = data.weight;
      document.querySelectorAll('.weightHeader input').forEach(inp => {
        inp.value = data.weight;
      });
    }
    
    // Update additional revenue sum after loading
    updateAdditionalRevenueSum();
    
    return true;
  } catch(e) {
    console.error('Failed to load data:', e);
    return false;
  }
}

function resetAllFinancialData() {
  if(!confirm('ëª¨ë“  ë°ì´í„°ë¥¼ ê¸°ë³¸ê°’ìœ¼ë¡œ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
  localStorage.removeItem('glampingFinancialData');
  showToast('ì´ˆê¸°í™” ì™„ë£Œ! í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•©ë‹ˆë‹¤.', 'success');
  setTimeout(() => location.reload(), 1000);
}

window.saveAllFinancialData = saveAllFinancialData;
window.loadAllFinancialData = loadAllFinancialData;
window.resetAllFinancialData = resetAllFinancialData;

// íŒŒì¼ í•¸ë“¤ì„ ì €ì¥í•  ë³€ìˆ˜
let savedFileHandle = null;

async function downloadHTMLFile() {
  // í˜„ì¬ íŒŒì¼ëª… ê°€ì ¸ì˜¤ê¸° (URLì—ì„œ ì¶”ì¶œ)
  const currentPath = window.location.pathname;
  const currentFileName = currentPath.substring(currentPath.lastIndexOf('/') + 1) || 'index.html';
  const fileNameWithoutExt = currentFileName.replace('.html', '');
  
  // Update all input values in the DOM before downloading
  // This ensures that current values are reflected in the value attribute
  document.querySelectorAll('input[type="text"], input[type="number"]').forEach(input => {
    input.setAttribute('value', input.value);
  });
  
  // Update all select elements
  document.querySelectorAll('select').forEach(select => {
    Array.from(select.options).forEach(option => {
      if (option.selected) {
        option.setAttribute('selected', 'selected');
      } else {
        option.removeAttribute('selected');
      }
    });
  });
  
  // Update all textarea elements
  document.querySelectorAll('textarea').forEach(textarea => {
    textarea.textContent = textarea.value;
  });
  
  // Update all checkbox and radio inputs
  document.querySelectorAll('input[type="checkbox"], input[type="radio"]').forEach(input => {
    if (input.checked) {
      input.setAttribute('checked', 'checked');
    } else {
      input.removeAttribute('checked');
    }
  });
  
  // Get current HTML content after updating attributes
  let htmlContent = document.documentElement.outerHTML;
  
  // File System Access APIë¥¼ ì§€ì›í•˜ëŠ” ê²½ìš° ì‚¬ìš© (í˜„ì¬ ë””ë ‰í† ë¦¬ì—ì„œ ì‹œì‘)
  if (window.showSaveFilePicker) {
    await saveHTMLWithFilePicker(htmlContent, fileNameWithoutExt);
  } else {
    // ì§€ì›í•˜ì§€ ì•ŠëŠ” ê²½ìš° ê¸°ì¡´ ë°©ì‹ ì‚¬ìš©
    saveLegacyDownload(htmlContent, fileNameWithoutExt);
  }
}

async function saveHTMLWithFilePicker(htmlContent, defaultFileName) {
  try {
    // ì €ì¥ëœ íŒŒì¼ í•¸ë“¤ì´ ìˆê³  ê¶Œí•œì´ ìˆëŠ” ê²½ìš° ë°”ë¡œ ë®ì–´ì“°ê¸°
    if (savedFileHandle) {
      try {
        // íŒŒì¼ì— ëŒ€í•œ ì“°ê¸° ê¶Œí•œ í™•ì¸
        const permission = await savedFileHandle.queryPermission({ mode: 'readwrite' });
        
        if (permission === 'granted' || permission === 'prompt') {
          const writable = await savedFileHandle.createWritable();
          await writable.write(htmlContent);
          await writable.close();
          
          showToast('íŒŒì¼ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!', 'success');
          return;
        }
      } catch (err) {
        // ê¶Œí•œì´ ì—†ê±°ë‚˜ ì˜¤ë¥˜ ë°œìƒ ì‹œ ìƒˆë¡œ íŒŒì¼ ì„ íƒ
        console.log('ì €ì¥ëœ íŒŒì¼ í•¸ë“¤ ì‚¬ìš© ë¶ˆê°€, ìƒˆë¡œ ì„ íƒí•©ë‹ˆë‹¤.');
        savedFileHandle = null;
      }
    }
    
    // ìƒˆë¡œ íŒŒì¼ ì„ íƒ
    const options = {
      suggestedName: defaultFileName + '.html',
      types: [{
        description: 'HTML Files',
        accept: { 'text/html': ['.html'] }
      }]
    };
    
    const fileHandle = await window.showSaveFilePicker(options);
    const writable = await fileHandle.createWritable();
    await writable.write(htmlContent);
    await writable.close();
    
    // íŒŒì¼ í•¸ë“¤ ì €ì¥ (ë‹¤ìŒì— ì¬ì‚¬ìš©)
    savedFileHandle = fileHandle;
    
    showToast('íŒŒì¼ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤! (ë‹¤ìŒë¶€í„°ëŠ” ê°™ì€ ìœ„ì¹˜ì— ìë™ ì €ì¥ë©ë‹ˆë‹¤)', 'success');
  } catch (err) {
    // ì‚¬ìš©ìê°€ ì·¨ì†Œí•œ ê²½ìš°
    if (err.name !== 'AbortError') {
      console.error('íŒŒì¼ ì €ì¥ ì˜¤ë¥˜:', err);
      showToast('íŒŒì¼ ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'error');
    }
  }
}

function saveLegacyDownload(htmlContent, fileName) {
  // Create a blob with the current HTML
  const blob = new Blob([htmlContent], { type: 'text/html;charset=utf-8' });
  
  // Create download link
  const link = document.createElement('a');
  link.href = URL.createObjectURL(blob);
  link.download = fileName + '.html';
  
  // Trigger download
  document.body.appendChild(link);
  link.click();
  document.body.removeChild(link);
  URL.revokeObjectURL(link.href);
  
  showToast('HTML íŒŒì¼ì´ ë‹¤ìš´ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤!', 'success');
}

window.downloadHTMLFile = downloadHTMLFile;

/* ê°œì„ ëœ IRR (binary search) */
function irr(cfs){
  let low=-0.9999, high=2, mid=0;
  for(let i=0;i<80;i++){
    mid=(low+high)/2;
    let npv=0;
    cfs.forEach((c,t)=>npv+=c/Math.pow(1+mid,t));
    if(npv>0) low=mid; else high=mid;
  }
  return mid;
}

/* ê°œë³„ ê³„ì‚° */
function computeFerry(){
  const fareAdj = Number(fare.value) * Number(fareSlider.value);
  fareRate.innerText = Math.round(Number(fareSlider.value)*100)+"%";
  const revenue = Number(days.value) * Number(passengers.value) * fareAdj / 1e8;
  const ebitda = revenue - Number(opex.value);
  const investWith = Number(shipPrice.value) - Number(subsidy.value);
  const investWithout = Number(shipPrice.value);
  const years = 20;
  const cfsWith = [-investWith].concat(Array(years).fill(ebitda));
  const cfsWithout = [-investWithout].concat(Array(years).fill(ebitda));
  const irrWith = irr(cfsWith);
  const irrWithout = irr(cfsWithout);
  const res = {revenue, ebitda, investWith, investWithout, irrWith, irrWithout, years};
  projects.ferry = res;
  ferrySummary.innerHTML = `ì—°ê°„ ë§¤ì¶œ: ${revenue.toFixed(1)} ì–µì›<br>ì—°ê°„ EBITDA: ${ebitda.toFixed(1)} ì–µì›<br>IRR(ë³´ì¡°ê¸ˆ ON): ${(irrWith*100).toFixed(2)}% / OFF: ${(irrWithout*100).toFixed(2)}%`;
  return res;
}

function computeGlamping(){
  const revenue = Number(rooms.value)*365*Number(occ.value)*Number(adr.value)/1e8;
  const ebitda = revenue - Number(gOpex.value);
  const invest = Number(gInvest.value);
  const years = 10;
  const cfs = [-invest].concat(Array(years).fill(ebitda));
  const irrVal = irr(cfs);
  const res = {revenue, ebitda, invest, irr: irrVal, years};
  projects.glamping = res;
  glampingSummary.innerHTML = `ì—°ê°„ ë§¤ì¶œ: ${revenue.toFixed(1)} ì–µì›<br>ì—°ê°„ EBITDA: ${ebitda.toFixed(1)} ì–µì›<br>IRR: ${(irrVal*100).toFixed(2)}%`;
  return res;
}

function computeVenture(){
  if(!vInvest || !vEbitda || !vYears){
    const res = {revenue: 0, ebitda: 0, invest: 0, irr: 0, years: 0};
    projects.venture = res;
    if(ventureSummary) ventureSummary.innerHTML = '';
    return res;
  }
  const invest = Number(vInvest.value);
  const ebitda = Number(vEbitda.value);
  const years = Number(vYears.value)||10;
  const cfs = [-invest].concat(Array(years).fill(ebitda));
  const irrVal = irr(cfs);
  const res = {revenue: ebitda, ebitda, invest, irr: irrVal, years};
  projects.venture = res;
  if(ventureSummary){
    ventureSummary.innerHTML = `ì—°ê°„ EBITDA: ${ebitda.toFixed(2)} ì–µì›<br>IRR: ${(irrVal*100).toFixed(2)}%`;
  }
  return res;
}

/* Venture tree (Tabulator) */
function initVentureTree(forceRedraw=false){
  const tableEl = document.getElementById('ventureTable');
  const detailEl = document.getElementById('ventureDetail');
  const visualsEl = document.getElementById('ventureVisuals');
  if(!tableEl || !detailEl || !visualsEl || typeof Tabulator === 'undefined') return;

  const renderVentureVideo = (url)=>{
    const normalizeUrls = (value)=>{
      if(Array.isArray(value)){
        return value
          .map(item => (typeof item === 'string' ? item.trim() : ''))
          .filter(Boolean);
      }
      if(typeof value === 'string'){
        const trimmed = value.trim();
        return trimmed ? [trimmed] : [];
      }
      return [];
    };

    const urls = normalizeUrls(url);
    const safeUrl = urls[0] || '';
    const toEmbedUrl = (raw)=>{
      if(!raw) return '';
      try {
        const u = new URL(raw);
        const keepParams = (src)=>{
          const params = new URLSearchParams();
          ['start','t','list','index','rel','si'].forEach(k=>{
            const v = src.searchParams.get(k);
            if(v) params.set(k, v);
          });
          if(!params.has('rel')) params.set('rel','0');
          return params.toString();
        };

        if(u.hostname.includes('youtu.be')){
          const id = u.pathname.replace('/','').trim();
          if(!id) return raw;
          const qs = keepParams(u);
          return `https://www.youtube-nocookie.com/embed/${id}${qs ? `?${qs}` : ''}`;
        }

        if(u.hostname.includes('youtube.com') || u.hostname.includes('youtube-nocookie.com')){
          let id = '';
          if(u.pathname.startsWith('/embed/')){
            id = u.pathname.replace('/embed/','').split('/')[0].trim();
          } else {
            id = u.searchParams.get('v') || '';
          }
          if(!id) return raw;
          const qs = keepParams(u);
          return `https://www.youtube-nocookie.com/embed/${id}${qs ? `?${qs}` : ''}`;
        }

        return raw;
      } catch {
        return raw;
      }
    };
    const embedUrl = toEmbedUrl(safeUrl);
    requestAnimationFrame(()=>{
      const framesEl = document.getElementById('ventureVideoFrames');
      const noteEl = document.getElementById('ventureVideoNote');
      const linksEl = document.getElementById('ventureVideoLinks');
      if(!framesEl || !noteEl) return;
      if(safeUrl){
        framesEl.innerHTML = urls
          .map((u, idx)=>{
            const iframeId = `ventureVideo${idx + 1}`;
            const embed = toEmbedUrl(u);
            return `<iframe id="${iframeId}" class="venture-video" width="560" height="500" src="${embed}" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe>`;
          })
          .join('');
        if(location.protocol === 'file:'){
          noteEl.textContent = 'ë¡œì»¬ íŒŒì¼ì—ì„œ ìœ íŠœë¸Œê°€ ì°¨ë‹¨ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë¡œì»¬ ì„œë²„ë¡œ ì—´ì–´ì£¼ì„¸ìš”.';
        } else {
          noteEl.textContent = '';
        }
        if(linksEl){
          linksEl.innerHTML = urls
            .map((u, idx)=>{
              const label = urls.length > 1 ? `ì˜ìƒ ì—´ê¸° #${idx + 1}` : 'ì˜ìƒ ì—´ê¸°';
              return `<a class="venture-video-link" href="${u}" target="_blank" rel="noopener">${label}</a>`;
            })
            .join('');
          linksEl.style.display = 'flex';
        }
      } else {
        framesEl.innerHTML = '';
        noteEl.textContent = 'ì˜ìƒ URLì´ ì—†ìŠµë‹ˆë‹¤.';
        if(linksEl){
          linksEl.innerHTML = '';
          linksEl.style.display = 'none';
        }
      }
    });
  };

  const renderVentureDetail = (d)=>{
    if(d && d._children && !d.overview){
      const count = Array.isArray(d._children) ? d._children.length : 0;
      detailEl.innerHTML = `
        <h3>${d.name}</h3>
        <div class='venture-label'>ë¶„ë¥˜</div><div>ì‚°ì—…êµ°</div>
        <div class='venture-label'>ê¸°ì—… ìˆ˜</div><div>${count}ê°œ</div>
        <div class='venture-label'>ë©”ëª¨</div><div>í•˜ìœ„ ê¸°ì—…ì„ í´ë¦­í•˜ë©´ ìƒì„¸ ì •ë³´ê°€ í‘œì‹œë©ë‹ˆë‹¤.</div>
      `;
      visualsEl.innerHTML = `
        <h3>ì§€í‘œ ê°€ì‹œí™”</h3>
        <div class="venture-visuals">
          <div class="score-box">
            <div class="venture-label">ì¢…í•© íˆ¬ì ì ìˆ˜</div>
            <div id="ventureTotalScore">-</div>
          </div>
          <div class="score-box">
            <div class="venture-label">íˆ¬ì ì‹ í˜¸</div>
            <div id="ventureSignal" class="signal">-</div>
          </div>

          <div class="venture-chart-wrap">
            <canvas id="ventureRadar"></canvas>
          </div>

          <div class="venture-table">
            <div class="venture-label">ì§€í‘œ ìƒì„¸</div>
            <table class="venture-metrics">
              <thead>
                <tr>
                  <th>ì§€í‘œ</th>
                  <th>ì ìˆ˜(0~5)</th>
                  <th>ê·¼ê±°(evidence)</th>
                  <th>ì¶œì²˜(source)</th>
                </tr>
              </thead>
              <tbody id="ventureMetricsBody">
                <tr><td colspan="4">ì§€í‘œ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</td></tr>
              </tbody>
            </table>
          </div>
        </div>
      `;
      renderInvestmentIndicators();
      renderVentureVideo('');
      return;
    }
    detailEl.innerHTML = `
      <h3>${(d && d.name) ? d.name : '-'}</h3>
      <div class='venture-label'>íˆ¬ì ë‹¨ê³„</div><div>${(d && d.stage) ? d.stage : '-'}</div>
      <div class='venture-label'>êµ­ê°€</div><div>${(d && d.country) ? d.country : '-'}</div>
      <div class='venture-label'>íšŒì‚¬ ê°œìš”</div><div>${(d && d.overview) ? d.overview : '-'}</div>
      <div class='venture-label'>ë‚´ë¶€ ë©”ëª¨</div><div>${(d && d.memo) ? d.memo : '-'}</div>
      <div class="venture-chart-wrap">
        <div class="venture-label">ì†Œê°œ ì˜ìƒ</div>
          <div id="ventureVideoFrames" class="venture-video-frames"></div>
        <div id="ventureVideoNote" class="venture-video-placeholder">ì˜ìƒ URLì´ ì—†ìŠµë‹ˆë‹¤.</div>
          <div id="ventureVideoLinks" class="venture-video-links"></div>
      </div>
    `;
    visualsEl.innerHTML = `
      <h3>ì§€í‘œ ê°€ì‹œí™”</h3>
      <div class="venture-visuals">
        <div class="score-box">
          <div class="venture-label">ì¢…í•© íˆ¬ì ì ìˆ˜</div>
          <div id="ventureTotalScore">-</div>
        </div>
        <div class="score-box">
          <div class="venture-label">íˆ¬ì ì‹ í˜¸</div>
          <div id="ventureSignal" class="signal">-</div>
        </div>

        <div class="venture-chart-wrap">
          <canvas id="ventureRadar"></canvas>
        </div>

        <div class="venture-table">
          <div class="venture-label">ì§€í‘œ ìƒì„¸</div>
          <table class="venture-metrics">
            <thead>
              <tr>
                <th>ì§€í‘œ</th>
                <th>ì ìˆ˜(0~5)</th>
                <th>ê·¼ê±°(evidence)</th>
                <th>ì¶œì²˜(source)</th>
              </tr>
            </thead>
            <tbody id="ventureMetricsBody">
              <tr><td colspan="4">ì§€í‘œ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</td></tr>
            </tbody>
          </table>
        </div>
      </div>
    `;
    renderInvestmentIndicators();
    renderVentureVideo(d && d.videoUrl);
  };

  if(!ventureTable){
    ventureTable = new Tabulator(tableEl,{
      data: ventureData,
      layout: "fitColumns",
      dataTree: true,
      dataTreeStartExpanded: true,
      columns: [
        {title:"ê¸°ì—… / ì‚°ì—…", field:"name", widthGrow: 2},
        {title:"íˆ¬ìë‹¨ê³„", field:"stage"},
        {title:"êµ­ê°€", field:"country"},
        {title:"ì˜ìƒ URL", field:"videoUrl", visible:false}
      ],
      rowClick: function(e,row){
        const d = row.getData();
        renderVentureDetail(d);
      },
      rowFormatter: function(row){
        const el = row.getElement();
        if(!el) return;
        el.addEventListener('mouseenter', ()=> el.classList.add('venture-row-hover'));
        el.addEventListener('mouseleave', ()=> el.classList.remove('venture-row-hover'));
      }
    });

    ventureTable.on("cellClick", function(e, cell){
      const d = cell.getRow().getData();
      renderVentureDetail(d);
    });

    renderInvestmentIndicators();
  } else if(forceRedraw){
    ventureTable.redraw(true);
    renderInvestmentIndicators();
  }
}

/* Investment indicators rendering */
function renderInvestmentIndicators(){
  const totalEl = document.getElementById('ventureTotalScore');
  const signalEl = document.getElementById('ventureSignal');
  const tbody = document.getElementById('ventureMetricsBody');
  const radarEl = document.getElementById('ventureRadar');

  if(!totalEl || !signalEl || !tbody || !radarEl) return;

  if(typeof investmentIndicators !== 'object' || investmentIndicators === null){
    tbody.innerHTML = `<tr><td colspan="4">investmentIndicators ê°ì²´ê°€ ì—†ìŠµë‹ˆë‹¤.</td></tr>`;
    totalEl.textContent = '-';
    signalEl.textContent = '-';
    signalEl.className = 'signal';
    if(ventureRadarChart){
      ventureRadarChart.destroy();
      ventureRadarChart = null;
    }
    return;
  }

  const entries = Object.entries(investmentIndicators);
  if(entries.length === 0){
    tbody.innerHTML = `<tr><td colspan="4">ì§€í‘œ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</td></tr>`;
    return;
  }

  const labels = [];
  const scores = [];
  let sum = 0;
  let count = 0;

  tbody.innerHTML = '';
  entries.forEach(([key, item])=>{
    const label = item && item.label ? item.label : key;
    const score = (item && (item.score === 0 || item.score)) ? item.score : null;
    const description = item && item.description ? item.description : 'ê³„ì‚° ê¸°ì¤€ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.';
    const evidence = item && item.evidence ? item.evidence : '-';
    const source = item && item.source ? item.source : '-';

    labels.push(label);
    const scaled = (score === null || score === undefined) ? null : Math.max(0, Math.min(5, Number(score))) * 20;
    scores.push(scaled === null ? 0 : scaled);

    if(scaled !== null){
      sum += scaled;
      count += 1;
    }

    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td>
        <span class="metric-tooltip">
          <span>${label}</span>
          <span class="info-dot">i</span>
          <span class="tooltip-text">${description}</span>
        </span>
      </td>
      <td>${score === null || score === undefined ? '-' : score}</td>
      <td>${evidence}</td>
      <td>${source}</td>
    `;
    tbody.appendChild(tr);
  });

  const avg = count > 0 ? (sum / count) : null;
  totalEl.textContent = avg === null ? '-' : avg.toFixed(1);

  let signal = '-';
  let signalClass = 'signal';
  if(avg !== null){
    if(avg >= 70){ signal = 'Green'; signalClass = 'signal green'; }
    else if(avg >= 40){ signal = 'Yellow'; signalClass = 'signal yellow'; }
    else { signal = 'Red'; signalClass = 'signal red'; }
  }
  signalEl.textContent = signal;
  signalEl.className = signalClass;

  if(ventureRadarChart){
    ventureRadarChart.destroy();
  }

  ventureRadarChart = new Chart(radarEl,{
    type: 'radar',
    data: {
      labels,
      datasets: [{
        label: 'íˆ¬ì ì§€í‘œ(0~100)',
        data: scores,
        fill: true,
        backgroundColor: 'rgba(52, 73, 94, 0.15)',
        borderColor: 'rgba(52, 73, 94, 0.8)',
        pointBackgroundColor: 'rgba(52, 73, 94, 0.8)'
      }]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      scales: {
        r: {
          min: 0,
          max: 100,
          ticks: { stepSize: 20 }
        }
      },
      plugins: {
        legend: { display: false }
      }
    }
  });
}

/* í†µí•© ë¶„ì„ */
function consolidateAnalysis(){
  if(!projects.ferry) computeFerry();
  if(!projects.glamping) computeGlamping();
  if(!projects.venture) computeVenture();

  const f = projects.ferry, g = projects.glamping, v = projects.venture;
  const totalRevenue = (f.revenue||0) + (g.revenue||0) + (v.revenue||0);
  const totalEbitda = (f.ebitda||0) + (g.ebitda||0) + (v.ebitda||0);

  const years = 10;
  const investOn = (f.investWith||0) + (g.invest||0) + (v.invest||0);
  const investOff = (f.investWithout||0) + (g.invest||0) + (v.invest||0);

  const cfsOn = [-investOn].concat(Array(years).fill(totalEbitda));
  const cfsOff = [-investOff].concat(Array(years).fill(totalEbitda));

  const irrOn = irr(cfsOn);
  const irrOff = irr(cfsOff);

  kRevenue.innerText = totalRevenue.toFixed(1)+" ì–µì›";
  kEbitda.innerText = totalEbitda.toFixed(1)+" ì–µì›";
  kIrr.innerText = (irrOn*100).toFixed(2)+" %";

  aggregatedSummary.innerHTML = `ì´ ë§¤ì¶œ(ì—°ê°„ í•©ê³„): ${totalRevenue.toFixed(1)} ì–µì›<br>ì´ EBITDA(ì—°ê°„ í•©ê³„): ${totalEbitda.toFixed(1)} ì–µì›<br>í†µí•© IRR(ë³´ì¡°ê¸ˆ ON): ${(irrOn*100).toFixed(2)}% / OFF: ${(irrOff*100).toFixed(2)}%`;

  if(compareChart) compareChart.destroy();
  const labels=["ì—¬ê°ì„ ","ê¸€ë¨í•‘","ë²¤ì²˜","í†µí•©"];
  const data=[(f.ebitda||0),(g.ebitda||0),(v.ebitda||0), totalEbitda];
  compareChart = new Chart(compareChartEl,{type:"bar",data:{labels, datasets:[{data}]}});

  if(subsidyChart) subsidyChart.destroy();
  subsidyChart = new Chart(subsidyChartEl,{type:"line",data:{labels:["OFF","ON"], datasets:[{data:[irrOff*100, irrOn*100]}]}});
}

/* ì´ë²¤íŠ¸ ë°”ì¸ë”© */
fareSlider.oninput = ()=> fareRate.innerText = Math.round(Number(fareSlider.value)*100)+"%";
ferryAnalyze.onclick = computeFerry;
glampingAnalyze.onclick = computeGlamping;
if(ventureAnalyze) ventureAnalyze.onclick = computeVenture;
consolidateBtn.onclick = consolidateAnalysis;

// Show/hide the static scenario tables
function showScenarioTable(id){
  ['positive','neutral','negative'].forEach(k=>{
    const el = document.getElementById('scenario_'+k);
    if(el) el.style.display = (k===id)?'':'none';
  });
}

// bind radios
document.querySelectorAll('input[name="scenario"]').forEach(r=>{
  r.addEventListener('change', ()=>{
    const sel = document.querySelector('input[name="scenario"]:checked')?.value || 'positive';
    showScenarioTable(sel);
    updateKPIIndicators(); // Update KPI when scenario changes
  });
});

// bind glamping units selector and caravan checkbox
const kpiUnitsSelect = document.getElementById('kpi_glamping_units');
if(kpiUnitsSelect) {
  kpiUnitsSelect.addEventListener('change', ()=>{
    updateKPIIndicators(); // Update KPI when units change
  });
}

const kpiCaravanCheckbox = document.getElementById('kpi_include_caravan');
if(kpiCaravanCheckbox) {
  kpiCaravanCheckbox.addEventListener('change', ()=>{
    updateKPIIndicators(); // Update KPI when caravan option changes
  });
}
// init visibility on load
window.addEventListener('load', ()=>{
  // Load saved data first
  const dataLoaded = loadAllFinancialData();
  
  // í† ì§€ë¹„ìš© ì´ˆê¸° ê³„ì‚°
  calculateLandCost();
  
  // í† ì§€ë¹„ìš© ìƒì„¸ ê³„ì‚° ì˜ì—­ì„ ê¸°ë³¸ì ìœ¼ë¡œ ì ‘ì–´ë‘ 
  const landCalcDetails = document.getElementById('landCalcDetails');
  const landCalcIcon = document.getElementById('landCalcToggleIcon');
  if (landCalcDetails) {
    landCalcDetails.style.display = 'none';
  }
  if (landCalcIcon) {
    landCalcIcon.style.transform = 'rotate(-90deg)';
    landCalcIcon.textContent = 'â–¶';
  }
  
  // ê°ê°€ìƒê°ë¹„ ì´ˆê¸° ê³„ì‚°
  calculateDepreciation();
  
  // ê°ê°€ìƒê°ë¹„ ìƒì„¸ ê³„ì‚° ì˜ì—­ì„ ê¸°ë³¸ì ìœ¼ë¡œ ì ‘ì–´ë‘ 
  const depreciationDetails = document.getElementById('depreciationDetails');
  const depreciationIcon = document.getElementById('depreciationToggleIcon');
  if (depreciationDetails) {
    depreciationDetails.style.display = 'none';
  }
  if (depreciationIcon) {
    depreciationIcon.style.transform = 'rotate(-90deg)';
    depreciationIcon.textContent = 'â–¶';
  }
  
  // populate ê¸ì •/ë¶€ì • í‘œ from ì¤‘ë¦½ì•ˆ (only do this once on initial load, not on tab switches)
  // This should only be called at startup to ensure scenario tables have proper structure
  const posTable = document.getElementById('scenario_positive_table');
  const neuTable = document.getElementById('scenario_neutral_table');
  const negTable = document.getElementById('scenario_negative_table');
  
  // Only create/sync if tables appear to be empty
  if(neuTable && neuTable.querySelectorAll('tbody tr').length === 0){
    createScenarioTableSingle();
  }
  
  // ensure neutral/negative follow the positive table structure
  syncTablesFromPositive();
  // Per user request: show only the ê¸ì •ì•ˆ table by default
  setOnlyPositiveScenarioVisible();
  // bind input events and initialize the ì„ëŒ€ë£Œ column in all scenario tables
  bindGlampingInputsToRentUpdate();
  updateAllScenariosRentFromInputs();
  // bind occupancy settings and apply them to all scenarios
  bindOccupancyInputs();
  updateScenarioOccupancyFromSettings();
  
  // ì´ˆê¸° ê³„ì‚° ì‹¤í–‰
  calculateLandCost();
  calculateDepreciation();
  calculateLoanInterest();
  updateAdditionalRevenueSum();
  updateSubsidySum();
  updateFinancialSummaries();
  
  // Initialize calculations and chart after all tables are set up
  setTimeout(()=>{
    bindFinancialInputs();
    updateFinancialSummaries();
    updateAllScenarioCalculations();
    updateWeightHeader();
    updateGlampingUnitsChart();
    
    // Format all existing financial inputs with commas
    document.querySelectorAll('.financial-table tbody td:nth-child(2) input').forEach(inp => {
      formatNumberInput(inp);
    });
    
    // Format all existing operation table inputs with commas
    document.querySelectorAll('#glampingTable input[type="text"]').forEach(inp => {
      let val = removeCommas(inp.value);
      const num = parseFloat(val);
      if (!isNaN(num)) {
        inp.value = formatNumberWithCommas(Math.round(num));
      }
    });
    
    if(dataLoaded) {
      showToast('ì €ì¥ëœ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì™”ìŠµë‹ˆë‹¤.', 'success');
    }
  }, 100);
});

// ensure tab activation also shows the selected scenario
document.querySelectorAll('.tabs button').forEach(btn=>{
  const original = btn.onclick;
  btn.onclick = ()=>{
    original();
    if(btn.dataset.tab === 'glamping'){
      // refresh scenario tables when tab activated
      // Note: createScenarioTableSingle() should NOT be called here as it will reset values
      // Just ensure proper visibility and binding
      syncTablesFromPositive();
      // keep only ê¸ì •ì•ˆ visible and refresh ì„ëŒ€ë£Œ values after structural sync
      setOnlyPositiveScenarioVisible();
      bindGlampingInputsToRentUpdate();
      updateAllScenariosRentFromInputs();
      // bind occupancy settings and apply them to all scenarios
      bindOccupancyInputs();
      updateScenarioOccupancyFromSettings();
    }
  }
});

// Handle details (collapsible) open/close to preserve financial input values
document.querySelectorAll('.collapsible-section').forEach(details=>{
  // When a details element is toggled open, ensure all inputs are properly formatted
  details.addEventListener('toggle', ()=>{
    if(details.open){
      // Ensure financial inputs are visible and properly formatted
      setTimeout(()=>{
        const financialInputs = details.querySelectorAll('.financial-table tbody td:nth-child(2) input[type="number"]');
        financialInputs.forEach(inp=>{
          if(inp.value && inp.value.length > 0){
            // Value is already set - just ensure it's visible by triggering focus/blur
            const val = inp.value;
            inp.style.color = '#333';
            inp.style.backgroundColor = '#fff';
          }
        });
      }, 0);
    }
  });
});

// --- Helpers: keep only ê¸ì •ì•ˆ visible and update ì„ëŒ€ë£Œ from ìš´ì˜ ì…ë ¥í‘œ ---
let _glampingInputsBound = false;
function setOnlyPositiveScenarioVisible(){
  // hide neutral and negative scenario containers but do not alter table structure
  const pos = document.getElementById('scenario_positive'); if(pos) pos.style.display = '';
  const neu = document.getElementById('scenario_neutral'); if(neu) neu.style.display = 'none';
  const neg = document.getElementById('scenario_negative'); if(neg) neg.style.display = 'none';
  // select the positive radio so UI reflects the change
  const posRadio = document.querySelector('input[name="scenario"][value="positive"]');
  if(posRadio) posRadio.checked = true;
}

function getGlampingPrices(){
  const rows = Array.from(document.querySelectorAll('#glampingTable tbody tr'));
  // Expect rows: [ê¸°ì¤€2ì¸, ì¶”ê°€ì¸ì›(+1), ì¶”ê°€ì¸ì›(+2)] and columns: í‰ì¼, ì£¼ë§, ê³µíœ´ì¼
  const values = {weekday:null, weekend:null, holiday:null};
  if(rows.length>=1){
    const cells = rows[0].querySelectorAll('input');
    values.weekday = Number(removeCommas(cells[0]?.value || '0'));
    values.weekend = Number(removeCommas(cells[1]?.value || '0'));
    values.holiday = Number(removeCommas(cells[2]?.value || '0'));
  }
  // Return values in ì›
  return values;
}

function updateAllScenariosRentFromInputs(){
  const prices = getGlampingPrices();
  if(prices.weekday==null) return;
  // convert to ì²œì› ë‹¨ìœ„ (round)
  const p_weekday = Math.round(prices.weekday/1000);
  const p_weekend = Math.round(prices.weekend/1000);
  const p_holiday = Math.round(prices.holiday/1000);

  const tableIds = ['scenario_positive_table','scenario_neutral_table','scenario_negative_table'];
  tableIds.forEach(tblId=>{
    const tbl = document.getElementById(tblId);
    if(!tbl) return;
    const rows = Array.from(tbl.querySelectorAll('tbody tr'));
    rows.forEach(tr=>{
      const cells = Array.from(tr.children);
      // skip rows that don't have at least 3 cells (e.g., total rows with colspan)
      if(cells.length < 3) return;
      const period = (cells[1]?.textContent || '').trim();
      // Update the ì„ëŒ€ë£Œ(ì›) column (index 2) for known periods
      if(period === 'ì„±ìˆ˜ê¸°'){
        // ê³µíœ´ì¼ì„ ì„±ìˆ˜ê¸°ì™€ ë™ì¼í•˜ê²Œ ì²˜ë¦¬
        cells[2].textContent = p_holiday;
      }else if(period === 'ì£¼ë§'){
        cells[2].textContent = p_weekend;
      }else if(period === 'í‰ì¼'){
        cells[2].textContent = p_weekday;
      }
    });
  });
}

// backward-compatible wrapper
function updateNegativeRentFromInputs(){
  updateAllScenariosRentFromInputs();
}

function bindGlampingInputsToRentUpdate(){
  if(_glampingInputsBound) return;
  const inputs = document.querySelectorAll('#glampingTable input[type="text"]');
  inputs.forEach(inp=>inp.addEventListener('input', ()=>{
    updateAllScenariosRentFromInputs();
  }));
  _glampingInputsBound = true;
}

// --- ì˜ˆìƒ ê°€ë™ë¥  ì„¤ì • helpers ---
let _occInputsBound = false;
function getOccupancySettings(){
  return {
    positive: { high: Number(document.getElementById('occ_pos_high')?.value||0), weekend: Number(document.getElementById('occ_pos_weekend')?.value||0), weekday: Number(document.getElementById('occ_pos_weekday')?.value||0) },
    neutral:  { high: Number(document.getElementById('occ_neu_high')?.value||0), weekend: Number(document.getElementById('occ_neu_weekend')?.value||0), weekday: Number(document.getElementById('occ_neu_weekday')?.value||0) },
    negative: { high: Number(document.getElementById('occ_neg_high')?.value||0), weekend: Number(document.getElementById('occ_neg_weekend')?.value||0), weekday: Number(document.getElementById('occ_neg_weekday')?.value||0) }
  };
}

function updateScenarioOccupancyFromSettings(){
  const occ = getOccupancySettings();
  const mapping = { 'ì„±ìˆ˜ê¸°': 'high', 'ì£¼ë§': 'weekend', 'í‰ì¼': 'weekday' };
  const tableMap = { positive: 'scenario_positive_table', neutral: 'scenario_neutral_table', negative: 'scenario_negative_table' };

  function formatPercentValue(v){
    const n = Number(v);
    if(!isFinite(n)) return '';
    // Preserve integers (e.g., 70 -> "70"), but trim unnecessary decimal zeros (e.g., 18.0 -> "18", 18.50 -> "18.5")
    let s = String(n);
    if(s.indexOf('.') >= 0){
      s = s.replace(/\.0+$|(?<=(?:\d)\d)0+$/,'');
      s = s.replace(/\.$/, '');
    }
    return s;
  }

  Object.keys(tableMap).forEach(scn=>{
    const tbl = document.getElementById(tableMap[scn]);
    if(!tbl) return;
    const rows = Array.from(tbl.querySelectorAll('tbody tr'));
    rows.forEach(tr=>{
      const cells = Array.from(tr.children);
      if(cells.length < 6) return; // skip subtotal/total rows
      const period = (cells[1]?.textContent || '').trim();
      const key = mapping[period];
      if(!key) return;
      const val = occ[scn][key];
      if(val===null || val===undefined) return;
      const formatted = formatPercentValue(val);
      if(formatted !== '') cells[5].textContent = formatted + "%";
    });
  });
}

function bindOccupancyInputs(){
  if(_occInputsBound) return;
  const inputs = document.querySelectorAll('#occSettings input[type="number"]');
  inputs.forEach(inp=>inp.addEventListener('input', ()=>{
    if(!validateOccupancyInputs()) return;
    updateScenarioOccupancyFromSettings();
    updateAllScenarioCalculations();
  }));
  _occInputsBound = true;
}

/* --- Toast helpers --- */
function showToast(message, type='error', timeout=3500){
  const container = document.getElementById('toastContainer');
  if(!container) return;
  const el = document.createElement('div');
  el.className = 'toast '+(type==='error'?'error':'success');
  el.textContent = message;
  container.appendChild(el);
  setTimeout(()=>{ el.style.opacity = '0'; setTimeout(()=>el.remove(),300); }, timeout);
}

/* --- Input validation --- */
function validateWeightInput(){
  const el = document.getElementById('gWeight');
  if(!el) return true;
  const v = Number(el.value);
  if(!isFinite(v) || v < 0){
    showToast('ê°€ì¤‘ì¹˜ëŠ” 0 ì´ìƒì˜ ìˆ«ìì—¬ì•¼ í•©ë‹ˆë‹¤.', 'error');
    return false;
  }
  return true;
}

function formatWeightValue(v){
  const n = Number(v);
  if(!isFinite(n)) return '';
  let s = String(n);
  if(s.indexOf('.') >= 0){
    s = s.replace(/\.0+$/,'');
    s = s.replace(/(\.\d*?)0+$/,'$1');
    s = s.replace(/\.$/, '');
  }
  return s;
}

function updateWeightHeader(){
  const el = document.getElementById('gWeight');
  const s = formatWeightValue(el?.value);
  // Update all weight header inputs
  document.querySelectorAll('.weightHeader input').forEach(inp=>{
    if(inp.value !== s) inp.value = s;
  });
}

function updateWeightFromHeader(value){
  const gWeightEl = document.getElementById('gWeight');
  if(gWeightEl) {
    gWeightEl.value = value;
  }
  // Sync all weight header inputs across all scenarios
  document.querySelectorAll('.weightHeader input').forEach(inp=>{
    if(inp.value !== value) inp.value = value;
  });
  // Trigger calculation update
  if(!validateWeightInput()) return;
  updateAllScenarioCalculations();
}

window.updateWeightFromHeader = updateWeightFromHeader;

window.updateWeightFromHeader = updateWeightFromHeader; 

function validateGlampingInputs(){
  const inputs = document.querySelectorAll('#glampingTable input[type="text"]');
  for(const inp of inputs){
    const v = Number(removeCommas(inp.value));
    if(!isFinite(v) || v < 0){
      showToast('ê¸€ë¨í•‘ ìš´ì˜ ì…ë ¥ê°’ì€ 0 ì´ìƒì˜ ìˆ«ìì—¬ì•¼ í•©ë‹ˆë‹¤.', 'error');
      return false;
    }
  }
  // validate weight as well
  if(!validateWeightInput()) return false;
  return true;
} 

function validateOccupancyInputs(){
  const inputs = document.querySelectorAll('#occSettings input[type="number"]');
  for(const inp of inputs){
    const v = Number(inp.value);
    if(!isFinite(v) || v < 0 || v > 100){
      showToast('ê°€ë™ë¥ ì€ 0~100 ì‚¬ì´ì˜ ìˆ«ìì—¬ì•¼ í•©ë‹ˆë‹¤.', 'error');
      return false;
    }
  }
  return true;
}

/* --- Core: calculate revenue / add-on columns for a scenario table --- */
function updateAllScenarioCalculations(){
  if(!validateGlampingInputs()) return;
  const prices = getGlampingPrices(); // in ì›
  // convert to ì²œì›
  const base = { weekday: Math.round(prices.weekday/1000), weekend: Math.round(prices.weekend/1000), holiday: Math.round(prices.holiday/1000) };
  // add-on prices total (full price for +1 and +2)
  const glRows = Array.from(document.querySelectorAll('#glampingTable tbody tr'));
  if(glRows.length < 3) return; // need base, +1, +2 rows
  const baseRowInputs = glRows[0].querySelectorAll('input');
  const add1RowInputs = glRows[1].querySelectorAll('input');
  const add2RowInputs = glRows[2].querySelectorAll('input');
  const addon = {
    weekday: { add1: Math.round((Number(removeCommas(add1RowInputs[0]?.value||'0')) - Number(removeCommas(baseRowInputs[0]?.value||'0'))) / 1000), add2: Math.round((Number(removeCommas(add2RowInputs[0]?.value||'0')) - Number(removeCommas(baseRowInputs[0]?.value||'0'))) / 1000) },
    weekend: { add1: Math.round((Number(removeCommas(add1RowInputs[1]?.value||'0')) - Number(removeCommas(baseRowInputs[1]?.value||'0'))) / 1000), add2: Math.round((Number(removeCommas(add2RowInputs[1]?.value||'0')) - Number(removeCommas(baseRowInputs[1]?.value||'0'))) / 1000) },
    holiday: { add1: Math.round((Number(removeCommas(add1RowInputs[2]?.value||'0')) - Number(removeCommas(baseRowInputs[2]?.value||'0'))) / 1000), add2: Math.round((Number(removeCommas(add2RowInputs[2]?.value||'0')) - Number(removeCommas(baseRowInputs[2]?.value||'0'))) / 1000) }
  };

  const mapping = { 'ì„±ìˆ˜ê¸°': 'holiday', 'ì£¼ë§': 'weekend', 'í‰ì¼': 'weekday' };
  ['scenario_positive_table','scenario_neutral_table','scenario_negative_table'].forEach(tblId=>{
    const tbl = document.getElementById(tblId);
    if(!tbl) return;
    const rows = Array.from(tbl.querySelectorAll('tbody tr'));
    let currentUnits = null;
    // determine scenario key from table id
    const scnKey = tblId.includes('positive')? 'positive' : tblId.includes('neutral')? 'neutral' : 'negative';
    const occSettings = getOccupancySettings()[scnKey];
    rows.forEach(tr=>{
      const cells = Array.from(tr.children);
      if(cells.length < 6) return; // skip subtotal/total rows
      const first = (cells[0]?.textContent || '').trim();
      const m = first.match(/\((\d+)\)/);
      if(m) currentUnits = Number(m[1]);
      if(currentUnits==null) return; // skip rows until we know units
      const period = (cells[1]?.textContent || '').trim();
      const key = mapping[period];
      if(!key) return;
      const daysVal = parseInt((cells[3]?.textContent||'').replace(/[^0-9]/g,'')) || 0;
      const occText = (cells[5]?.textContent||'').trim();
      let occNum = parsePercent(occText);
      if(occNum == null) occNum = occSettings[key];
      // normalize to decimal (0-1): if value appears as 0-100 percentage, divide by 100
      let occDecimal = (typeof occNum === 'number') ? (occNum > 1 ? occNum/100 : occNum) : 0;
      // rent in ì²œì›
      const rent_th = base[key];
      const rev = Math.round(currentUnits * rent_th * daysVal * occDecimal);
      cells[6].textContent = formatNumberWithCommas(rev);
      // add1/add2 totals
      const add1_total = Math.round(currentUnits * addon[key].add1 * daysVal * occDecimal);
      const add2_total = Math.round(currentUnits * addon[key].add2 * daysVal * occDecimal);
      cells[7].textContent = formatNumberWithCommas(add1_total);
      cells[8].textContent = formatNumberWithCommas(add2_total);
      // ê°€ì¤‘ì¹˜ ê³„ì‚°: (ì¶”ê°€ì¸ì›(1) + ì¶”ê°€ì¸ì›(2)) * ê°€ì¤‘ì¹˜ (gWeight), ê²°ê³¼ëŠ” ì²œì› ë‹¨ìœ„
      const weightInput = document.querySelector('.weightHeader input');
      const weightFactor = Number(weightInput?.value || document.getElementById('gWeight')?.value) || 0;
      const weightVal = Math.round((add1_total + add2_total) * weightFactor);
      cells[9].textContent = formatNumberWithCommas(weightVal);
    });
  });
  // update scenario summaries after table calculations
  updateScenarioSummaries();
}

// Bind existing input listeners to also recompute derived columns
(function bindAdditionalListeners(){
  // extend existing bindings
  const glInputs = document.querySelectorAll('#glampingTable input[type="text"]');
  glInputs.forEach(inp=>{
    inp.addEventListener('input', ()=>{
      if(!validateGlampingInputs()) return;
      updateAllScenariosRentFromInputs();
      updateAllScenarioCalculations();
    });
    
    // Add comma formatting on blur
    inp.addEventListener('blur', (e) => {
      let val = removeCommas(e.target.value);
      const num = parseFloat(val);
      if (!isNaN(num)) {
        e.target.value = formatNumberWithCommas(Math.round(num));
      }
      updateAllScenariosRentFromInputs();
      updateAllScenarioCalculations();
    });
    
    // Remove commas on focus
    inp.addEventListener('focus', (e) => {
      e.target.value = removeCommas(e.target.value);
    });
  });

  const occInputs = document.querySelectorAll('#occSettings input[type="number"]');
  occInputs.forEach(inp=>{
    inp.addEventListener('input', ()=>{
      if(!validateOccupancyInputs()) return;
      updateScenarioOccupancyFromSettings();
      updateAllScenarioCalculations();
    });
  });

  const weightEl = document.getElementById('gWeight');
  if(weightEl){
    weightEl.addEventListener('input', ()=>{
      if(!validateWeightInput()) return;
      updateWeightHeader();
      updateAllScenarioCalculations();
    });
    // initialize header to current value
    updateWeightHeader();
  }
})();

// Bind caravan checkbox to chart update
if(includeCaravanChart){
  includeCaravanChart.addEventListener('change', ()=>{
    updateGlampingUnitsChart();
  });
}

/* create ê¸ì •/ë¶€ì • variant tables by adjusting numeric cells (+/-10%) */
function formatNumberWithCommas(n){ return n.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ","); }

function removeCommas(str) {
  return str.replace(/,/g, '');
}

function formatNumberInput(input) {
  let val = removeCommas(input.value);
  if (val === '' || val === '-') return;
  const num = parseFloat(val);
  if (!isNaN(num)) {
    // For input[type="number"], don't add commas (they don't support comma-formatted values)
    // For input[type="text"], add commas for readability
    if (input.type === 'number') {
      input.value = Math.round(num);
    } else {
      input.value = formatNumberWithCommas(Math.round(num));
    }
  }
}

function adjustTableNumbers(tableEl, factor){
  const t = tableEl.cloneNode(true);
  t.querySelectorAll('td').forEach(td=>{
    const txt = td.textContent.trim();
    if(!txt) return;
    if(txt.indexOf('%')>=0) return;
    // remove commas and non-numeric chars
    const num = Number(txt.replace(/,/g,'').replace(/[^\d.-]/g,''));
    if(!isFinite(num)) return;
    const adjusted = Math.round(num * factor);
    td.textContent = formatNumberWithCommas(adjusted);
  });
  return t;
}

// --- Scenario table parsing helpers (tables are in 'ì²œì›' units) ---
function parseTableNumberToWon(s){
  if(!s) return null;
  const cleaned = s.toString().replace(/,/g,'').replace(/[^\d.-]/g,'').trim();
  if(cleaned === '') return null;
  const asNum = Number(cleaned);
  if(!isFinite(asNum)) return null;
  // table numbers are in ì²œì› ë‹¨ìœ„, convert to ì›
  return asNum * 1000;
}

function parsePercent(s){
  if(!s) return null;
  const m = s.toString().match(/-?\d+(?:\.\d+)?/);
  return m ? Number(m[0]) : null;
}

function extractScenarioTable(id){
  const table = document.getElementById(id);
  if(!table) return [];
  const rows = Array.from(table.querySelectorAll('tbody tr'));
  return rows.map(tr=>{
    const cells = Array.from(tr.children);
    const getText = i => cells[i]?.textContent.trim() ?? '';
    return {
      raw: tr.textContent.trim(),
      col0: getText(0),
      facility: getText(1),
      rent_thousand: (function(n){ if(!n) return null; const v=Number(n.replace(/,/g,'')); return isFinite(v)? v : null; })(getText(2)),
      rent_won: parseTableNumberToWon(getText(2)),
      days: (function(n){ const v=parseInt(n); return isNaN(v)?null:v; })(getText(3)),
      annual_count: (function(n){ const v=parseInt(n); return isNaN(v)?null:v; })(getText(4)),
      occupancy_pct: parsePercent(getText(5)),
      revenue_won: parseTableNumberToWon(getText(6)),
      add1_won: parseTableNumberToWon(getText(7)),
      add2_won: parseTableNumberToWon(getText(8)),
      weight_raw: getText(9),
      weight: (function(n){ if(!n) return null; const p = parsePercent(n); if(p!==null) return p; const w = Number(n.replace(/,/g,'')); return isFinite(w)? w : null; })(getText(9)),
      note: getText(10)
    };
  });
}

window.extractScenarioTable = extractScenarioTable;
window.extractAllScenarios = ()=>({
  positive: extractScenarioTable('scenario_positive_table'),
  neutral: extractScenarioTable('scenario_neutral_table'),
  negative: extractScenarioTable('scenario_negative_table')
});

// --- Scenario summary helpers ---
function parseThousandNumber(s){
  if(!s) return 0;
  const cleaned = s.toString().replace(/,/g,'').replace(/[^0-9.-]/g,'').trim();
  if(cleaned === '') return 0;
  const n = Number(cleaned);
  return isFinite(n)? n : 0;
}

function sumRevenueForUnits(tblId, units, includeWeight = false){
  const tbl = document.getElementById(tblId);
  if(!tbl) return 0;
  const rows = Array.from(tbl.querySelectorAll('tbody tr'));
  let sum = 0;
  let inTargetUnit = false;
  
  rows.forEach(tr=>{
    const cells = Array.from(tr.children);
    const first = (cells[0]?.textContent||'').trim();
    const second = (cells[1]?.textContent||'').trim();
    
    // Check if this row starts a new unit section
    if(first.indexOf('('+units+')')>=0){
      inTargetUnit = true;
    } else if(first.indexOf('(')>=0 && first.indexOf(')')>=0){
      // This is a different unit section, stop accumulating
      inTargetUnit = false;
    }
    
    // If we're in the target unit section and this is a period row (ì„±ìˆ˜ê¸°, ì£¼ë§, í‰ì¼)
    if(inTargetUnit && (second === 'ì„±ìˆ˜ê¸°' || second === 'ì£¼ë§' || second === 'í‰ì¼')){
      const revText = cells[6]?.textContent || '';
      sum += parseThousandNumber(revText);
      if(includeWeight){
        const weightText = cells[9]?.textContent || '';
        sum += parseThousandNumber(weightText);
      }
    }
  });
  
  return sum;
}

function sumCaravan5(tblId, includeWeight = false){
  const tbl = document.getElementById(tblId);
  if(!tbl) return 0;
  const rows = Array.from(tbl.querySelectorAll('tbody tr'));
  let sum = 0;
  let inCaravan5 = false;
  
  rows.forEach(tr=>{
    const cells = Array.from(tr.children);
    const first = (cells[0]?.textContent||'').trim();
    const second = (cells[1]?.textContent||'').trim();
    
    // Check if this row starts the caravan 5 section
    if(first.indexOf('(5)')>=0){
      inCaravan5 = true;
    } else if(first.indexOf('(')>=0 && first.indexOf(')')>=0 && first.indexOf('(5)')<0){
      // This is a different section, stop accumulating
      inCaravan5 = false;
    }
    
    // If we're in the caravan 5 section and this is a period row
    if(inCaravan5 && (second === 'ì„±ìˆ˜ê¸°' || second === 'ì£¼ë§' || second === 'í‰ì¼')){
      const revText = cells[6]?.textContent || '';
      sum += parseThousandNumber(revText);
      if(includeWeight){
        const weightText = cells[9]?.textContent || '';
        sum += parseThousandNumber(weightText);
      }
    }
  });
  
  return sum;
}

function updateScenarioSummaries(){
  ['positive','neutral','negative'].forEach(scn=>{
    const tblId = 'scenario_'+scn+'_table';
    const gl10 = sumRevenueForUnits(tblId, 10, false);
    const gl10_w = sumRevenueForUnits(tblId, 10, true);
    const gl15 = sumRevenueForUnits(tblId, 15, false);
    const gl15_w = sumRevenueForUnits(tblId, 15, true);
    const gl30 = sumRevenueForUnits(tblId, 30, false);
    const gl30_w = sumRevenueForUnits(tblId, 30, true);
    const cv5 = sumCaravan5(tblId, false);
    const cv5_w = sumCaravan5(tblId, true);
    // set cells safely
    const setText = (sel, val)=>{ const el = document.querySelector(sel); if(el) el.textContent = val; };
    if(scn==='positive'){
      setText('.sp_10', formatNumberWithCommas(gl10));
      setText('.sp_10_w', formatNumberWithCommas(gl10_w));
      setText('.sp_10_p', formatNumberWithCommas(gl10 + cv5));
      setText('.sp_10_pw', formatNumberWithCommas(gl10_w + cv5_w));
      setText('.sp_15', formatNumberWithCommas(gl15));
      setText('.sp_15_w', formatNumberWithCommas(gl15_w));
      setText('.sp_15_p', formatNumberWithCommas(gl15 + cv5));
      setText('.sp_15_pw', formatNumberWithCommas(gl15_w + cv5_w));
      setText('.sp_30', formatNumberWithCommas(gl30));
      setText('.sp_30_w', formatNumberWithCommas(gl30_w));
      setText('.sp_30_p', formatNumberWithCommas(gl30 + cv5));
      setText('.sp_30_pw', formatNumberWithCommas(gl30_w + cv5_w));
    }else if(scn==='neutral'){
      setText('.sn_10', formatNumberWithCommas(gl10));
      setText('.sn_10_w', formatNumberWithCommas(gl10_w));
      setText('.sn_10_p', formatNumberWithCommas(gl10 + cv5));
      setText('.sn_10_pw', formatNumberWithCommas(gl10_w + cv5_w));
      setText('.sn_15', formatNumberWithCommas(gl15));
      setText('.sn_15_w', formatNumberWithCommas(gl15_w));
      setText('.sn_15_p', formatNumberWithCommas(gl15 + cv5));
      setText('.sn_15_pw', formatNumberWithCommas(gl15_w + cv5_w));
      setText('.sn_30', formatNumberWithCommas(gl30));
      setText('.sn_30_w', formatNumberWithCommas(gl30_w));
      setText('.sn_30_p', formatNumberWithCommas(gl30 + cv5));
      setText('.sn_30_pw', formatNumberWithCommas(gl30_w + cv5_w));
    }else{
      setText('.sg_10', formatNumberWithCommas(gl10));
      setText('.sg_10_w', formatNumberWithCommas(gl10_w));
      setText('.sg_10_p', formatNumberWithCommas(gl10 + cv5));
      setText('.sg_10_pw', formatNumberWithCommas(gl10_w + cv5_w));
      setText('.sg_15', formatNumberWithCommas(gl15));
      setText('.sg_15_w', formatNumberWithCommas(gl15_w));
      setText('.sg_15_p', formatNumberWithCommas(gl15 + cv5));
      setText('.sg_15_pw', formatNumberWithCommas(gl15_w + cv5_w));
      setText('.sg_30', formatNumberWithCommas(gl30));
      setText('.sg_30_w', formatNumberWithCommas(gl30_w));
      setText('.sg_30_p', formatNumberWithCommas(gl30 + cv5));
      setText('.sg_30_pw', formatNumberWithCommas(gl30_w + cv5_w));
    }
  });
  // Update glamping units chart after summaries are calculated
  updateGlampingUnitsChart();
  // Update KPI indicators
  updateKPIIndicators();
}

function updateGlampingUnitsChart(){
  if(!glampingUnitsChartEl) return;
  
  const includeCaravan = includeCaravanChart?.checked || false;
  
  // Collect data for all scenarios
  const scenarios = ['positive', 'neutral', 'negative'];
  const units = [10, 15, 30];
  const datasets = [];
  
  const colors = {
    positive: { border: 'rgb(46, 125, 50)', bg: 'rgba(46, 125, 50, 0.2)' },
    neutral: { border: 'rgb(66, 133, 244)', bg: 'rgba(66, 133, 244, 0.2)' },
    negative: { border: 'rgb(176, 0, 32)', bg: 'rgba(176, 0, 32, 0.2)' }
  };
  
  const lineStyles = {
    positive: [],
    neutral: [5, 5],
    negative: [10, 5]
  };
  
  const labels = { positive: 'ê¸ì •ì•ˆ', neutral: 'ì¤‘ë¦½ì•ˆ', negative: 'ë¶€ì •ì•ˆ' };
  
  // Build datasets for each scenario
  scenarios.forEach(scn => {
    const tblId = 'scenario_' + scn + '_table';
    const tbl = document.getElementById(tblId);
    
    // Check if table exists before processing
    if(!tbl) {
      console.warn('Table not found:', tblId);
      return;
    }
    
    const data = [];
    units.forEach(u => {
      let glampingWithWeight = sumRevenueForUnits(tblId, u, true);
      if(includeCaravan){
        const caravanWithWeight = sumCaravan5(tblId, true);
        glampingWithWeight += caravanWithWeight;
      }
      data.push(glampingWithWeight);
    });
    
    console.log(scn + ' data:', data); // Debug log
    
    datasets.push({
      label: labels[scn],
      data: data,
      borderColor: colors[scn].border,
      backgroundColor: colors[scn].bg,
      borderWidth: 3,
      borderDash: lineStyles[scn],
      tension: 0.3,
      fill: false,
      pointRadius: 6,
      pointHoverRadius: 8,
      pointBackgroundColor: colors[scn].border,
      pointBorderColor: '#fff',
      pointBorderWidth: 2
    });
  });
  
  console.log('Total datasets:', datasets.length); // Debug log
  
  if(glampingUnitsChart){
    glampingUnitsChart.destroy();
  }
  
  glampingUnitsChart = new Chart(glampingUnitsChartEl, {
    type: 'line',
    data: {
      labels: ['10ëŒ€', '15ëŒ€', '30ëŒ€'],
      datasets: datasets
    },
    options: {
      responsive: true,
      maintainAspectRatio: true,
      interaction: {
        mode: 'index',
        intersect: false
      },
      plugins: {
        title: {
          display: true,
          text: 'ê¸€ë¨í•‘ ëŒ€ìˆ˜ë³„ í•©ì‚°ê¸ˆì•¡ ë¹„êµ' + (includeCaravan ? ' (ì¹´ë¼ë°˜ 5ëŒ€ í¬í•¨)' : '') + ' - ê°€ì¤‘ì¹˜ í¬í•¨ (ì²œì›)',
          font: { size: 16, weight: 'bold' }
        },
        legend: {
          display: true,
          position: 'top',
          labels: {
            usePointStyle: true,
            padding: 15,
            font: { size: 13 }
          }
        },
        tooltip: {
          callbacks: {
            label: function(context) {
              let label = context.dataset.label || '';
              if (label) {
                label += ': ';
              }
              if (context.parsed.y !== null) {
                label += formatNumberWithCommas(context.parsed.y) + ' ì²œì›';
              }
              return label;
            }
          }
        }
      },
      scales: {
        y: {
          beginAtZero: false,
          grace: '5%',
          ticks: {
            callback: function(value) {
              return formatNumberWithCommas(value);
            },
            maxTicksLimit: 8
          },
          title: {
            display: true,
            text: 'í•©ì‚°ê¸ˆì•¡ (ì²œì›)',
            font: { size: 13, weight: 'bold' }
          }
        },
        x: {
          title: {
            display: true,
            text: 'ê¸€ë¨í•‘ ëŒ€ìˆ˜',
            font: { size: 13, weight: 'bold' }
          }
        }
      }
    }
  });
}

function createScenarioTableSingle(){
  // Copy HTML-only between scenario tables (no numeric adjustments)
  const pos = document.getElementById('scenario_positive_table');
  const neutral = document.getElementById('scenario_neutral_table');
  const neg = document.getElementById('scenario_negative_table');

  if(pos){
    if(neutral) neutral.innerHTML = pos.innerHTML.replace(/id="scenario_positive_table"/g, 'id="scenario_neutral_table"');
    if(neg) neg.innerHTML = pos.innerHTML.replace(/id="scenario_positive_table"/g, 'id="scenario_negative_table"');
    return;
  }

  if(neutral){
    // fallback: copy neutral into others
    if(pos) pos.innerHTML = neutral.innerHTML.replace(/id="scenario_neutral_table"/g, 'id="scenario_positive_table"');
    if(neg) neg.innerHTML = neutral.innerHTML.replace(/id="scenario_neutral_table"/g, 'id="scenario_negative_table"');
  }
}

// Sync neutral and negative tables to use the same structure as the positive table
function syncTablesFromPositive(){
  const pos = document.getElementById('scenario_positive_table');
  if(!pos) return;
  ['neutral','negative'].forEach(k=>{
    const dstId = 'scenario_'+k+'_table';
    const dst = document.getElementById(dstId);
    if(dst){
      // Clone the positive table structure into the destination table while keeping its id
      dst.innerHTML = pos.innerHTML.replace(/id="scenario_positive_table"/g, `id="${dstId}"`);
    }
  });
}

/* KPI ì‹œë‚˜ë¦¬ì˜¤ ì—…ë°ì´íŠ¸ í•¨ìˆ˜ */
function updateKPIScenario() {
  // KPI ì§€í‘œë¥¼ í˜„ì¬ ì„ íƒëœ ì‹œë‚˜ë¦¬ì˜¤ì™€ ì„¤ì •ì— ë”°ë¼ ì—…ë°ì´íŠ¸
  updateKPIIndicators();
}

window.updateKPIScenario = updateKPIScenario;

/* PDF */
downloadPdf.onclick=async()=>{
  consolidateAnalysis();
  const {jsPDF}=window.jspdf;
  const pdf=new jsPDF();
  const canvas=await html2canvas(document.body,{scale:2});
  const img=canvas.toDataURL("image/png");
  pdf.addImage(img,"PNG",0,0,210,canvas.height*210/canvas.width);
  pdf.save("Investment_Portfolio_Summary.pdf");
};
</script>

<!-- ê°œìš” íŒì—… -->
<div id="overviewPopup" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 10000; align-items: center; justify-content: center;">
  <div id="overviewPopupContent" style="background: white; width: 70%; max-width: 1200px; max-height: 85vh; border-radius: 12px; box-shadow: 0 8px 32px rgba(0,0,0,0.3); overflow: hidden; display: flex; flex-direction: column; transition: all 0.3s ease;">
    <!-- í—¤ë” -->
    <div style="padding: 20px 30px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; display: flex; justify-content: space-between; align-items: center;">
      <div style="display: flex; align-items: center; gap: 20px;">
        <h2 style="margin: 0; font-size: 24px; font-weight: 600;">ğŸ“‹ ì‚¬ì—… ê°œìš”</h2>
        <div style="display: flex; gap: 5px;">
          <button class="overview-tab-btn" data-tab="benchmark" onclick="switchOverviewTab('benchmark')" style="padding: 6px 14px; background: rgba(255,255,255,0.4); border: none; color: white; border-radius: 6px; cursor: pointer; font-size: 13px; font-weight: 500; transition: all 0.2s;" onmouseover="this.style.background='rgba(255,255,255,0.5)'" onmouseout="if(this.style.background !== 'rgba(255, 255, 255, 0.4)') this.style.background='rgba(255,255,255,0.2)'">ë²¤ì¹˜ë§ˆí‚¹</button>
          <button class="overview-tab-btn" data-tab="progress" onclick="switchOverviewTab('progress')" style="padding: 6px 14px; background: rgba(255,255,255,0.2); border: none; color: white; border-radius: 6px; cursor: pointer; font-size: 13px; font-weight: 500; transition: all 0.2s;" onmouseover="this.style.background='rgba(255,255,255,0.5)'" onmouseout="if(this.style.background !== 'rgba(255, 255, 255, 0.4)') this.style.background='rgba(255,255,255,0.2)'">ì¶”ì§„ê°œìš” ë° ë¶„ì„</button>
          <button class="overview-tab-btn" data-tab="market" onclick="switchOverviewTab('market')" style="padding: 6px 14px; background: rgba(255,255,255,0.2); border: none; color: white; border-radius: 6px; cursor: pointer; font-size: 13px; font-weight: 500; transition: all 0.2s;" onmouseover="this.style.background='rgba(255,255,255,0.5)'" onmouseout="if(this.style.background !== 'rgba(255, 255, 255, 0.4)') this.style.background='rgba(255,255,255,0.2)'">ì‹œì¥ë¶„ì„</button>
          <button class="overview-tab-btn" data-tab="transaction" onclick="switchOverviewTab('transaction')" style="padding: 6px 14px; background: rgba(255,255,255,0.2); border: none; color: white; border-radius: 6px; cursor: pointer; font-size: 13px; font-weight: 500; transition: all 0.2s;" onmouseover="this.style.background='rgba(255,255,255,0.5)'" onmouseout="if(this.style.background !== 'rgba(255, 255, 255, 0.4)') this.style.background='rgba(255,255,255,0.2)'">ì‹¤ê±°ë˜ê°€ ìƒì„¸</button>
          <button class="overview-tab-btn" data-tab="reference" onclick="switchOverviewTab('reference')" style="padding: 6px 14px; background: rgba(255,255,255,0.2); border: none; color: white; border-radius: 6px; cursor: pointer; font-size: 13px; font-weight: 500; transition: all 0.2s;" onmouseover="this.style.background='rgba(255,255,255,0.5)'" onmouseout="if(this.style.background !== 'rgba(255, 255, 255, 0.4)') this.style.background='rgba(255,255,255,0.2)'">ì°¸ê³ ìë£Œ</button>
        </div>
      </div>
      <div style="display: flex; gap: 8px;">
        <button id="overviewFullscreenBtn" onclick="toggleOverviewFullscreen()" style="background: rgba(255,255,255,0.2); border: none; color: white; font-size: 20px; width: 36px; height: 36px; border-radius: 50%; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: all 0.2s;" onmouseover="this.style.background='rgba(255,255,255,0.3)'" onmouseout="this.style.background='rgba(255,255,255,0.2)'" title="ì „ì²´í™”ë©´ í† ê¸€">â›¶</button>
        <button onclick="closeOverviewPopup()" style="background: rgba(255,255,255,0.2); border: none; color: white; font-size: 24px; width: 36px; height: 36px; border-radius: 50%; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: all 0.2s;" onmouseover="this.style.background='rgba(255,255,255,0.3)'" onmouseout="this.style.background='rgba(255,255,255,0.2)'" title="ë‹«ê¸°">Ã—</button>
      </div>
    </div>
    
    <!-- ì»¨í…ì¸  -->
    <div style="padding: 30px; overflow-y: auto; flex: 1;">
      <!-- ë²¤ì¹˜ë§ˆí‚¹ íƒ­ -->
      <div id="overview-benchmark" class="overview-tab-content" style="max-width: 900px; margin: 0 auto; display: block;">
        <h3 style="color: #667eea; margin-top: 0; margin-bottom: 20px; font-size: 20px; border-bottom: 2px solid #667eea; padding-bottom: 10px;">ë²¤ì¹˜ë§ˆí‚¹ ë¶„ì„</h3>
        
        <!-- ì—…ì²´ ì„ íƒ ë²„íŠ¼ -->
        <div style="display: flex; gap: 10px; margin-bottom: 25px;">
          <button class="benchmark-company-btn" data-company="company1" onclick="switchBenchmarkCompany('company1')" style="flex: 1; padding: 12px 20px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 14px; font-weight: 600; transition: all 0.3s; box-shadow: 0 2px 4px rgba(0,0,0,0.1);" onmouseover="if(this.style.background.indexOf('linear-gradient') === -1) this.style.background='#e8eaf6'" onmouseout="if(this.style.background.indexOf('linear-gradient') === -1) this.style.background='#f0f0f0'">ê¸€ë¨í•‘ì•¤ì¹´ë¼ë°˜</button>
          <button class="benchmark-company-btn" data-company="company2" onclick="switchBenchmarkCompany('company2')" style="flex: 1; padding: 12px 20px; background: #f0f0f0; color: #667eea; border: none; border-radius: 8px; cursor: pointer; font-size: 14px; font-weight: 600; transition: all 0.3s; box-shadow: 0 2px 4px rgba(0,0,0,0.1);" onmouseover="if(this.style.background.indexOf('linear-gradient') === -1) this.style.background='#e8eaf6'" onmouseout="if(this.style.background.indexOf('linear-gradient') === -1) this.style.background='#f0f0f0'">ì‹œëª¨ë…¸ì„¸í‚¤ ê¸€ë¨ë”</button>
        </div>
        
        <!-- ì—…ì²´ A ì»¨í…ì¸  -->
        <div id="benchmark-company1" class="benchmark-company-content" style="display: block;">
          <h4 style="color: #667eea; margin-bottom: 15px; font-size: 18px; font-weight: 600;">ê¸€ë¨í•‘ì•¤ì¹´ë¼ë°˜ ê°œìš”</h4>
          <p style="line-height: 1.8; color: #555; margin-bottom: 25px; font-size: 15px;">
            ê²½ìƒë¶ë„ í¬í•­ì‹œ ë‚¨êµ¬ í˜¸ë¯¸ê³¶ë©´ êµ¬ë§Œê¸¸ 64ì— ìœ„ì¹˜í•œ ê¸€ë¨í•‘ì•¤ì¹´ë¼ë°˜ì€ í˜¸ë¯¸ê³¶í•´ë³€ì„ í’ˆì€ ì˜¤ì…˜ë·° ê¸€ë¨í•‘ì¥ì…ë‹ˆë‹¤.
            í¬í•­ í˜¸ë¯¸ê³¶ì—ì„œ ê°€ì¥ ë¨¼ì € ë§Œë‚˜ëŠ” ë°”ë‹¤ ì „ë§ì„ ìë‘í•˜ë©°, ë™í•´ì˜ ì¼ì¶œê³¼ ë°”ë‹¤ í’ê²½ì„ ê°ìƒí•  ìˆ˜ ìˆëŠ” ìµœì ì˜ ì…ì§€ë¥¼ ê°–ì¶”ê³  ìˆìŠµë‹ˆë‹¤.
            ëŒ€í‘œ ê¹€íƒœí˜¸ê°€ ìš´ì˜í•˜ëŠ” ì´ ì‹œì„¤ì€ 2014ë…„ë¶€í„° ì˜ì—…ì„ ì‹œì‘í–ˆìœ¼ë©°, ë°”ë‹¤ì™€ ì¸ì ‘í•œ ìì—° ì¹œí™”ì ì¸ í™˜ê²½ì—ì„œ í”„ë¼ì´ë¹—í•œ íœ´ì–‘ì„ ì œê³µí•©ë‹ˆë‹¤.
          </p>
          
          <!-- ì´ë¯¸ì§€ ê°¤ëŸ¬ë¦¬ 1 (3ê°œ) -->
          <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; margin-bottom: 30px;">
            <div style="aspect-ratio: 4/3; background: #f5f5f5; border-radius: 8px; overflow: hidden; border: 1px solid #e0e0e0; cursor: pointer; position: relative; transition: transform 0.3s ease, z-index 0s; transform-origin: center center;" onmouseover="this.style.transform='scale(2.5) translateX(30%)'; this.style.zIndex='1000';" onmouseout="this.style.transform='scale(1) translateX(0)'; this.style.zIndex='1';">
              <img src="img/3.jpg" alt="ê¸€ë¨í•‘ ì „ê²½ 3" style="width: 100%; height: 100%; object-fit: cover;" />
            </div>
            <div style="aspect-ratio: 4/3; background: #f5f5f5; border-radius: 8px; overflow: hidden; border: 1px solid #e0e0e0; cursor: pointer; position: relative; transition: transform 0.3s ease, z-index 0s; transform-origin: center center;" onmouseover="this.style.transform='scale(2.5)'; this.style.zIndex='1000';" onmouseout="this.style.transform='scale(1)'; this.style.zIndex='1';">
              <img src="img/7.jpg" alt="ê¸€ë¨í•‘ ì „ê²½ 1" style="width: 100%; height: 100%; object-fit: cover;" />
            </div>
            <div style="aspect-ratio: 4/3; background: #f5f5f5; border-radius: 8px; overflow: hidden; border: 1px solid #e0e0e0; cursor: pointer; position: relative; transition: transform 0.3s ease, z-index 0s; transform-origin: center center;" onmouseover="this.style.transform='scale(2.5) translateX(-30%)'; this.style.zIndex='1000';" onmouseout="this.style.transform='scale(1) translateX(0)'; this.style.zIndex='1';">
              <img src="img/4.jpg" alt="ê¸€ë¨í•‘ ì „ê²½ 2" style="width: 100%; height: 100%; object-fit: cover;" />
            </div>

          </div>
           <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; margin-bottom: 30px;">
            <div style="aspect-ratio: 4/3; background: #f5f5f5; border-radius: 8px; overflow: hidden; border: 1px solid #e0e0e0; cursor: pointer; position: relative; transition: transform 0.3s ease, z-index 0s; transform-origin: center center;" onmouseover="this.style.transform='scale(2.5) translateX(30%)'; this.style.zIndex='1000';" onmouseout="this.style.transform='scale(1) translateX(0)'; this.style.zIndex='1';">
              <img src="img/2.jpg" alt="ê¸€ë¨í•‘ ì „ê²½ 3" style="width: 100%; height: 100%; object-fit: cover;" />
            </div>
            <div style="aspect-ratio: 4/3; background: #f5f5f5; border-radius: 8px; overflow: hidden; border: 1px solid #e0e0e0; cursor: pointer; position: relative; transition: transform 0.3s ease, z-index 0s; transform-origin: center center;" onmouseover="this.style.transform='scale(2.5)'; this.style.zIndex='1000';" onmouseout="this.style.transform='scale(1)'; this.style.zIndex='1';">
              <img src="img/pohang_glamping.jpg" alt="ê¸€ë¨í•‘ ì „ê²½ 1" style="width: 100%; height: 100%; object-fit: cover;" />
            </div>
            <div style="aspect-ratio: 4/3; background: #f5f5f5; border-radius: 8px; overflow: hidden; border: 1px solid #e0e0e0; cursor: pointer; position: relative; transition: transform 0.3s ease, z-index 0s; transform-origin: center center;" onmouseover="this.style.transform='scale(2.5) translateX(-30%)'; this.style.zIndex='1000';" onmouseout="this.style.transform='scale(1) translateX(0)'; this.style.zIndex='1';">
              <img src="img/phohang_square-1.jpg" alt="ê¸€ë¨í•‘ ì „ê²½ 2" style="width: 100%; height: 100%; object-fit: cover;" />
            </div>

          </div>
          
          <h4 style="color: #667eea; margin-bottom: 15px; font-size: 18px; font-weight: 600;">ì£¼ìš” íŠ¹ì§•</h4>
          <ul style="line-height: 2; color: #555; margin-bottom: 25px; font-size: 15px;">
            <li><strong>ì˜¤ì…˜ë·° ì…ì§€:</strong> í˜¸ë¯¸ê³¶í•´ë³€ì„ í’ˆì€ ë°”ë‹¤ ì „ë§, ë™í•´ ì¼ì¶œ ê°ìƒ ìµœì ì§€</li>
            <li><strong>í˜¸ë¯¸ê³¶ ê´€ê´‘ì§€ ì¸ì ‘:</strong> í˜¸ë¯¸ê³¶ í•´ë§ì´ê´‘ì¥, êµ­ë¦½ë“±ëŒ€ë°•ë¬¼ê´€ ë“± ì£¼ìš” ê´€ê´‘ì§€ì™€ ê·¼ì ‘</li>
            <li><strong>ë‹¤ì–‘í•œ ê°ì‹¤:</strong> ê¸€ë¨í•‘ê³¼ ì¹´ë¼ë°˜ ì‹œì„¤ ë³´ìœ ë¡œ ê³ ê° ì„ íƒí­ ì œê³µ</li>
            <li><strong>ë„¤ì´ë²„ ì˜ˆì•½ ì‹œìŠ¤í…œ:</strong> ì˜¨ë¼ì¸ ì˜ˆì•½ ì‹œìŠ¤í…œ êµ¬ì¶•ìœ¼ë¡œ í¸ë¦¬í•œ ì˜ˆì•½ ê°€ëŠ¥</li>
            <li><strong>SNS í™œì„±í™”:</strong> ì¸ìŠ¤íƒ€ê·¸ë¨, ë„¤ì´ë²„ë¸”ë¡œê·¸ ìš´ì˜ìœ¼ë¡œ í™œë°œí•œ ë§ˆì¼€íŒ… í™œë™</li>
          </ul>
          
          <h4 style="color: #667eea; margin-bottom: 15px; font-size: 18px; font-weight: 600;">ìš´ì˜ ì •ë³´</h4>
          <p style="line-height: 1.8; color: #555; margin-bottom: 20px; font-size: 15px;">
            <strong>ì£¼ì†Œ:</strong> ê²½ìƒë¶ë„ í¬í•­ì‹œ ë‚¨êµ¬ í˜¸ë¯¸ê³¶ë©´ êµ¬ë§Œê¸¸ 64 (êµ¬ë§Œë¦¬ 603)<br>
            <strong>ì‚¬ì—…ìë²ˆí˜¸:</strong> 506-21-30521<br>
            <strong>í†µì‹ íŒë§¤ë²ˆí˜¸:</strong> ì œ2014-ê²½ë¶í¬í•­-0285í˜¸<br>
            <strong>ëŒ€í‘œ:</strong> ê¹€íƒœí˜¸<br>
            <strong>ì—°ë½ì²˜:</strong> 010-8974-1004<br>
            <strong>ì˜ˆì•½:</strong> ë„¤ì´ë²„ ì˜ˆì•½ ì‹œìŠ¤í…œ ìš´ì˜
          </p>
          
          <!-- ì´ë¯¸ì§€ ê°¤ëŸ¬ë¦¬ 2 (3ê°œ) -->
          <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; margin-bottom: 30px;">
            <div style="aspect-ratio: 4/3; background: #f5f5f5; border-radius: 8px; overflow: hidden; border: 1px solid #e0e0e0; cursor: pointer; position: relative; transition: transform 0.3s ease, z-index 0s; transform-origin: center center;" onmouseover="this.style.transform='scale(2.5) translateX(30%)'; this.style.zIndex='1000';" onmouseout="this.style.transform='scale(1) translateX(0)'; this.style.zIndex='1';">
              <img src="img/12.jpg" alt="ê¸€ë¨í•‘ ë‚´ë¶€ 1" style="width: 100%; height: 100%; object-fit: cover;" />
            </div>
            <div style="aspect-ratio: 4/3; background: #f5f5f5; border-radius: 8px; overflow: hidden; border: 1px solid #e0e0e0; cursor: pointer; position: relative; transition: transform 0.3s ease, z-index 0s; transform-origin: center center;" onmouseover="this.style.transform='scale(2.5)'; this.style.zIndex='1000';" onmouseout="this.style.transform='scale(1)'; this.style.zIndex='1';">
              <img src="img/16.jpg" alt="ê¸€ë¨í•‘ ë‚´ë¶€ 2" style="width: 100%; height: 100%; object-fit: cover;" />
            </div>
            <div style="aspect-ratio: 4/3; background: #f5f5f5; border-radius: 8px; overflow: hidden; border: 1px solid #e0e0e0; cursor: pointer; position: relative; transition: transform 0.3s ease, z-index 0s; transform-origin: center center;" onmouseover="this.style.transform='scale(2.5) translateX(-30%)'; this.style.zIndex='1000';" onmouseout="this.style.transform='scale(1) translateX(0)'; this.style.zIndex='1';">
              <img src="img/5.jpg" alt="ë¶€ëŒ€ì‹œì„¤" style="width: 100%; height: 100%; object-fit: cover;" />
            </div>
          </div>
          
          <h4 style="color: #667eea; margin-bottom: 15px; font-size: 18px; font-weight: 600;">ì‹œì‚¬ì </h4>
          <p style="line-height: 1.8; color: #555; margin-bottom: 25px; font-size: 15px;">
            ê¸€ë¨í•‘ì•¤ì¹´ë¼ë°˜ì€ í˜¸ë¯¸ê³¶ì´ë¼ëŠ” ìš°ìˆ˜í•œ ê´€ê´‘ ì…ì§€ë¥¼ í™œìš©í•˜ì—¬ ì˜¤ì…˜ë·°ë¼ëŠ” ì°¨ë³„í™”ëœ ê°€ì¹˜ë¥¼ ì œê³µí•˜ê³  ìˆìŠµë‹ˆë‹¤.
            2014ë…„ë¶€í„° 10ë…„ ì´ìƒ ìš´ì˜ë˜ì–´ ì˜¨ ì•ˆì •ì ì¸ ì‚¬ì—… ëª¨ë¸ì´ë©°, ì˜¨ë¼ì¸ ì˜ˆì•½ ì‹œìŠ¤í…œê³¼ SNS ë§ˆì¼€íŒ…ì„ ì ê·¹ í™œìš©í•˜ëŠ” í˜„ëŒ€ì  ìš´ì˜ ë°©ì‹ì„ ë³´ì—¬ì¤ë‹ˆë‹¤.
            í˜¸ë¯¸ê³¶ ê´€ê´‘ì§€ì™€ì˜ ì‹œë„ˆì§€ë¥¼ í†µí•´ ê´€ê´‘ê° ìœ ì…ì„ ê·¹ëŒ€í™”í•˜ê³  ìˆìœ¼ë©°, ë°”ë‹¤ ì „ë§ì´ë¼ëŠ” í•µì‹¬ ê²½ìŸë ¥ì„ ì˜ í™œìš©í•˜ê³  ìˆëŠ” ë²¤ì¹˜ë§ˆí¬ ì‚¬ë¡€ì…ë‹ˆë‹¤.
          </p>
          
          <h4 style="color: #667eea; margin-bottom: 15px; font-size: 18px; font-weight: 600; margin-top: 40px;">ì†Œê°œ ì˜ìƒ</h4>
          <div style="background: #f5f5f5; border-radius: 8px; border: 1px solid #e0e0e0; padding: 20px; margin-bottom: 30px;">
            <div style="position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden; border-radius: 8px;">
              <iframe src="https://player.vimeo.com/video/802996559?h=c3f6f7f5d3&title=0&byline=0&portrait=0" 
                      style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; border: 0;" 
                      allow="autoplay; fullscreen; picture-in-picture" 
                      allowfullscreen>
              </iframe>
            </div>
            <p style="margin-top: 15px; color: #666; font-size: 14px; text-align: center;">ê¸€ë¨í•‘ì•¤ì¹´ë¼ë°˜ ì‹œì„¤ ì†Œê°œ ë° í˜„ì¥ ì˜ìƒ</p>
          </div>
        </div>
        
        <!-- ì—…ì²´ B ì»¨í…ì¸  -->
        <div id="benchmark-company2" class="benchmark-company-content" style="display: none;">
          <h4 style="color: #667eea; margin-bottom: 15px; font-size: 18px; font-weight: 600;">ì‹œëª¨ë…¸ì„¸í‚¤ ê¸€ë¨ë” ê°œìš”</h4>
          <p style="line-height: 1.8; color: #555; margin-bottom: 25px; font-size: 15px;">
            ì¼ë³¸ ì•¼ë§ˆêµ¬ì¹˜í˜„ ì‹œëª¨ë…¸ì„¸í‚¤ì‹œì— ìœ„ì¹˜í•œ ì‹œëª¨ë…¸ì„¸í‚¤ ê¸€ë¨ë”(GLAMDOM SHIMONOSEKI SHIOMI)ì€ ê°„ëª¬í•´í˜‘ì„ ë°”ë¼ë³´ëŠ” í•´ì•ˆ ê¸€ë¨í•‘ ì‹œì„¤ì…ë‹ˆë‹¤.
            ì‹œëª¨ë…¸ì„¸í‚¤ì˜ ê´€ë¬¸ì¸ ê°„ëª¬í•´í˜‘ì˜ ì›…ì¥í•œ ê²½ê´€ì„ ê°ì‹¤ì—ì„œ ì¦ê¸¸ ìˆ˜ ìˆìœ¼ë©°, í›„ì¿ ì˜¤ì¹´ì—ì„œ ì°¨ë¡œ ì•½ 45ë¶„ ê±°ë¦¬ì— ìœ„ì¹˜í•œ ì ‘ê·¼ì„± ì¢‹ì€ ë¦¬ì¡°íŠ¸ì…ë‹ˆë‹¤.
            2022ë…„ ê°œì¥í•˜ì—¬ í”„ë¦¬ë¯¸ì—„ ê¸€ë¨í•‘ ì²´í—˜ì„ ì œê³µí•˜ê³  ìˆìœ¼ë©°, ë°”ë‹¤ ì „ë§ê³¼ í•¨ê»˜ í˜„ëŒ€ì ì¸ ì‹œì„¤ì„ ê°–ì¶˜ ëŸ­ì…”ë¦¬ ê¸€ë¨í•‘ì¥ì…ë‹ˆë‹¤.
          </p>
          
          <!-- ì´ë¯¸ì§€ ê°¤ëŸ¬ë¦¬ 1 (3ê°œ) -->
          <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; margin-bottom: 30px;">
            <div style="aspect-ratio: 4/3; background: #f5f5f5; border-radius: 8px; overflow: hidden; border: 1px solid #e0e0e0; cursor: pointer; position: relative; transition: transform 0.3s ease, z-index 0s; transform-origin: center center;" onmouseover="this.style.transform='scale(2.5) translateX(30%)'; this.style.zIndex='1000';" onmouseout="this.style.transform='scale(1) translateX(0)'; this.style.zIndex='1';">
              <img src="img/simonoseki/slider01-2.jpg" alt="ê¸€ë¨ë” ì „ê²½ 1" style="width: 100%; height: 100%; object-fit: cover;" />
            </div>
            <div style="aspect-ratio: 4/3; background: #f5f5f5; border-radius: 8px; overflow: hidden; border: 1px solid #e0e0e0; cursor: pointer; position: relative; transition: transform 0.3s ease, z-index 0s; transform-origin: center center;" onmouseover="this.style.transform='scale(2.5)'; this.style.zIndex='1000';" onmouseout="this.style.transform='scale(1)'; this.style.zIndex='1';">
              <img src="img/simonoseki/room.jpg" alt="ê¸€ë¨ë” ì „ê²½ 2" style="width: 100%; height: 100%; object-fit: cover;" />
            </div>
            <div style="aspect-ratio: 4/3; background: #f5f5f5; border-radius: 8px; overflow: hidden; border: 1px solid #e0e0e0; cursor: pointer; position: relative; transition: transform 0.3s ease, z-index 0s; transform-origin: center center;" onmouseover="this.style.transform='scale(2.5) translateX(-30%)'; this.style.zIndex='1000';" onmouseout="this.style.transform='scale(1) translateX(0)'; this.style.zIndex='1';">
              <img src="img/simonoseki/act_3.jpg" alt="ê¸€ë¨ë” ì „ê²½ 3" style="width: 100%; height: 100%; object-fit: cover;" />
            </div>
          </div>
          
          <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; margin-bottom: 30px;">
            <div style="aspect-ratio: 4/3; background: #f5f5f5; border-radius: 8px; overflow: hidden; border: 1px solid #e0e0e0; cursor: pointer; position: relative; transition: transform 0.3s ease, z-index 0s; transform-origin: center center;" onmouseover="this.style.transform='scale(2.5) translateX(30%)'; this.style.zIndex='1000';" onmouseout="this.style.transform='scale(1) translateX(0)'; this.style.zIndex='1';">
              <img src="img/simonoseki/act_4.jpg" alt="í•´ì•ˆ ì „ë§" style="width: 100%; height: 100%; object-fit: cover;" />
            </div>
            <div style="aspect-ratio: 4/3; background: #f5f5f5; border-radius: 8px; overflow: hidden; border: 1px solid #e0e0e0; cursor: pointer; position: relative; transition: transform 0.3s ease, z-index 0s; transform-origin: center center;" onmouseover="this.style.transform='scale(2.5)'; this.style.zIndex='1000';" onmouseout="this.style.transform='scale(1)'; this.style.zIndex='1';">
              <img src="img/simonoseki/gallery09.jpg" alt="ê°„ëª¬í•´í˜‘ ì „ë§" style="width: 100%; height: 100%; object-fit: cover;" />
            </div>
            <div style="aspect-ratio: 4/3; background: #f5f5f5; border-radius: 8px; overflow: hidden; border: 1px solid #e0e0e0; cursor: pointer; position: relative; transition: transform 0.3s ease, z-index 0s; transform-origin: center center;" onmouseover="this.style.transform='scale(2.5) translateX(-30%)'; this.style.zIndex='1000';" onmouseout="this.style.transform='scale(1) translateX(0)'; this.style.zIndex='1';">
              <img src="img/simonoseki/room_mv.jpg" alt="ì•¼ê²½" style="width: 100%; height: 100%; object-fit: cover;" />
            </div>
          </div>
          
          <h4 style="color: #667eea; margin-bottom: 15px; font-size: 18px; font-weight: 600;">ì£¼ìš” íŠ¹ì§•</h4>
          <ul style="line-height: 2; color: #555; margin-bottom: 25px; font-size: 15px;">
            <li><strong>í”„ë¦¬ë¯¸ì—„ ì˜¤ì…˜ë·°:</strong> ê°„ëª¬í•´í˜‘ì„ ì¡°ë§í•˜ëŠ” ìµœê³ ì˜ ì „ë§, í•´í˜‘ ì•¼ê²½ ê°ìƒ ê°€ëŠ¥</li>
            <li><strong>í›„ì¿ ì˜¤ì¹´ ê·¼êµ ì…ì§€:</strong> í›„ì¿ ì˜¤ì¹´ì—ì„œ ì°¨ë¡œ 45ë¶„, ì ‘ê·¼ì„±ì´ ìš°ìˆ˜í•œ ê´€ê´‘ ê±°ì </li>
            <li><strong>ëŸ­ì…”ë¦¬ ê¸€ë¨í•‘:</strong> ë”í˜• í…íŠ¸ì— ê³ ê¸‰ ì¹¨êµ¬, ë‚œë°©, í™”ì¥ì‹¤ ë“± ì™„ë¹„ëœ í”„ë¦¬ë¯¸ì—„ ì‹œì„¤</li>
            <li><strong>BBQ & ì‹ì‚¬ ì œê³µ:</strong> ì§€ì—­ íŠ¹ì‚°ë¬¼ì„ í™œìš©í•œ BBQ íŒ¨í‚¤ì§€ì™€ ì¡°ì‹ ì„œë¹„ìŠ¤ ì œê³µ</li>
            <li><strong>ê´€ê´‘ì§€ ì—°ê³„:</strong> ê°„ëª¬í•´í˜‘, ì¹´ì´ì¿„ì¹¸ ìˆ˜ì¡±ê´€, ì¹´ëª¬ì™€í”„ ë“± ì£¼ìš” ê´€ê´‘ì§€ ì¸ì ‘</li>
          </ul>
          
          <h4 style="color: #667eea; margin-bottom: 15px; font-size: 18px; font-weight: 600;">ìš´ì˜ ì •ë³´</h4>
          <p style="line-height: 1.8; color: #555; margin-bottom: 20px; font-size: 15px;">
            <strong>ìœ„ì¹˜:</strong> ì¼ë³¸ ì•¼ë§ˆêµ¬ì¹˜í˜„ ì‹œëª¨ë…¸ì„¸í‚¤ì‹œ ë¯¸ì¹´ë¯¸ë§ˆì¹˜ ì‹œì˜¤ë¯¸<br>
            <strong>ê°œì¥:</strong> 2022ë…„<br>
            <strong>ê°ì‹¤ íƒ€ì…:</strong> ê¸€ë¨ë”(ë”í˜• ê¸€ë¨í•‘)<br>
            <strong>ì£¼ìš” ì‹œì„¤:</strong> í”„ë¼ì´ë¹— BBQ ë°í¬, ìƒ¤ì›Œì‹¤, ê°œë³„ í™”ì¥ì‹¤<br>
            <strong>íŠ¹ë³„ ì„œë¹„ìŠ¤:</strong> ì¡°ì‹ ì œê³µ, ì„ì–‘ ê°ìƒ ë°í¬, ë°˜ë ¤ë™ë¬¼ ë™ë°˜ ê°€ëŠ¥(ì¼ë¶€ ê°ì‹¤)
          </p>
          
          <!-- ì´ë¯¸ì§€ ê°¤ëŸ¬ë¦¬ 2 (3ê°œ) -->
          <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; margin-bottom: 30px;">
            <div style="aspect-ratio: 4/3; background: #f5f5f5; border-radius: 8px; overflow: hidden; border: 1px solid #e0e0e0; cursor: pointer; position: relative; transition: transform 0.3s ease, z-index 0s; transform-origin: center center;" onmouseover="this.style.transform='scale(2.5) translateX(30%)'; this.style.zIndex='1000';" onmouseout="this.style.transform='scale(1) translateX(0)'; this.style.zIndex='1';">
              <img src="img/simonoseki/gd_shimonoseki03.jpg" alt="ë” ë‚´ë¶€ 1" style="width: 100%; height: 100%; object-fit: cover;" />
            </div>
            <div style="aspect-ratio: 4/3; background: #f5f5f5; border-radius: 8px; overflow: hidden; border: 1px solid #e0e0e0; cursor: pointer; position: relative; transition: transform 0.3s ease, z-index 0s; transform-origin: center center;" onmouseover="this.style.transform='scale(2.5)'; this.style.zIndex='1000';" onmouseout="this.style.transform='scale(1)'; this.style.zIndex='1';">
              <img src="img/simonoseki/smn_1.jpg" alt="BBQ ë°í¬" style="width: 100%; height: 100%; object-fit: cover;" />
            </div>
            <div style="aspect-ratio: 4/3; background: #f5f5f5; border-radius: 8px; overflow: hidden; border: 1px solid #e0e0e0; cursor: pointer; position: relative; transition: transform 0.3s ease, z-index 0s; transform-origin: center center;" onmouseover="this.style.transform='scale(2.5) translateX(-30%)'; this.style.zIndex='1000';" onmouseout="this.style.transform='scale(1) translateX(0)'; this.style.zIndex='1';">
              <img src="img/simonoseki/theater.jpg" alt="ë¶€ëŒ€ì‹œì„¤" style="width: 100%; height: 100%; object-fit: cover;" />
            </div>
          </div>
          
          <h4 style="color: #667eea; margin-bottom: 15px; font-size: 18px; font-weight: 600;">ì‹œì‚¬ì </h4>
          <p style="line-height: 1.8; color: #555; margin-bottom: 25px; font-size: 15px;">
            ì‹œëª¨ë…¸ì„¸í‚¤ ê¸€ë¨ë”ì€ ê°„ëª¬í•´í˜‘ì´ë¼ëŠ” ë…íŠ¹í•œ ì…ì§€ë¥¼ í™œìš©í•˜ì—¬ í”„ë¦¬ë¯¸ì—„ í•´ì•ˆ ê¸€ë¨í•‘ ê²½í—˜ì„ ì œê³µí•˜ê³  ìˆìŠµë‹ˆë‹¤.
            í›„ì¿ ì˜¤ì¹´ì™€ ê°€ê¹Œìš´ ìœ„ì¹˜ë¡œ ëŒ€ë„ì‹œ ì ‘ê·¼ì„±ì´ ìš°ìˆ˜í•˜ë©°, ë”í˜• êµ¬ì¡°ë¬¼ì„ í™œìš©í•œ ëŸ­ì…”ë¦¬ ê¸€ë¨í•‘ ì½˜ì…‰íŠ¸ê°€ ì°¨ë³„í™” í¬ì¸íŠ¸ì…ë‹ˆë‹¤.
            ì§€ì—­ íŠ¹ì‚°ë¬¼ì„ í™œìš©í•œ ì‹ì‚¬ ì„œë¹„ìŠ¤ì™€ ì£¼ë³€ ê´€ê´‘ì§€ì™€ì˜ ì—°ê³„ë¥¼ í†µí•´ ì¢…í•©ì ì¸ ê´€ê´‘ ì²´í—˜ì„ ì œê³µí•˜ê³  ìˆìœ¼ë©°,
            í•´í˜‘ ì „ë§ì´ë¼ëŠ” ë…íŠ¹í•œ ê²½ê´€ ìì›ì„ ìµœëŒ€í•œ í™œìš©í•œ ì„±ê³µì ì¸ í”„ë¦¬ë¯¸ì—„ ê¸€ë¨í•‘ ë²¤ì¹˜ë§ˆí¬ ì‚¬ë¡€ì…ë‹ˆë‹¤.
          </p>
          
          <h4 style="color: #667eea; margin-bottom: 15px; font-size: 18px; font-weight: 600; margin-top: 40px;">ì†Œê°œ ì˜ìƒ</h4>
          <div style="background: #f5f5f5; border-radius: 8px; border: 1px solid #e0e0e0; padding: 20px; margin-bottom: 30px;">
            <div style="position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden; border-radius: 8px;">
              <iframe 
                     style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; border: 0; border-radius: 8px;" 
                     src="https://www.youtube.com/embed/JyKvqnUvWps" 
                     allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
                     allowfullscreen>
              </iframe>
            </div>
            <p style="margin-top: 15px; color: #666; font-size: 14px; text-align: center;">ì‹œëª¨ë…¸ì„¸í‚¤ ê¸€ë¨ë” ì‹œì„¤ ì†Œê°œ ë° í˜„ì¥ ì˜ìƒ</p>
          </div>
        </div>
      </div>
      
      <!-- ì¶”ì§„ê°œìš” ë° ë¶„ì„ íƒ­ -->
      <div id="overview-progress" class="overview-tab-content" style="max-width: 900px; margin: 0 auto; display: none;">
        <h3 style="color: #667eea; margin-top: 0; margin-bottom: 20px; font-size: 20px; border-bottom: 2px solid #667eea; padding-bottom: 10px;">í”„ë¡œì íŠ¸ ì¶”ì§„ ê°œìš”</h3>
        <p style="line-height: 1.8; color: #555; margin-bottom: 30px; font-size: 15px;">
          í•´ì–‘ ê´€ê´‘ í´ëŸ¬ìŠ¤í„° ì‚¬ì—…ì€ <strong style="color: #667eea;">ë¶€ì‚° ë¶í•­ ì¬ê°œë°œ</strong>ê³¼ <strong style="color: #667eea;">ë‹¤ëŒ€í¬ íŒ¨í‚¤ì§€ ê°œë°œ</strong>ì„ í†µí•´ <span style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 2px 8px; border-radius: 4px; font-weight: 600;">í•´ì–‘ ë ˆì € ê´€ê´‘ ì‹œì¥ì„ ì„ ë„</span>í•©ë‹ˆë‹¤.
          ê¸°ì¡´ í•´ìš´ ì‚¬ì—…ê³¼ ë¶€ì‚°ì˜ í’ë¶€í•œ í•´ì–‘ ìì›ì„ í™œìš©í•˜ì—¬ êµ­ë‚´ ì—¬ê° ìš´ì†¡ ë° ê´€ê´‘ ë¹„ì¦ˆë‹ˆìŠ¤ë¥¼ êµ¬ì¶•í•˜ë©°,
          <strong style="color: #e91e63;">2030ì„¸ëŒ€</strong>ì˜ ë ˆì € í™œë™ ì¦ê°€ íŠ¸ë Œë“œì™€ <strong>í•´ì–‘ë ˆì € ì‹œì¥ì˜ ì„±ì¥ì„¸</strong>ì— ì£¼ëª©í•˜ì—¬ ì‚¬ì—…ì„ ì „ê°œí•©ë‹ˆë‹¤.
        </p>
        
        <h3 style="color: #667eea; margin-bottom: 20px; font-size: 20px; border-bottom: 2px solid #667eea; padding-bottom: 10px;">ì£¼ìš” ì‚¬ì—… êµ¬ì„±</h3>
        
        <h4 style="color: #667eea; margin-top: 25px; margin-bottom: 15px; font-size: 17px; font-weight: 600;">1. ë ˆì € ìº í•‘ ì—°ê³„</h4>
        <p style="line-height: 1.8; color: #555; margin-bottom: 20px; font-size: 15px; padding-left: 15px; border-left: 3px solid #667eea;">
          <strong>í•´ë³€ ê¸€ë¨í•‘ + ë¡œì»¬ ë ˆì € ì²´í—˜</strong><br>
          ì‹œëª¨ë…¸ì„¸í‚¤ GLAMP DOMEì„ ë²¤ì¹˜ë§ˆí‚¹í•˜ì—¬ í•´ë³€ ê¸€ë¨í•‘ ì‹œì„¤ì„ êµ¬ì¶•í•˜ê³ ,
          ì§€ì—­ íŠ¹í™” ë ˆì € ì²´í—˜ í”„ë¡œê·¸ë¨ì„ ì¶”ê°€í•˜ì—¬ ì°¨ë³„í™”ëœ ë³µí•© ë ˆì € ê³µê°„ì„ ì¡°ì„±í•©ë‹ˆë‹¤.
          í”„ë¦¬ë¯¸ì—„ ê¸€ë¨í•‘ ì‹œì„¤ê³¼ í•¨ê»˜ í•´ì–‘ ìŠ¤í¬ì¸ , í•´ë³€ ì•¡í‹°ë¹„í‹° ë“± ë‹¤ì–‘í•œ ë¡œì»¬ ì²´í—˜ì„ ê²°í•©í•©ë‹ˆë‹¤.
        </p>
        
        <h4 style="color: #667eea; margin-top: 25px; margin-bottom: 15px; font-size: 17px; font-weight: 600;">2. ê´€ê´‘ íŒ¨í‚¤ì§€</h4>
        <p style="line-height: 1.8; color: #555; margin-bottom: 20px; font-size: 15px; padding-left: 15px; border-left: 3px solid #667eea;">
          <strong>í•´ìƒ íˆ¬ì–´ í¬ë£¨ì¦ˆ + ë¬¸í™”ê´€ê´‘ + ì—­ì‚¬ ëª…ì†Œ</strong><br>
          í•´ìƒ íˆ¬ì–´ í¬ë£¨ì¦ˆë¥¼ ì¤‘ì‹¬ìœ¼ë¡œ ë¶€ì‚°ì˜ ë¬¸í™”ê´€ê´‘ ìì›ê³¼ ì—­ì‚¬ ëª…ì†Œë¥¼ ì—°ê³„í•œ ì¢…í•© ê´€ê´‘ íŒ¨í‚¤ì§€ë¥¼ ê°œë°œí•©ë‹ˆë‹¤.
          í•´ì–‘ ê´€ê´‘ê³¼ ìœ¡ìƒ ê´€ê´‘ì„ í†µí•©í•˜ì—¬ ì‹œë„ˆì§€ë¥¼ ê·¹ëŒ€í™”í•˜ê³ , ë¶€ì‚°ë§Œì˜ ë…íŠ¹í•œ í•´ì–‘ ë¬¸í™” ì²´í—˜ì„ ì œê³µí•©ë‹ˆë‹¤.
        </p>
        
        <h4 style="color: #667eea; margin-top: 25px; margin-bottom: 15px; font-size: 17px; font-weight: 600;">3. ë¶í•­ 2ë‹¨ê³„ ì¬ê°œë°œ ì—°ê³„</h4>
        <p style="line-height: 1.8; color: #555; margin-bottom: 30px; font-size: 15px; padding-left: 15px; border-left: 3px solid #667eea;">
          <strong>ë§ˆë¦¬ë‚˜ ìš”íŠ¸/ë³´íŠ¸ ì²´í—˜ + F&B</strong><br>
          ë¶í•­ 2ë‹¨ê³„ ì¬ê°œë°œ ì‚¬ì—…ê³¼ ì—°ê³„í•˜ì—¬ ë§ˆë¦¬ë‚˜ ì‹œì„¤ ê¸°ë°˜ì˜ ìš”íŠ¸ ë° ë³´íŠ¸ ì²´í—˜ í”„ë¡œê·¸ë¨ì„ êµ¬ì¶•í•©ë‹ˆë‹¤.
          í•´ì–‘ ë ˆì € ì‹œì„¤ê³¼ í•¨ê»˜ ê³ ê¸‰ F&B ì„œë¹„ìŠ¤ë¥¼ ê²°í•©í•˜ì—¬ í”„ë¦¬ë¯¸ì—„ í•´ì–‘ ê´€ê´‘ ê±°ì ìœ¼ë¡œ ìœ¡ì„±í•©ë‹ˆë‹¤.
        </p>
        
        <h3 style="color: #667eea; margin-bottom: 20px; font-size: 20px; border-bottom: 2px solid #667eea; padding-bottom: 10px; margin-top: 50px;">ê¸€ë¨í•‘ì¥ ìš´ì˜ì—¬ê±´ ë¶„ì„</h3>
        
        <h4 style="color: #667eea; margin-top: 30px; margin-bottom: 15px; font-size: 18px; font-weight: 600;">1. ì§€ë¦¬ì  ì—¬ê±´</h4>
        
        <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; border-left: 4px solid #667eea; margin-bottom: 20px;">
          <h5 style="color: #667eea; margin-top: 0; margin-bottom: 12px; font-size: 16px; font-weight: 600;">ğŸ“ ë‹¤ëŒ€í¬</h5>
          <ul style="line-height: 1.9; color: #555; margin-bottom: 0; font-size: 15px; padding-left: 20px;">
            <li>ğŸš‡ <strong>ë¶€ì‚° ì§€í•˜ì²  1í˜¸ì„  ë‹¤ëŒ€í¬ì—­</strong>ê³¼ ê·¼ì ‘í•˜ì—¬ <span style="background: #e3f2fd; padding: 2px 6px; border-radius: 3px; font-weight: 600;">ëŒ€ì¤‘êµí†µ ì ‘ê·¼ì„± ìš°ìˆ˜</span>, ì°¨ëŸ‰ ì´ìš© ì‹œì—ë„ í¸ë¦¬í•œ ìœ„ì¹˜</li>
            <li>ğŸ–ï¸ ì—¬ë¦„ì²  <strong style="color: #00acc1;">í•´ìˆ˜ìš• ì—°ê³„ ìº í•‘ íŠ¹í™” í”„ë¡œê·¸ë¨</strong> ê¸°íš ê°€ëŠ¥. ì„±ìˆ˜ê¸° ì´ë²¤íŠ¸ ë° íŒ¨í‚¤ì§€ ìƒí’ˆ ì œê³µ</li>
            <li>ğŸ„ <strong>ë‹¤ëŒ€í¬í•´ì–‘ë ˆí¬ì¸ ì„¼í„°</strong> ì—°ê³„ í•´ì–‘ë ˆí¬ì¸  ì²´í—˜ (ì„œí•‘, SUP, ì œíŠ¸ìŠ¤í‚¤ ë“±)</li>
            <li>ğŸŒ… ë„“ê³  ê¹¨ë—í•œ í•´ë³€ê³¼ <span style="background: #fff3e0; padding: 2px 6px; border-radius: 3px; font-weight: 600; color: #e65100;">êµ­ë‚´ ìµœê³ ì˜ ì¼ëª° ëª…ì†Œ</span>ë¡œ ìœ ëª…í•˜ë©°, ì£¼ê±°ì§€ì—­ ì¸ì ‘ìœ¼ë¡œ í¸ì˜ì‹œì„¤ ì ‘ê·¼ ìš©ì´</li>
          </ul>
        </div>
        
        <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; border-left: 4px solid #764ba2; margin-bottom: 25px;">
          <h5 style="color: #764ba2; margin-top: 0; margin-bottom: 12px; font-size: 16px; font-weight: 600;">ğŸ“ ì˜ë„</h5>
          <ul style="line-height: 1.9; color: #555; margin-bottom: 0; font-size: 15px; padding-left: 20px;">
            <li>ğŸš„ <strong>ë¶€ì‚°ì—­ ë° êµ­ì œì—¬ê°í„°ë¯¸ë„</strong> ê·¼ì ‘ â†’ <span style="background: #e3f2fd; padding: 2px 6px; border-radius: 3px; font-weight: 600;">êµí†µ í—ˆë¸Œ ìµœì  ì…ì§€</span></li>
            <li>ğŸ­ <strong>í•´ì–‘ë¬¸í™”ê³µê°„</strong> í™œìš© ì§€ì—­ íŠ¹í™” ë¬¸í™” ì²´í—˜ í”„ë¡œê·¸ë¨ ì œê³µ ê°€ëŠ¥</li>
            <li>ğŸª ë¶€ì‚°í•­ ì¶•ì œ, í•´ì–‘ ìŠ¤í¬ì¸  ë“± <strong style="color: #9c27b0;">ì‹œì¦Œë³„ ì´ë²¤íŠ¸ í’ë¶€</strong></li>
            <li>ğŸ›ï¸ ë‚¨í¬ë™, ì„œë©´, ì„¼í…€ì‹œí‹°, ë™ë¶€ì‚° ì•„ìš¸ë › ë“± <span style="background: #fce4ec; padding: 2px 6px; border-radius: 3px; font-weight: 600;">ì£¼ìš” ì‡¼í•‘ ì§€ì—­ ê·¼ì ‘</span></li>
            <li>ğŸŒ‰ <strong>ë¶€ì‚°í•­ëŒ€êµÂ·ë‚¨í•­ëŒ€êµ</strong> í†µí•´ ê´‘ì•ˆë¦¬, í•´ìš´ëŒ€, ë‹¤ëŒ€í¬, ê°€ë•ë„ ë“± ì£¼ìš” ê´€ê´‘ì§€ ì ‘ê·¼ ìš©ì´</li>
            <li>ğŸï¸ ìš°ìˆ˜í•œ ìì—° ê²½ê´€ ë³´ìœ  ë° <strong style="color: #00897b;">ì¸ê¸° ê´€ê´‘ì§€ ì¸ì ‘</strong> (í°ì—¬ìš¸ë¬¸í™”ë§ˆì„, ê°ì²œë¬¸í™”ë§ˆì„, íƒœì¢…ëŒ€, ì•„ë¥´ë–¼ë®¤ì§€ì—„ ë“±)</li>
            <li>ğŸ£ ë‚šì‹œÂ·í•´ìˆ˜ìš• ì¦ê¸¸ ìˆ˜ ìˆëŠ” í•´ì•ˆ ëª…ì†Œ ë‹¤ìˆ˜ (í•˜ë¦¬í•­, ë™ì‚¼ë™, ê°ì§€í•´ë³€ ë“±)</li>
          </ul>
        </div>
        
        <h4 style="color: #667eea; margin-top: 30px; margin-bottom: 15px; font-size: 18px; font-weight: 600;">2. ì‚¬íšŒì  ì—¬ê±´</h4>
        <ul style="line-height: 1.9; color: #555; margin-bottom: 25px; font-size: 15px; padding-left: 20px;">
          <li>ğŸ’° ì„œë¶€ì‚° ì²´ë¥˜ì‹œì„¤ ì¸í”„ë¼ ë¶€ì¡±ì— ëŒ€í•œ <strong style="color: #1976d2;">ì •ë¶€Â·ì§€ìì²´ì˜ ê°œì„  ì˜ì§€ ê°•í™”</strong>ë¡œ ì‚¬ì—… ì¶”ì§„ ì‹œ <span style="background: #e8f5e9; padding: 2px 6px; border-radius: 3px; font-weight: 600; color: #2e7d32;">ì •ë¶€ ì§€ì›ê¸ˆ ìœ ì¹˜ ê°€ëŠ¥ì„± ì¦ëŒ€</span></li>
          <li>ğŸ“ˆ ë¶€ì‚° í•´ì™¸ ë°©ë¬¸ê° <strong style="color: #d32f2f; font-size: 16px;">300ë§Œ ëª…</strong> ëŒíŒŒ ë° 2028ë…„ê¹Œì§€ <strong style="color: #d32f2f; font-size: 16px;">500ë§Œ ëª…</strong> ìœ ì¹˜ ëª©í‘œ ì„¤ì •. <span style="background: #fff3e0; padding: 2px 6px; border-radius: 3px; font-weight: 600;">5ëŒ€ ì „ëµÂ·15ëŒ€ ì¤‘ì  ê³¼ì œ</span> ì¶”ì§„ ì¤‘<br>
              â†’ ì„œë¶€ì‚°ì€ <strong style="color: #43a047;">ìƒíƒœÂ·ìì—°í˜• ê´€ê´‘ í…Œë§ˆ</strong>ë¡œ ê°œë°œ í™•ì¥ ì˜ˆì •</li>
          <li>ğŸ† ë¶€ì‚° ì™¸êµ­ì¸ ê´€ê´‘ê° ì „ë…„ ëŒ€ë¹„ <span style="background: #ffebee; padding: 2px 8px; border-radius: 3px; font-weight: 700; color: #c62828; font-size: 16px;">â†— 23%</span> ì¦ê°€, ì§€ì¶œì•¡ <span style="background: #ffebee; padding: 2px 8px; border-radius: 3px; font-weight: 700; color: #c62828; font-size: 16px;">â†— 31.5%</span> ì¦ê°€ë¡œ <strong style="color: #d32f2f;">ì „êµ­ ìµœê³  ì¦ê°€ìœ¨ ë‹¬ì„±</strong></li>
        </ul>
        
        <h4 style="color: #667eea; margin-top: 30px; margin-bottom: 15px; font-size: 18px; font-weight: 600;">3. ì‹œì„¤ì  ì—¬ê±´</h4>
        
        <div style="background: #e8f5e9; padding: 20px; border-radius: 8px; border-left: 4px solid #4caf50; margin-bottom: 15px;">
          <h5 style="color: #2e7d32; margin-top: 0; margin-bottom: 12px; font-size: 16px; font-weight: 600;">âœ… ê¸ì •ì  ì¸¡ë©´</h5>
          <ul style="line-height: 1.9; color: #555; margin-bottom: 0; font-size: 15px; padding-left: 20px;">
            <li>âš¡ <strong>ê¸°ì¡´ ì‚¬ì—…ê³¼ì˜ ì‹œë„ˆì§€:</strong> <span style="background: #fff; padding: 2px 6px; border-radius: 3px; font-weight: 600; color: #2e7d32; border: 1px solid #4caf50;">ë¶€ê´€í›¼ë¦¬ ê¸°ì¡´ ì—…ì¢…</span> ìœ ì§€í•˜ë©° ìˆ™ë°•ì—…ì„ ê³µë™ íŒ¨í‚¤ì§€ë¡œ êµ¬ì„± â†’ ê³ ê° ì•ˆì •ì  í™•ë³´, ì‹ ê·œ ë§¤ì¶œ ì°½ì¶œ ë° <strong style="color: #1b5e20;">ì—¬ê° ë§¤ì¶œ ì‹œë„ˆì§€ ê·¹ëŒ€í™”</strong></li>
            <li>ğŸš¢ <strong>í•œÂ·ì¼ í•­ë¡œ ì´ì  í™œìš©:</strong> <span style="background: #e1f5fe; padding: 2px 6px; border-radius: 3px; font-weight: 600; color: #01579b;">í•œÂ·ì¼ ìœ ì¼ ë¶€ì‚°-ì‹œëª¨ë…¸ì„¸í‚¤ í•­ë¡œ ìš´í•­ì„ ì‚¬</span>ì˜ ì´ì  í™œìš© â†’ ì‹œëª¨ë…¸ì„¸í‚¤ ê¸€ë¨ë”ê³¼ <strong>MOU ì²´ê²°</strong> ë° ì—°ê³„ í”„ë¡œëª¨ì…˜. ë‚´êµ­ì¸Â·ì¼ë³¸ì¸ ê´€ê´‘ê° ë™ì‹œ ìœ ì¹˜ë¡œ ì„ ë„ê¸°ì—… ì…ì§€ êµ¬ì¶•</li>
            <li>ğŸŸï¸ <strong>ì •ë¶€ ì§€ì› í”„ë¡œê·¸ë¨ ì—°ê³„:</strong> <span style="background: #fff3e0; padding: 2px 8px; border-radius: 3px; font-weight: 600; color: #e65100;">ë¶€ì‚°ì›Œì¼€ì´ì…˜ í”„ë¡œê·¸ë¨</span> (ìˆ™ë°• ë°”ìš°ì²˜ 1ë°• <strong>5ë§Œì›</strong>, 3ë°• ìµœëŒ€ <strong>10ë§Œì›</strong> í• ì¸) í™œìš© â†’ ì§€ìì²´ ì§€ì›ê¸ˆ ìœ ì¹˜ ë° ê³ ê° í˜œíƒ ì œê³µ</li>
            <li>ğŸ¯ <strong>ê´€ê´‘ ì¸í”„ë¼ ì—°ê³„:</strong> ë¶€ì‚°ì‹œ <span style="background: #fce4ec; padding: 2px 6px; border-radius: 3px; font-weight: 600; color: #880e4f;">ì‹ ê·œ ê´€ê´‘ ì„œë¹„ìŠ¤</span>(ìˆ˜ë¥™ì–‘ìš©ë²„ìŠ¤, í•´ìƒê´€ê´‘íƒì‹œ, ì•¼ê°„ê´€ê´‘)ì™€ ì˜¤í˜ë¼í•˜ìš°ìŠ¤, íí”¼ë‘ì„¼í„°, í™©ë ¹ì‚° ìœ ì›ì§€, ê¸ˆì •ì‚° êµ­ë¦½ê³µì›, íƒœì¢…ëŒ€ ë“± ì£¼ìš” ê´€ê´‘ì§€ ì—°ê³„ â†’ ì†¡ê° ì„œë¹„ìŠ¤ í™•ëŒ€ ë° ì¶”ê°€ ë§¤ì¶œ ì°½ì¶œ</li>
          </ul>
        </div>
        
        <div style="background: #ffebee; padding: 20px; border-radius: 8px; border-left: 4px solid #f44336; margin-bottom: 15px;">
          <h5 style="color: #c62828; margin-top: 0; margin-bottom: 12px; font-size: 16px; font-weight: 600;">âš ï¸ ë¶€ì •ì  ì¸¡ë©´</h5>
          <ul style="line-height: 1.9; color: #555; margin-bottom: 0; font-size: 15px; padding-left: 20px;">
            <li>ğŸ“‹ <strong>í™˜ê²½ ê·œì œ:</strong> í•´ì•ˆê°€ ê°œë°œì— ë”°ë¥¸ <span style="background: #fff; padding: 2px 6px; border-radius: 3px; font-weight: 600; color: #c62828; border: 1px solid #f44336;">í™˜ê²½ ë³´í˜¸ ê·œì œ ì ìš© ê°€ëŠ¥ì„±</span> ë° ì¸í—ˆê°€ ì ˆì°¨ ë³µì¡ì„±</li>
            <li>ğŸŒŠ <strong>í•´ì–‘ì„± ê¸°í›„ ì˜í–¥:</strong> ê°•í’, ì¦ì€ ê°•ìš°, <span style="background: #fff3e0; padding: 2px 6px; border-radius: 3px; font-weight: 600; color: #e65100;">ì—¼ë¶„</span> ë“±ìœ¼ë¡œ ì¸í•œ ì‹œì„¤ ë¶€ì‹ ë° ë‚´êµ¬ì„± ì €í•˜ ìš°ë ¤</li>
            <li>ğŸ“ <strong>ê³µê°„ ì œì•½:</strong> ì œí•œëœ ë¶€ì§€ ë©´ì ê³¼ ê²½ì‚¬ë„ë¡œ ì¸í•œ ì‹œì„¤ ë°°ì¹˜ ë° í™•ì¥ì„± ì œí•œ</li>
            <li>ğŸ“‰ <strong>ê³„ì ˆì  ìˆ˜ìš” ë³€ë™:</strong> <span style="background: #fff; padding: 2px 6px; border-radius: 3px; font-weight: 600; color: #c62828; border: 1px solid #f44336;">ì„±ìˆ˜ê¸°Â·ë¹„ìˆ˜ê¸° ìˆ˜ìš” í¸ì°¨</span>ê°€ ì»¤ ë¹„ìˆ˜ê¸° ìˆ˜ìµì„± í™•ë³´ ì–´ë ¤ì›€</li>
            <li>ğŸ’¸ <strong>ì´ˆê¸° íˆ¬ìë¹„ ë¶€ë‹´:</strong> íŠ¹ìˆ˜ í™˜ê²½ ëŒ€ì‘ ì‹œì„¤ ë° 4ê³„ì ˆ ìš´ì˜ ì¸í”„ë¼ êµ¬ì¶•ìœ¼ë¡œ ì´ˆê¸° ë¹„ìš© ì¦ê°€</li>
          </ul>
        </div>
        
        <div style="background: #e3f2fd; padding: 20px; border-radius: 8px; border-left: 4px solid #2196f3; margin-bottom: 30px;">
          <h5 style="color: #1565c0; margin-top: 0; margin-bottom: 12px; font-size: 16px; font-weight: 600;">âœ… ëŒ€ì‘ ë°©ì•ˆ</h5>
          <ul style="line-height: 1.9; color: #555; margin-bottom: 0; font-size: 15px; padding-left: 20px;">
            <li>ğŸ¿ <strong>4ê³„ì ˆ ìš´ì˜ ìƒí’ˆ ê°œë°œ:</strong> ë¹„ìˆ˜ê¸° ëŒ€ì‘ì„ ìœ„í•œ <span style="background: #fff3e0; padding: 2px 8px; border-radius: 3px; font-weight: 600; color: #e65100;">ì‚¬ìš°ë‚˜, ì‹¤ë‚´ ì˜¨ìˆ˜í’€ì¥, ì˜¨ì‹¤í˜• ê¸€ë¨í•‘</span> ë“± ë™ì ˆê¸° íŠ¹í™” ì‹œì„¤ êµ¬ì¶•. ê³„ì ˆë³„ í…Œë§ˆ ì´ë²¤íŠ¸(<strong style="color: #f06292;">ë´„ ë²šê½ƒ ìº í•‘</strong>, <strong style="color: #00acc1;">ì—¬ë¦„ í•´ì–‘ìŠ¤í¬ì¸ </strong>, <strong style="color: #fb8c00;">ê°€ì„ ë‚™ì¡° íŒŒí‹°</strong>, <strong style="color: #039be5;">ê²¨ìš¸ ì‚¬ìš°ë‚˜ íë§</strong>) ê¸°íšìœ¼ë¡œ <span style="background: #fff; padding: 2px 6px; border-radius: 3px; font-weight: 600; color: #1565c0; border: 1px solid #2196f3;">ì—°ì¤‘ ìˆ˜ìš” ì°½ì¶œ</span></li>
            <li>ğŸ”§ <strong>í•´ì–‘ í™˜ê²½ íŠ¹í™” ìì¬ ì‚¬ìš©:</strong> ì—¼ë¶„ ë¶€ì‹ ë°©ì§€ë¥¼ ìœ„í•œ <span style="background: #e8f5e9; padding: 2px 8px; border-radius: 3px; font-weight: 700; color: #2e7d32;">ìŠ¤í…Œì¸ë¦¬ìŠ¤ STS316</span> ì´ìƒ ë“±ê¸‰ ìì¬, <strong>ì•„ì—°ë„ê¸ˆ ê°•ì¬</strong>, <strong>ì—í­ì‹œ ì½”íŒ…</strong> ì²˜ë¦¬ ì‹œì„¤ë¬¼ ì ìš©. ë°©ìˆ˜Â·ë°©ì²­ ì²˜ë¦¬ëœ í•´ì–‘ìš© ì „ê¸°ì„¤ë¹„ ë° ì•Œë£¨ë¯¸ëŠ„ í•©ê¸ˆ í”„ë ˆì„ ì‚¬ìš©ìœ¼ë¡œ <span style="background: #fff; padding: 2px 6px; border-radius: 3px; font-weight: 600; color: #1565c0; border: 1px solid #2196f3;">ë‚´êµ¬ì„± ê°•í™”</span></li>
            <li>ğŸŒ± <strong>ì¹œí™˜ê²½ ì¸í—ˆê°€ ì „ëµ:</strong> ì‚¬ì „ í™˜ê²½ì˜í–¥í‰ê°€ ì‹¤ì‹œ ë° ì¹œí™˜ê²½ ì¸ì¦(<span style="background: #c8e6c9; padding: 2px 6px; border-radius: 3px; font-weight: 600; color: #1b5e20;">ë…¹ìƒ‰ê±´ì¶•, ì—ë„ˆì§€íš¨ìœ¨ 1ë“±ê¸‰</span>) ì·¨ë“. <strong>íƒœì–‘ê´‘ íŒ¨ë„</strong>, <strong>ìš°ìˆ˜ ì¬í™œìš© ì‹œìŠ¤í…œ</strong>, ìƒíƒœ ì¹œí™”ì  ì¡°ê²½ ì„¤ê³„ë¡œ í™˜ê²½ ê·œì œ ëŒ€ì‘ ë° ì§€ìì²´ í˜‘ë ¥ ê°•í™”</li>
            <li>ğŸ“¦ <strong>ê³µê°„ ìµœì í™” ì„¤ê³„:</strong> <span style="background: #fff3e0; padding: 2px 6px; border-radius: 3px; font-weight: 600; color: #e65100;">ëª¨ë“ˆí˜• ê¸€ë¨í•‘ ë” êµ¬ì¡°</span>ë¡œ ê²½ì‚¬ì§€ íš¨ìœ¨ì  í™œìš© ë° ì´ë™ì‹ ì‹œì„¤ ë°°ì¹˜. ì§€í•˜ ê³µê°„ í™œìš©(ì°½ê³ , ê¸°ê³„ì‹¤), ë‹¤ì¸µ ë°í¬ êµ¬ì¡°ë¡œ ì œí•œëœ ë©´ì  ë‚´ ìµœëŒ€ ìˆ˜ìš© ì¸ì› í™•ë³´</li>
            <li>ğŸ¤– <strong>ìŠ¤ë§ˆíŠ¸ ìš´ì˜ ì‹œìŠ¤í…œ:</strong> <span style="background: #e1f5fe; padding: 2px 8px; border-radius: 3px; font-weight: 700; color: #01579b;">IoT ê¸°ë°˜</span> ì—ë„ˆì§€ ê´€ë¦¬, ì˜ˆì•½ ì‹œìŠ¤í…œ ìë™í™”, ì›ê²© ì‹œì„¤ ì œì–´ë¡œ ìš´ì˜ íš¨ìœ¨ í–¥ìƒ. ë¹„ìˆ˜ê¸° ì¸ê±´ë¹„ ì ˆê° ë° ìœ ì§€ë³´ìˆ˜ ë¹„ìš© ìµœì†Œí™”</li>
            <li>ğŸ¤ <strong>ì „ëµì  ì œíœ´ í™•ëŒ€:</strong> ì§€ì—­ ê´€ê´‘ì§€, ë ˆìŠ¤í† ë‘, ì²´í—˜ì—…ì²´ì™€ íŒ¨í‚¤ì§€ ìƒí’ˆ ê°œë°œë¡œ ë¹„ìˆ˜ê¸° ìˆ˜ìš” ì°½ì¶œ. <span style="background: #fce4ec; padding: 2px 6px; border-radius: 3px; font-weight: 600; color: #880e4f;">ê¸°ì—… ì—°ìˆ˜, ì›Œì¼€ì´ì…˜, ë‹¨ì²´ ì˜ˆì•½</span> ìœ ì¹˜ë¥¼ í†µí•œ ì•ˆì •ì  ë§¤ì¶œ ê¸°ë°˜ êµ¬ì¶•</li>
          </ul>
        </div>
        
        <h3 style="color: #667eea; margin-bottom: 20px; font-size: 20px; border-bottom: 2px solid #667eea; padding-bottom: 10px; margin-top: 40px;">ê¸°ëŒ€ íš¨ê³¼</h3>
        <ul style="line-height: 2; color: #555; margin-bottom: 30px; font-size: 15px;">
          <li>ë¶€ì‚° í•´ì–‘ ê´€ê´‘ ì‚°ì—…ì˜ ì¢…í•© ë°œì „ ë° ì‹œì¥ ì„ ë„</li>
          <li>ë¶í•­ ì¬ê°œë°œê³¼ì˜ ì‹œë„ˆì§€ë¥¼ í†µí•œ ì§€ì—­ ê²½ì œ í™œì„±í™”</li>
          <li>2030ì„¸ëŒ€ íƒ€ê²Ÿ í•´ì–‘ ë ˆì € ì½˜í…ì¸  í™•ì¶©</li>
          <li>ê¸€ë¨í•‘, í¬ë£¨ì¦ˆ, ë§ˆë¦¬ë‚˜ë¥¼ ì—°ê³„í•œ í†µí•© ê´€ê´‘ ìƒíƒœê³„ ì¡°ì„±</li>
          <li>ê¸°ì¡´ í•´ìš´ ì‚¬ì—… ì—­ëŸ‰ê³¼ í•´ì–‘ ìì›ì˜ íš¨ìœ¨ì  í™œìš©</li>
        </ul>
      </div>
      
      <!-- ì‹œí™© íƒ­ -->
      <div id="overview-market" class="overview-tab-content" style="max-width: 900px; margin: 0 auto; display: none;">
        <h3 style="color: #667eea; margin-top: 0; margin-bottom: 20px; font-size: 20px; border-bottom: 2px solid #667eea; padding-bottom: 10px;">ë¶€ì‚° ê¸€ë¨í•‘ ì‹œì¥ ì¢…í•© ë¶„ì„</h3>
        <p style="line-height: 1.8; color: #555; margin-bottom: 30px; font-size: 15px;">
          ë¶€ì‚°ê´‘ì—­ì‹œ ë‚´ <strong style="color: #667eea;">ê¸€ë¨í•‘ ë° ìº í•‘ ê´€ë ¨ ìˆ˜ìš”-ê³µê¸‰ ë°ì´í„°</strong> ì¢…í•© ë¶„ì„ì„ í†µí•´ 
          <span style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 2px 8px; border-radius: 4px; font-weight: 600;">ê²€ì¦ëœ ì‹œì¥ ê¸°íšŒ</span>ë¥¼ ë°œê²¬í•˜ì˜€ìŠµë‹ˆë‹¤.
          ê²€ìƒ‰ íŠ¸ë Œë“œì™€ ì‹¤ì œ ì‹œì„¤ í˜„í™©ì˜ ë¹„êµ ë¶„ì„ ê²°ê³¼, <strong style="color: #c62828;">ì˜ë„êµ¬ì™€ ì„œêµ¬(ë‹¤ëŒ€í¬)ì— ë¸”ë£¨ì˜¤ì…˜ ê¸°íšŒ</strong>ê°€ ì¡´ì¬í•©ë‹ˆë‹¤.
        </p>
        
        <h3 style="color: #667eea; margin-bottom: 20px; font-size: 20px; border-bottom: 2px solid #667eea; padding-bottom: 10px;">ğŸš¨ ìˆ˜ìš”-ê³µê¸‰ ê°­ ë¶„ì„: í•µì‹¬ ë°œê²¬</h3>
        
        <div style="background: linear-gradient(135deg, #fff3e0 0%, #ffe0b2 100%); padding: 30px; border-radius: 12px; margin-bottom: 30px; border: 3px solid #ff9800; box-shadow: 0 4px 12px rgba(255,152,0,0.2);">
          <h4 style="color: #e65100; margin-top: 0; margin-bottom: 25px; font-size: 20px; font-weight: 700; text-align: center;">âš¡ ë¶€ì‚° ê¸€ë¨í•‘ ì‹œì¥ì˜ ê²°ì •ì  ê¸°íšŒ âš¡</h4>
          
          <div style="display: grid; grid-template-columns: 1fr auto 1fr; gap: 20px; align-items: center; margin-bottom: 25px;">
            <div style="background: white; padding: 25px; border-radius: 10px; text-align: center; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
              <div style="color: #1976d2; font-size: 16px; font-weight: 600; margin-bottom: 10px;">ğŸ“Š ê²€ìƒ‰ ìˆ˜ìš”</div>
              <div style="color: #c62828; font-size: 42px; font-weight: 800; margin-bottom: 8px;">25.8%</div>
              <div style="color: #666; font-size: 14px; font-weight: 600;">ì˜ë„êµ¬ ê²€ìƒ‰ ë¹„ì¤‘</div>
              <div style="background: #e3f2fd; padding: 8px; border-radius: 6px; margin-top: 10px;">
                <div style="color: #1976d2; font-size: 13px; font-weight: 600;">ë¶€ì‚° 1ìœ„ ê´€ì‹¬ ì§€ì—­</div>
              </div>
            </div>
            
            <div style="font-size: 48px; color: #f44336; font-weight: 900;">â‰ </div>
            
            <div style="background: white; padding: 25px; border-radius: 10px; text-align: center; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
              <div style="color: #c62828; font-size: 16px; font-weight: 600; margin-bottom: 10px;">ğŸ•ï¸ ì‹¤ì œ ê³µê¸‰</div>
              <div style="color: #d32f2f; font-size: 42px; font-weight: 800; margin-bottom: 8px;">0ê°œ</div>
              <div style="color: #666; font-size: 14px; font-weight: 600;">ì˜ë„êµ¬ ê¸€ë¨í•‘ì¥</div>
              <div style="background: #ffebee; padding: 8px; border-radius: 6px; margin-top: 10px;">
                <div style="color: #c62828; font-size: 13px; font-weight: 600;">ê¸°ì¥êµ° ì™¸ ë¶€ì¬</div>
              </div>
            </div>
          </div>
          
          <div style="background: white; padding: 20px; border-radius: 8px; border-left: 5px solid #ff9800;">
            <h5 style="color: #e65100; margin-top: 0; margin-bottom: 15px; font-size: 18px; font-weight: 700;">ğŸ¯ í•µì‹¬ ì¸ì‚¬ì´íŠ¸</h5>
            <ul style="line-height: 2; color: #333; margin-bottom: 0; font-size: 15px; padding-left: 20px;">
              <li><strong style="color: #c62828; font-size: 16px;">ì˜ë„êµ¬: ìˆ˜ìš” 25.8% vs ê³µê¸‰ 0ê°œ</strong> - <span style="background: #ffebee; padding: 2px 8px; border-radius: 3px; font-weight: 700; color: #c62828;">ê·¹ì‹¬í•œ ê³µê¸‰ ë¶€ì¡±</span></li>
              <li><strong style="color: #2e7d32;">ì„œêµ¬(ë‹¤ëŒ€í¬): ë†’ì€ ê²€ìƒ‰ ê´€ì‹¬ vs ê¸€ë¨í•‘ì¥ ë¶€ì¬</strong> - ì œ2ì˜ ë¸”ë£¨ì˜¤ì…˜</li>
              <li>ë¶€ì‚° ì´ ìº í•‘ì‚¬ì´íŠ¸ 471ê°œ ì¤‘ <span style="background: #fff3e0; padding: 2px 8px; border-radius: 3px; font-weight: 700; color: #e65100;">ê¸€ë¨í•‘ì€ 12ê°œ(2.4%)</span>ì— ë¶ˆê³¼</li>
              <li>ê¸°ì¥êµ°ì—ë§Œ ê¸€ë¨í•‘ ì‹œì„¤ ì§‘ì¤‘ â†’ <strong style="color: #1976d2;">ì˜ë„Â·ì„œêµ¬ëŠ” ë¯¸ê°œì²™ ì‹œì¥</strong></li>
              <li><span style="background: #e8f5e9; padding: 2px 8px; border-radius: 3px; font-weight: 700; color: #2e7d32;">ì„ ì ì ìš°ìœ„(First Mover Advantage)</span> í™•ë³´ ê°€ëŠ¥</li>
            </ul>
          </div>
        </div>
        
        <h3 style="color: #667eea; margin-bottom: 20px; font-size: 20px; border-bottom: 2px solid #667eea; padding-bottom: 10px;">ë¶€ì‚° ìº í•‘Â·ê¸€ë¨í•‘ ì‹œì„¤ í˜„í™©</h3>
        
        <div style="background: #f8f9fa; padding: 25px; border-radius: 8px; margin-bottom: 30px; border-left: 4px solid #667eea;">
          <h4 style="color: #667eea; margin-top: 0; margin-bottom: 20px; font-size: 18px; font-weight: 600;">ğŸ“Š ë¶€ì‚° ìº í•‘ì‚¬ì´íŠ¸ ìœ í˜•ë³„ ë¶„í¬ (ì¶œì²˜: ê³ ìº í•‘)</h4>
          
          <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 15px; margin-bottom: 25px;">
            <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 18px; border-radius: 8px; text-align: center; box-shadow: 0 2px 6px rgba(0,0,0,0.1);">
              <div style="color: white; font-size: 13px; font-weight: 600; margin-bottom: 5px;">ì¼ë°˜ì•¼ì˜ì¥</div>
              <div style="color: white; font-size: 28px; font-weight: 700; margin-bottom: 3px;">240ê°œ</div>
              <div style="color: rgba(255,255,255,0.9); font-size: 12px; font-weight: 600;">48.9%</div>
            </div>
            
            <div style="background: #42a5f5; padding: 18px; border-radius: 8px; text-align: center; box-shadow: 0 2px 6px rgba(0,0,0,0.1);">
              <div style="color: white; font-size: 13px; font-weight: 600; margin-bottom: 5px;">ìë™ì°¨ì•¼ì˜ì¥</div>
              <div style="color: white; font-size: 28px; font-weight: 700; margin-bottom: 3px;">163ê°œ</div>
              <div style="color: rgba(255,255,255,0.9); font-size: 12px; font-weight: 600;">37.3%</div>
            </div>
            
            <div style="background: #66bb6a; padding: 18px; border-radius: 8px; text-align: center; box-shadow: 0 2px 6px rgba(0,0,0,0.1);">
              <div style="color: white; font-size: 13px; font-weight: 600; margin-bottom: 5px;">ì¹´ë¼ë°˜</div>
              <div style="color: white; font-size: 28px; font-weight: 700; margin-bottom: 3px;">40ê°œ</div>
              <div style="color: rgba(255,255,255,0.9); font-size: 12px; font-weight: 600;">9.1%</div>
            </div>
            
            <div style="background: #ffa726; padding: 18px; border-radius: 8px; text-align: center; box-shadow: 0 2px 6px rgba(0,0,0,0.1);">
              <div style="color: white; font-size: 13px; font-weight: 600; margin-bottom: 5px;">ê°œì¸ì¹´ë¼ë°˜</div>
              <div style="color: white; font-size: 28px; font-weight: 700; margin-bottom: 3px;">16ê°œ</div>
              <div style="color: rgba(255,255,255,0.9); font-size: 12px; font-weight: 600;">3.3%</div>
            </div>
            
            <div style="background: linear-gradient(135deg, #ef5350 0%, #e91e63 100%); padding: 18px; border-radius: 8px; text-align: center; box-shadow: 0 2px 6px rgba(0,0,0,0.1); border: 3px solid #c62828;">
              <div style="color: white; font-size: 13px; font-weight: 600; margin-bottom: 5px;">ğŸ¯ ê¸€ë¨í•‘</div>
              <div style="color: white; font-size: 28px; font-weight: 700; margin-bottom: 3px;">12ê°œ</div>
              <div style="color: rgba(255,255,255,0.9); font-size: 12px; font-weight: 600;">2.4% ğŸ”¥</div>
            </div>
          </div>
          
          <div style="background: white; padding: 20px; border-radius: 6px; border: 1px solid #e0e0e0; margin-bottom: 20px;">
            <h5 style="color: #333; margin-top: 0; margin-bottom: 15px; font-size: 16px; font-weight: 600;">ğŸ’¡ ì‹œì¥ êµ¬ì¡° ë¶„ì„</h5>
            <ul style="line-height: 2; color: #555; margin-bottom: 0; font-size: 15px; padding-left: 20px;">
              <li>ë¶€ì‚° ì´ <strong style="color: #667eea;">471ê°œ</strong> ìº í•‘ì‚¬ì´íŠ¸ ì¤‘ <span style="background: #ffebee; padding: 2px 8px; border-radius: 3px; font-weight: 700; color: #c62828;">ê¸€ë¨í•‘ì€ ë‹¨ 12ê°œ(2.4%)</span></li>
              <li>ì¼ë°˜ì•¼ì˜ì¥Â·ìë™ì°¨ì•¼ì˜ì¥ ì¤‘ì‹¬ (ì´ 86.2%) - ì €ê°€í˜• ìº í•‘ ì‹œì¥ í¬í™”</li>
              <li>ê¸€ë¨í•‘ì€ <strong style="color: #e91e63;">í”„ë¦¬ë¯¸ì—„ ì‹œì¥</strong>ìœ¼ë¡œ ì°¨ë³„í™” ê°€ëŠ¥ ì˜ì—­</li>
              <li><span style="background: #e3f2fd; padding: 2px 6px; border-radius: 3px; font-weight: 600; color: #1976d2;">ê¸°ì¥êµ° ì§‘ì¤‘</span> â†’ ì˜ë„êµ¬Â·ì„œêµ¬ëŠ” ê³µë°± ì§€ì—­</li>
            </ul>
          </div>
          
          <div style="background: linear-gradient(135deg, #ffebee 0%, #fce4ec 100%); padding: 20px; border-radius: 8px; border-left: 5px solid #e91e63;">
            <h5 style="color: #c62828; margin-top: 0; margin-bottom: 15px; font-size: 17px; font-weight: 700;">ğŸš€ ì‚¬ì—… ê¸°íšŒ í¬ì¸íŠ¸</h5>
            <div style="display: grid; gap: 12px;">
              <div style="background: white; padding: 15px; border-radius: 6px; border-left: 3px solid #4caf50;">
                <strong style="color: #2e7d32;">âœ“ ì €ê²½ìŸ ì‹œì¥:</strong> <span style="color: #555;">ê¸€ë¨í•‘ 2.4%ë¡œ ì‹œì¥ í¬í™”ë„ ë‚®ìŒ</span>
              </div>
              <div style="background: white; padding: 15px; border-radius: 6px; border-left: 3px solid #2196f3;">
                <strong style="color: #1976d2;">âœ“ í”„ë¦¬ë¯¸ì—„ í¬ì§€ì…”ë‹:</strong> <span style="color: #555;">ì¼ë°˜ ìº í•‘ì¥ê³¼ ì°¨ë³„í™”ëœ ê³ ê¸‰ ì‹œì¥ ê³µëµ</span>
              </div>
              <div style="background: white; padding: 15px; border-radius: 6px; border-left: 3px solid #ff9800;">
                <strong style="color: #e65100;">âœ“ ì§€ì—­ ê³µë°±:</strong> <span style="color: #555;">ì˜ë„êµ¬Â·ì„œêµ¬(ë‹¤ëŒ€í¬) ê¸€ë¨í•‘ì¥ ì „ë¬´</span>
              </div>
              <div style="background: white; padding: 15px; border-radius: 6px; border-left: 3px solid #9c27b0;">
                <strong style="color: #6a1b9a;">âœ“ ì„ ì  íš¨ê³¼:</strong> <span style="color: #555;">ìµœì´ˆ ì§„ì…ìœ¼ë¡œ ì§€ì—­ ëŒ€í‘œ ë¸Œëœë“œ êµ¬ì¶• ê°€ëŠ¥</span>
              </div>
            </div>
          </div>
        </div>
        
        <h3 style="color: #667eea; margin-bottom: 20px; font-size: 20px; border-bottom: 2px solid #667eea; padding-bottom: 10px;">ì§€ì—­ë³„ ê²€ìƒ‰ ìˆ˜ìš” ë¶„ì„</h3>
        
        <!-- ê²€ìƒ‰ê±´ìˆ˜ íˆíŠ¸ë§µ ì´ë¯¸ì§€ -->
        <div style="background: white; padding: 25px; border-radius: 8px; margin-bottom: 30px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); border: 2px solid #e0e0e0;">
          <h4 style="color: #667eea; margin-top: 0; margin-bottom: 20px; font-size: 18px; font-weight: 600; text-align: center;">ğŸ“ ë¶€ì‚°ê´‘ì—­ì‹œ ê²€ìƒ‰ê±´ìˆ˜ íˆíŠ¸ë§µ</h4>
          <div style="text-align: center; margin-bottom: 15px;">
            <img src="img/busan_glamping_heatmap.png" alt="ë¶€ì‚° ê²€ìƒ‰ê±´ìˆ˜ íˆíŠ¸ë§µ" style="max-width: 100%; height: auto; border-radius: 8px; box-shadow: 0 2px 6px rgba(0,0,0,0.1);" onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
            <div style="display: none; padding: 40px; background: #f5f5f5; border-radius: 8px; color: #666;">
              <p style="margin: 0; font-size: 14px;">ğŸ’¡ ì´ë¯¸ì§€ë¥¼ í‘œì‹œí•˜ë ¤ë©´ img í´ë”ì— 'busan_search_heatmap.png' íŒŒì¼ì„ ì €ì¥í•´ì£¼ì„¸ìš”.</p>
            </div>
          </div>
          <p style="text-align: center; color: #888; font-size: 13px; margin: 0;">ì¶œì²˜: í•œêµ­ê´€ê´‘ê³µì‚¬ ë°ì´í„°ë©</p>
        </div>
        
        <div style="background: #f8f9fa; padding: 25px; border-radius: 8px; margin-bottom: 30px; border-left: 4px solid #764ba2;">
          <h4 style="color: #764ba2; margin-top: 0; margin-bottom: 20px; font-size: 18px; font-weight: 600;">ğŸ“Š ë¶€ì‚°ê´‘ì—­ì‹œ ì§€ì—­ë³„ ê¸€ë¨í•‘ ê²€ìƒ‰ê±´ìˆ˜ ë¶„í¬ (í‹°ë§µë‚´ë¹„ê²Œì´ì…˜ ê¸°ë°˜ ìˆ™ë°•&gt;ìº í”„ì¥ ìœ í˜• ëª©ì ì§€ ê²€ìƒ‰ëŸ‰)</h4>
          
          <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 25px;">
            <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 20px; border-radius: 8px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); text-align: center; position: relative;">
              <div style="position: absolute; top: -10px; right: -10px; background: #ff9800; color: white; padding: 5px 12px; border-radius: 20px; font-size: 12px; font-weight: 700; box-shadow: 0 2px 4px rgba(0,0,0,0.2);">ë¸”ë£¨ì˜¤ì…˜</div>
              <div style="color: white; font-size: 14px; font-weight: 600; margin-bottom: 8px;">ğŸ¥‡ ì˜ë„êµ¬</div>
              <div style="color: white; font-size: 36px; font-weight: 700; margin-bottom: 5px;">25.8%</div>
              <div style="color: rgba(255,255,255,0.9); font-size: 13px; margin-bottom: 10px;">ê²€ìƒ‰ ë¹„ì¤‘ 1ìœ„</div>
              <div style="background: rgba(255,255,255,0.2); padding: 8px; border-radius: 6px; margin-top: 10px;">
                <div style="color: white; font-size: 13px; font-weight: 700;">ê¸€ë¨í•‘ì¥: 0ê°œ âš ï¸</div>
              </div>
            </div>
            
            <div style="background: #e8f5e9; padding: 20px; border-radius: 8px; border: 2px solid #4caf50; text-align: center; position: relative;">
              <div style="position: absolute; top: -10px; right: -10px; background: #66bb6a; color: white; padding: 5px 12px; border-radius: 20px; font-size: 12px; font-weight: 700; box-shadow: 0 2px 4px rgba(0,0,0,0.2);">ê¸°íšŒ</div>
              <div style="color: #2e7d32; font-size: 14px; font-weight: 600; margin-bottom: 8px;">ğŸ¥ˆ ì„œêµ¬ (ë‹¤ëŒ€í¬)</div>
              <div style="color: #1b5e20; font-size: 32px; font-weight: 700; margin-bottom: 5px;">ë†’ì€ ê´€ì‹¬</div>
              <div style="color: #388e3c; font-size: 13px; margin-bottom: 10px;">í•´ìˆ˜ìš•ì¥ ì¸ì ‘</div>
              <div style="background: #c8e6c9; padding: 8px; border-radius: 6px; margin-top: 10px;">
                <div style="color: #1b5e20; font-size: 13px; font-weight: 700;">ê¸€ë¨í•‘ì¥: 0ê°œ âš ï¸</div>
              </div>
            </div>
            
            <div style="background: #e1f5fe; padding: 20px; border-radius: 8px; border: 2px solid #2196f3; text-align: center;">
              <div style="color: #01579b; font-size: 14px; font-weight: 600; margin-bottom: 8px;">ğŸ¥‰ ê¸°ì¥êµ° / ë™êµ¬</div>
              <div style="color: #0277bd; font-size: 32px; font-weight: 700; margin-bottom: 5px;">ê¸°ì¡´ ê³µê¸‰</div>
              <div style="color: #0288d1; font-size: 13px; margin-bottom: 10px;">í•´ìš´ëŒ€ê¶Œ ë ˆì €</div>
              <div style="background: #b3e5fc; padding: 8px; border-radius: 6px; margin-top: 10px;">
                <div style="color: #01579b; font-size: 13px; font-weight: 700;">ê¸€ë¨í•‘ì¥ ì§‘ì¤‘ ì§€ì—­</div>
              </div>
            </div>
          </div>
          
          <div style="background: white; padding: 20px; border-radius: 6px; border: 1px solid #e0e0e0;">
            <h5 style="color: #333; margin-top: 0; margin-bottom: 15px; font-size: 16px; font-weight: 600;">ğŸ’¡ ìˆ˜ìš”-ê³µê¸‰ ë¯¸ìŠ¤ë§¤ì¹˜ í•µì‹¬ ë¶„ì„</h5>
            <ul style="line-height: 2; color: #555; margin-bottom: 0; font-size: 15px; padding-left: 20px;">
              <li><strong style="color: #c62828;">ì˜ë„êµ¬: ê²€ìƒ‰ 25.8% (1ìœ„)</strong> â†’ ê¸€ë¨í•‘ì¥ <span style="background: #ffebee; padding: 2px 8px; border-radius: 3px; font-weight: 700; color: #c62828;">0ê°œ</span> = <strong>ìµœëŒ€ ê¸°íšŒ</strong></li>
              <li><strong>ì„œêµ¬(ë‹¤ëŒ€í¬): ë†’ì€ ê²€ìƒ‰ ê´€ì‹¬</strong> â†’ ê¸€ë¨í•‘ì¥ <span style="background: #ffebee; padding: 2px 8px; border-radius: 3px; font-weight: 700; color: #c62828;">0ê°œ</span> = <strong>ì œ2 ê¸°íšŒ</strong></li>
              <li><strong>ê¸°ì¥êµ°/ë™êµ¬:</strong> ê¸°ì¡´ ê¸€ë¨í•‘ì¥ ì§‘ì¤‘ â†’ ê²½ìŸ ì¹˜ì—´, ì°¨ë³„í™” í•„ìš”</li>
              <li>ê²€ìƒ‰ ë°ì´í„°ëŠ” <span style="background: #e8f5e9; padding: 2px 6px; border-radius: 3px; font-weight: 600; color: #2e7d32;">ì‹¤ì œ ë°©ë¬¸ ì˜ë„ ë° ì‚¬ì—…ì„±</span>ê³¼ ì§ì ‘ì  ì—°ê´€</li>
              <li><span style="background: #fff3e0; padding: 2px 8px; border-radius: 3px; font-weight: 700; color: #e65100;">ì„ ì  ì „ëµ</span>: ì˜ë„êµ¬ 1ì°¨, ë‹¤ëŒ€í¬ 2ì°¨ ê°œë°œë¡œ ì„œë¶€ì‚° ê¸€ë¨í•‘ ì‹œì¥ ì¥ì•…</li>
            </ul>
          </div>
        </div>
        
        <h3 style="color: #667eea; margin-bottom: 20px; font-size: 20px; border-bottom: 2px solid #667eea; padding-bottom: 10px;">ê²€ìƒ‰ íŠ¸ë Œë“œ ì‹œê³„ì—´ ë¶„ì„</h3>
        
        <!-- ê²€ìƒ‰ê±´ìˆ˜ ì¶”ì´ ë° ìœ í˜•ë³„ ë¶„í¬ ì´ë¯¸ì§€ -->
        <div style="background: white; padding: 25px; border-radius: 8px; margin-bottom: 30px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); border: 2px solid #e0e0e0;">
          <h4 style="color: #667eea; margin-top: 0; margin-bottom: 20px; font-size: 18px; font-weight: 600; text-align: center;">ğŸ“ˆ ë¶€ì‚°ê´‘ì—­ì‹œ ìº í•‘ì‚¬ì´íŠ¸ ê²€ìƒ‰ ì¶”ì´ ë° ìœ í˜•ë³„ ë¶„í¬</h4>
          <div style="text-align: center; margin-bottom: 15px;">
            <img src="img/glamping_occu.jpg" alt="ë¶€ì‚° ê²€ìƒ‰ ì¶”ì´ ë° ìœ í˜•ë³„ ë¶„í¬" style="max-width: 100%; height: auto; border-radius: 8px; box-shadow: 0 2px 6px rgba(0,0,0,0.1);" onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
            <div style="display: none; padding: 40px; background: #f5f5f5; border-radius: 8px; color: #666;">
              <p style="margin: 0; font-size: 14px;">ğŸ’¡ ì´ë¯¸ì§€ë¥¼ í‘œì‹œí•˜ë ¤ë©´ img í´ë”ì— 'busan_search_trends.png' íŒŒì¼ì„ ì €ì¥í•´ì£¼ì„¸ìš”.</p>
            </div>
          </div>
          <p style="text-align: center; color: #888; font-size: 13px; margin: 0;">ì¶œì²˜: í•œêµ­ê´€ê´‘ê³µì‚¬ ë°ì´í„°ë©</p>
        </div>
        
        <div style="background: #f8f9fa; padding: 25px; border-radius: 8px; margin-bottom: 30px; border-left: 4px solid #4caf50;">
          <h4 style="color: #2e7d32; margin-top: 0; margin-bottom: 20px; font-size: 18px; font-weight: 600;">ğŸ“ˆ ë¶€ì‚°ê´‘ì—­ì‹œ ê¸€ë¨í•‘ ê²€ìƒ‰ê±´ìˆ˜ ì¶”ì´ (2020ë…„~2025ë…„)</h4>
          
          <div style="background: white; padding: 20px; border-radius: 6px; margin-bottom: 20px; border: 1px solid #e0e0e0;">
            <div style="display: flex; align-items: center; gap: 30px; flex-wrap: wrap; margin-bottom: 15px;">
              <div style="flex: 1; min-width: 200px;">
                <div style="color: #666; font-size: 13px; margin-bottom: 5px;">í‰ê·  ê²€ìƒ‰ëŸ‰ (ì›”ê°„)</div>
                <div style="color: #667eea; font-size: 28px; font-weight: 700;">3,000~5,000ê±´</div>
              </div>
              <div style="flex: 1; min-width: 200px;">
                <div style="color: #666; font-size: 13px; margin-bottom: 5px;">ì„±ìˆ˜ê¸° í”¼í¬ (ì—¬ë¦„)</div>
                <div style="color: #e91e63; font-size: 28px; font-weight: 700;">8,000ê±´+</div>
              </div>
              <div style="flex: 1; min-width: 200px;">
                <div style="color: #666; font-size: 13px; margin-bottom: 5px;">ì—°í‰ê·  ì¦ê°€ìœ¨</div>
                <div style="color: #4caf50; font-size: 28px; font-weight: 700;">ğŸ“ˆ ì§€ì† ì„±ì¥</div>
              </div>
            </div>
            
            <div style="padding: 15px; background: #fff3e0; border-radius: 6px; border-left: 3px solid #ff9800;">
              <p style="margin: 0; color: #e65100; font-weight: 600; font-size: 15px;">
                âš ï¸ ê³„ì ˆì  íŠ¹ì„±: 4~9ì›” ê²€ìƒ‰ëŸ‰ ê¸‰ì¦, 10~3ì›” ë¹„ìˆ˜ê¸° ìˆ˜ìš” ê´€ë¦¬ í•„ìš”
              </p>
            </div>
          </div>
          
          <div style="background: white; padding: 20px; border-radius: 6px; border: 1px solid #e0e0e0;">
            <h5 style="color: #333; margin-top: 0; margin-bottom: 15px; font-size: 16px; font-weight: 600;">ğŸ“Œ íŠ¸ë Œë“œ ë¶„ì„ í¬ì¸íŠ¸</h5>
            <ul style="line-height: 2; color: #555; margin-bottom: 0; font-size: 15px; padding-left: 20px;">
              <li><strong>2020ë…„~2022ë…„:</strong> ì½”ë¡œë‚˜19ë¡œ ì¸í•œ <span style="background: #e1f5fe; padding: 2px 6px; border-radius: 3px; font-weight: 600; color: #01579b;">êµ­ë‚´ ì—¬í–‰ ìˆ˜ìš” ê¸‰ì¦</span> (ê¸€ë¨í•‘ ì¸ê¸° ìƒìŠ¹)</li>
              <li><strong>2023ë…„~2024ë…„:</strong> ì•ˆì •ì ì¸ ìˆ˜ìš” ìœ ì§€ ë° í•´ì™¸ì—¬í–‰ ì¬ê°œì—ë„ ë¶ˆêµ¬í•˜ê³  ê¾¸ì¤€í•œ ê´€ì‹¬</li>
              <li><strong>2025ë…„ ì „ë§:</strong> ì›Œì¼€ì´ì…˜, íë§ íŠ¸ë Œë“œì™€ ë§ë¬¼ë ¤ <span style="background: #e8f5e9; padding: 2px 6px; border-radius: 3px; font-weight: 600; color: #2e7d32;">ì§€ì† ì„±ì¥ ì˜ˆìƒ</span></li>
              <li><strong>ê³„ì ˆì„±:</strong> ì—¬ë¦„(6~8ì›”) í”¼í¬, ë´„Â·ê°€ì„ ì¤€ì„±ìˆ˜ê¸°, ê²¨ìš¸ ë¹„ìˆ˜ê¸° ëšœë · â†’ <strong style="color: #d32f2f;">4ê³„ì ˆ ìš´ì˜ ì „ëµ í•„ìˆ˜</strong></li>
            </ul>
          </div>
        </div>
        
        <h3 style="color: #667eea; margin-bottom: 20px; font-size: 20px; border-bottom: 2px solid #667eea; padding-bottom: 10px;">ì „ëµì  ê²°ë¡  ë° ì‹¤í–‰ ë°©í–¥</h3>
        
        <div style="background: linear-gradient(135deg, #fce4ec 0%, #f8bbd0 100%); padding: 30px; border-radius: 12px; margin-bottom: 30px; border: 3px solid #e91e63; box-shadow: 0 6px 16px rgba(233,30,99,0.3);">
          <h4 style="color: #880e4f; margin-top: 0; margin-bottom: 25px; font-size: 20px; font-weight: 700; text-align: center;">ğŸ¯ ë¶€ì‚° ê¸€ë¨í•‘ ì‹œì¥ ì§„ì¶œ í•µì‹¬ ì „ëµ</h4>
          
          <div style="display: grid; gap: 18px;">
            <div style="background: white; padding: 22px; border-radius: 10px; border-left: 5px solid #4caf50; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
              <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 12px;">
                <div style="background: #4caf50; color: white; width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 20px; font-weight: 700; flex-shrink: 0;">1</div>
                <h5 style="color: #2e7d32; margin: 0; font-size: 18px; font-weight: 700;">ì˜ë„êµ¬ ìš°ì„  ì§„ì¶œ - ê²€ì¦ëœ ìˆ˜ìš” ì‹œì¥</h5>
              </div>
              <ul style="line-height: 1.9; color: #555; margin: 0; font-size: 15px; padding-left: 55px;">
                <li>ê²€ìƒ‰ ìˆ˜ìš” <strong style="color: #c62828;">25.8% (ë¶€ì‚° 1ìœ„)</strong> vs ê¸€ë¨í•‘ì¥ <strong style="color: #c62828;">0ê°œ</strong></li>
                <li>êµ­ì œì—¬ê°í„°ë¯¸ë„ ì—°ê³„ <span style="background: #e1f5fe; padding: 2px 6px; border-radius: 3px; font-weight: 600;">ë¶€ê´€í›¼ë¦¬ ì‹œë„ˆì§€</span></li>
                <li>íƒœì¢…ëŒ€Â·í°ì—¬ìš¸ë¬¸í™”ë§ˆì„ ë“± <strong>í’ë¶€í•œ ê´€ê´‘ ì¸í”„ë¼</strong></li>
                <li><span style="background: #e8f5e9; padding: 2px 6px; border-radius: 3px; font-weight: 600; color: #2e7d32;">ì„ ì ì ìš°ìœ„</span> í™•ë³´ë¡œ ì§€ì—­ ëŒ€í‘œ ë¸Œëœë“œ êµ¬ì¶•</li>
              </ul>
            </div>
            
            <div style="background: white; padding: 22px; border-radius: 10px; border-left: 5px solid #2196f3; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
              <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 12px;">
                <div style="background: #2196f3; color: white; width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 20px; font-weight: 700; flex-shrink: 0;">2</div>
                <h5 style="color: #1976d2; margin: 0; font-size: 18px; font-weight: 700;">ì„œêµ¬(ë‹¤ëŒ€í¬) 2ì°¨ í™•ì¥ - ì–‘ì¶• ì „ëµ</h5>
              </div>
              <ul style="line-height: 1.9; color: #555; margin: 0; font-size: 15px; padding-left: 55px;">
                <li>ë†’ì€ ê²€ìƒ‰ ê´€ì‹¬ + ê¸€ë¨í•‘ì¥ ë¶€ì¬ = <strong>ì œ2ì˜ ë¸”ë£¨ì˜¤ì…˜</strong></li>
                <li>ë‹¤ëŒ€í¬í•´ìˆ˜ìš•ì¥Â·í•´ì–‘ë ˆí¬ì¸ ì„¼í„° ì—°ê³„ <span style="background: #fff3e0; padding: 2px 6px; border-radius: 3px; font-weight: 600;">ì—¬ë¦„ íŠ¹í™”</span></li>
                <li>ì˜ë„-ë‹¤ëŒ€í¬ <strong style="color: #e65100;">ì„œë¶€ì‚° ì–‘ì¶• ì „ëµ</strong>ìœ¼ë¡œ ì‹œì¥ ì¥ì•…</li>
                <li>ì§€í•˜ì²  1í˜¸ì„  ì ‘ê·¼ì„±ìœ¼ë¡œ ëŒ€ì¤‘êµí†µ ì´ìš©ê° ê³µëµ</li>
              </ul>
            </div>
            
            <div style="background: white; padding: 22px; border-radius: 10px; border-left: 5px solid #ff9800; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
              <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 12px;">
                <div style="background: #ff9800; color: white; width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 20px; font-weight: 700; flex-shrink: 0;">3</div>
                <h5 style="color: #e65100; margin: 0; font-size: 18px; font-weight: 700;">í”„ë¦¬ë¯¸ì—„ í¬ì§€ì…”ë‹ - ì°¨ë³„í™” ì „ëµ</h5>
              </div>
              <ul style="line-height: 1.9; color: #555; margin: 0; font-size: 15px; padding-left: 55px;">
                <li>ë¶€ì‚° ê¸€ë¨í•‘ <strong style="color: #c62828;">2.4%</strong> ë¹„ì¤‘ â†’ ì¼ë°˜ ìº í•‘ì¥ê³¼ ëª…í™•í•œ ì°¨ë³„í™”</li>
                <li><span style="background: #fce4ec; padding: 2px 6px; border-radius: 3px; font-weight: 600; color: #880e4f;">í”„ë¦¬ë¯¸ì—„ íƒ€ê²Ÿ</span>: 2030ì„¸ëŒ€, ì›Œì¼€ì´ì…˜ì¡±, ê°€ì¡± ë‹¨ìœ„</li>
                <li>4ê³„ì ˆ ìš´ì˜ ìƒí’ˆ (ì‚¬ìš°ë‚˜Â·ì˜¨ìˆ˜í’€ì¥Â·ì˜¨ì‹¤ ê¸€ë¨í•‘) ê°œë°œ</li>
                <li>ì‹œëª¨ë…¸ì„¸í‚¤ ê¸€ë¨ë” ë²¤ì¹˜ë§ˆí‚¹ + í•œì¼ ì—°ê³„ íŒ¨í‚¤ì§€</li>
              </ul>
            </div>
            
            <div style="background: white; padding: 22px; border-radius: 10px; border-left: 5px solid #9c27b0; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
              <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 12px;">
                <div style="background: #9c27b0; color: white; width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 20px; font-weight: 700; flex-shrink: 0;">4</div>
                <h5 style="color: #6a1b9a; margin: 0; font-size: 18px; font-weight: 700;">ê¸°ì¡´ ì‚¬ì—… ì‹œë„ˆì§€ ê·¹ëŒ€í™”</h5>
              </div>
              <ul style="line-height: 1.9; color: #555; margin: 0; font-size: 15px; padding-left: 55px;">
                <li><strong>ë¶€ê´€í›¼ë¦¬ ì—¬ê° + ê¸€ë¨í•‘</strong> íŒ¨í‚¤ì§€ë¡œ ì†¡ê° ì‹œë„ˆì§€</li>
                <li>í•œÂ·ì¼ ìœ ì¼ í•­ë¡œ í™œìš© í¬ë¡œìŠ¤ë³´ë” ê´€ê´‘ ìƒí’ˆ</li>
                <li>ì¼ë³¸ì¸ ê´€ê´‘ê° ìœ ì¹˜ ë° ë‚´êµ­ì¸ ì¼ë³¸ ì—¬í–‰ ì—°ê³„</li>
                <li>ì •ë¶€ ì§€ì› í”„ë¡œê·¸ë¨ (ì›Œì¼€ì´ì…˜ ë°”ìš°ì²˜) ì ê·¹ í™œìš©</li>
              </ul>
            </div>
          </div>
          
          <div style="background: #263238; padding: 25px; border-radius: 10px; margin-top: 25px; text-align: center;">
            <div style="color: #ffd54f; font-size: 18px; font-weight: 700; margin-bottom: 12px;">ğŸ’ ìµœì¢… ê²°ë¡ </div>
            <p style="color: white; font-size: 16px; line-height: 1.8; margin: 0;">
              <strong style="color: #ff9800;">ì˜ë„êµ¬ ê²€ìƒ‰ ìˆ˜ìš” 25.8%</strong> vs <strong style="color: #f44336;">ê¸€ë¨í•‘ì¥ 0ê°œ</strong>ë¼ëŠ” <br>
              <span style="background: linear-gradient(135deg, #ffd54f 0%, #ffb300 100%); color: #263238; padding: 4px 12px; border-radius: 6px; font-weight: 800; font-size: 18px;">ê²€ì¦ëœ ì‹œì¥ ê¸°íšŒ</span>ë¥¼ ì„ ì í•˜ì—¬<br>
              <strong style="color: #4caf50;">ì„œë¶€ì‚° ê¸€ë¨í•‘ ì‹œì¥ 1ìœ„</strong> ë‹¬ì„±
            </p>
          </div>
        </div>
      </div>
      
      <!-- ì°¸ê³ ìë£Œ íƒ­ -->
      <div id="overview-reference" class="overview-tab-content" style="max-width: 900px; margin: 0 auto; display: none;">
        <h3 style="color: #667eea; margin-top: 0; margin-bottom: 20px; font-size: 20px; border-bottom: 2px solid #667eea; padding-bottom: 10px;">ì°¸ê³ ìë£Œ</h3>
        <p style="line-height: 1.8; color: #555; margin-bottom: 30px; font-size: 15px;">
          ê´€ë ¨ ì°¸ê³ ìë£Œ ë° ë¬¸ì„œë¥¼ ì…ë ¥í•˜ì„¸ìš”.
        </p>
        
        <h3 style="color: #667eea; margin-bottom: 20px; font-size: 20px; border-bottom: 2px solid #667eea; padding-bottom: 10px;">ì£¼ìš” ë¬¸ì„œ</h3>
        <ul style="line-height: 2; color: #555; margin-bottom: 30px; font-size: 15px;">
          <li>ë¬¸ì„œ 1</li>
          <li>ë¬¸ì„œ 2</li>
          <li>ë¬¸ì„œ 3</li>
        </ul>
        
        <h3 style="color: #667eea; margin-bottom: 20px; font-size: 20px; border-bottom: 2px solid #667eea; padding-bottom: 10px;">ê´€ë ¨ ë§í¬</h3>
        <p style="line-height: 1.8; color: #555; margin-bottom: 30px; font-size: 15px;">
          ê´€ë ¨ ì›¹ì‚¬ì´íŠ¸ ë° ë§í¬ë¥¼ ì…ë ¥í•˜ì„¸ìš”.
        </p>
      </div>
      
      <!-- ì‹¤ê±°ë˜ê°€ ìƒì„¸ íƒ­ -->
      <div id="overview-transaction" class="overview-tab-content" style="max-width: 100%; margin: 0 auto; display: none; padding: 20px;">
        <h3 style="color: #667eea; margin-top: 0; margin-bottom: 20px; font-size: 20px; border-bottom: 2px solid #667eea; padding-bottom: 10px;">ì‹¤ê±°ë˜ê°€ ìƒì„¸</h3>
        
        <!-- ì—‘ì…€ ì—…ë¡œë“œ ì„¹ì…˜ -->
        <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; margin-bottom: 20px;">
          <div style="display: flex; align-items: center; gap: 15px; flex-wrap: wrap;">
            <label for="excelFileInput" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 10px 20px; border-radius: 6px; cursor: pointer; font-weight: 600; font-size: 14px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); transition: all 0.2s; display: inline-block;" onmouseover="this.style.transform='translateY(-1px)'; this.style.boxShadow='0 4px 8px rgba(0,0,0,0.15)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 2px 4px rgba(0,0,0,0.1)'">
              ğŸ“ ì—‘ì…€ íŒŒì¼ ì„ íƒ
            </label>
            <input type="file" id="excelFileInput" accept=".xlsx, .xls" style="display: none;" onchange="loadExcelFile(event)">
            <span id="fileName" style="color: #666; font-size: 14px;">ì„ íƒëœ íŒŒì¼ ì—†ìŒ</span>
            <div id="sheetSelector" style="display: none; align-items: center; gap: 10px;">
              <label style="color: #667eea; font-weight: 600; font-size: 14px;">ì‹œíŠ¸ ì„ íƒ:</label>
              <select id="sheetSelect" onchange="changeSheet()" style="padding: 8px 12px; border: 2px solid #667eea; border-radius: 6px; font-size: 14px; cursor: pointer; background: white; color: #333;">
              </select>
            </div>
            <button onclick="clearTransactionTable()" style="background: #e74c3c; color: white; padding: 10px 20px; border: none; border-radius: 6px; cursor: pointer; font-weight: 600; font-size: 14px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); transition: all 0.2s;" onmouseover="this.style.background='#c0392b'" onmouseout="this.style.background='#e74c3c'">í…Œì´ë¸” ì´ˆê¸°í™”</button>
            <button onclick="showDataInfo()" style="background: #3498db; color: white; padding: 10px 20px; border: none; border-radius: 6px; cursor: pointer; font-weight: 600; font-size: 14px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); transition: all 0.2s;" onmouseover="this.style.background='#2980b9'" onmouseout="this.style.background='#3498db'">ë°ì´í„° í™•ì¸</button>
          </div>
          <p style="margin-top: 10px; color: #888; font-size: 13px;">ğŸ’¡ ì—‘ì…€ íŒŒì¼(.xlsx, .xls)ì„ ì—…ë¡œë“œí•˜ë©´ ìë™ìœ¼ë¡œ í…Œì´ë¸”ì´ ìƒì„±ë©ë‹ˆë‹¤. ì‹œíŠ¸ë¥¼ ì„ íƒí•˜ì—¬ ë‹¤ë¥¸ ë°ì´í„°ë¥¼ ë³¼ ìˆ˜ ìˆìœ¼ë©°, ì»¬ëŸ¼ í—¤ë”ë¥¼ í´ë¦­í•˜ì—¬ ì •ë ¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
          <div id="dataInfo" style="margin-top: 10px; padding: 10px; background: #e8f4f8; border-radius: 6px; border-left: 4px solid #3498db; display: none; color: #333; font-size: 13px;"></div>

          <div id="pricePerM2Panel" style="margin-top: 15px; padding: 12px; background: #fff; border-radius: 6px; border: 1px solid #e0e0e0;">
            <div style="display: flex; align-items: center; gap: 10px; flex-wrap: wrap;">
              <strong style="color: #34495e;">mÂ²ë‹¹ í‰ê·  ê±°ë˜ê°€</strong>
              <label style="display: flex; align-items: center; gap: 6px; font-size: 13px; color: #555; cursor: pointer;">
                <input type="checkbox" id="includeOutliersToggle" checked onchange="updatePricePerM2Summary()">
                ì´ìƒì¹˜ í¬í•¨
              </label>
            </div>
            <div id="pricePerM2Summary" style="margin-top: 8px; font-size: 13px; color: #333;">
              ë°ì´í„°ê°€ ë¡œë“œë˜ë©´ ê³„ì‚°ë©ë‹ˆë‹¤.
            </div>
          </div>
        </div>
        
        <!-- í…Œì´ë¸” ì»¨í…Œì´ë„ˆ -->
        <div id="transaction-table" style="background: white; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); overflow: auto; min-height: 200px;"></div>
      </div>
    </div>
    
    <!-- í‘¸í„° -->
    <div style="padding: 15px 30px; background: #f8f9fa; border-top: 1px solid #e0e0e0; display: flex; justify-content: flex-end;">
      <button onclick="closeOverviewPopup()" style="padding: 10px 24px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; border-radius: 6px; font-weight: 600; font-size: 14px; cursor: pointer; box-shadow: 0 2px 4px rgba(0,0,0,0.1); transition: all 0.2s;" onmouseover="this.style.transform='translateY(-1px)'; this.style.boxShadow='0 4px 8px rgba(0,0,0,0.15)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 2px 4px rgba(0,0,0,0.1)'">ë‹«ê¸°</button>
    </div>
  </div>
</div>

</body></html>